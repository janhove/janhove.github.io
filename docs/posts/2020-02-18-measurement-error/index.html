<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jan Vanhove">
<meta name="dcterms.date" content="2020-02-18">

<title>Jan Vanhove :: Blog - Baby steps in Bayes: Incorporating reliability estimates in regression models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jan Vanhove :: Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html" rel="" target="">
 <span class="menu-text">Blog archive</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html" rel="" target="">
 <span class="menu-text">Teaching resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../archive.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#reliability-and-measurement-error" id="toc-reliability-and-measurement-error" class="nav-link active" data-scroll-target="#reliability-and-measurement-error">Reliability and measurement error</a></li>
  <li><a href="#a-simulated-example" id="toc-a-simulated-example" class="nav-link" data-scroll-target="#a-simulated-example">A simulated example</a>
  <ul class="collapse">
  <li><a href="#generating-the-construct-scores" id="toc-generating-the-construct-scores" class="nav-link" data-scroll-target="#generating-the-construct-scores">Generating the construct scores</a></li>
  <li><a href="#adding-measurement-error" id="toc-adding-measurement-error" class="nav-link" data-scroll-target="#adding-measurement-error">Adding measurement error</a></li>
  <li><a href="#statistical-model" id="toc-statistical-model" class="nav-link" data-scroll-target="#statistical-model">Statistical model</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#real-life-example-interdependence" id="toc-real-life-example-interdependence" class="nav-link" data-scroll-target="#real-life-example-interdependence">Real-life example: Interdependence</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#statistical-model-1" id="toc-statistical-model-1" class="nav-link" data-scroll-target="#statistical-model-1">Statistical model</a></li>
  <li><a href="#results-1" id="toc-results-1" class="nav-link" data-scroll-target="#results-1">Results</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#software-versions" id="toc-software-versions" class="nav-link" data-scroll-target="#software-versions">Software versions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Baby steps in Bayes: Incorporating reliability estimates in regression models</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Stan</div>
    <div class="quarto-category">Bayesian statistics</div>
    <div class="quarto-category">measurement error</div>
    <div class="quarto-category">correlational studies</div>
    <div class="quarto-category">reliability</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jan Vanhove </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 18, 2020</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Researchers sometimes calculate reliability indices such as Cronbach’s <span class="math inline">\(\alpha\)</span> or Revelle’s <span class="math inline">\(\omega_T\)</span>, but their statistical models rarely take these reliability indices into account. Here I want to show you how you can incorporate information about the reliability about your measurements in a statistical model so as to obtain more honest and more readily interpretable parameter estimates.</p>
<section id="reliability-and-measurement-error" class="level2">
<h2 class="anchored" data-anchor-id="reliability-and-measurement-error">Reliability and measurement error</h2>
<p>This blog post is the sequel to the <a href="../2020-01-21-statistical-control-measurement-error">previous</a> one, where I demonstrated how imperfectly measured control variables undercorrect for the actual confounding in observational studies (also see Berthele &amp; Vanhove 2017; Brunner &amp; Austin 2009; Westfall &amp; Yarkoni 2016). A model that doesn’t account for measurement error on the confounding variable—and hence implicitly assumes that the confound was measured perfectly—may confidently conclude that the variable of actual interest is related to the outcome even when taking into account the confound. From such a finding, researchers typically infer that the variable of actual interest is causally related to the outcome even in absence of the confound. But once this measurement error is duly accounted for, you may find that the evidence for a causal link between the variable of interest and the outcome is more tenuous than originally believed.</p>
<p>So especially in observational studies, where confounds abound, it behooves researchers to account for the measurement error in their variables so that they don’t draw unwarranted conclusions from their data too often. The amount of measurement error on your variables is usually unknown. But if you’ve calculated some reliability estimate such as Cronbach’s <span class="math inline">\(\alpha\)</span> for your variables, you can use this to obtain an estimate of the amount of measurement error.</p>
<p>To elaborate, in classical test theory, the reliability <span class="math inline">\(\rho_{XX'}\)</span> of a measure is equal to the ratio of the variance of the (error-free) true scores to the variance of the observed scores. The latter is the sum of the variance of the true scores and the error variance:</p>
<p><span class="math display">\[
\rho_{XX'} = \frac{\textrm{true score variance}}{\textrm{true score variance} + \textrm{measurement error variance}} = \frac{\sigma^2_T}{\sigma^2_T + \sigma^2_E}.
\]</span></p>
<p>Rearranging, we get</p>
<p><span class="math display">\[
\sigma^2_E = \sigma^2_T\left(\frac{1}{\rho_{XX'}}-1\right).
\]</span></p>
<p>None of these values are known, but they can be estimated based on the sample. Specifically, <span class="math inline">\(\rho_{XX'}\)</span> can be estimated by a reliability index such as Cronbach’s <span class="math inline">\(\alpha\)</span> and the sum <span class="math inline">\(\sigma^2_T + \sigma^2_E\)</span> can be estimated by computing the variable’s sample variance.</p>
</section>
<section id="a-simulated-example" class="level2">
<h2 class="anchored" data-anchor-id="a-simulated-example">A simulated example</h2>
<p>Let’s first deal with a simulated dataset. The main advantage of analysing simulated data is that you check that what comes out of the model corresponds to what went into the data. In preparing this blog post, I was able to detect an arithmetic error in my model code in this way as one parameter was consistently underestimated. Had I applied the model immediately to the real data set, I wouldn’t have noticed anything wrong. But we’ll deal with real data afterwards.</p>
<p><strong>Update (2023-08-06):</strong> When converting this blog from Jekyll/Bootstrap to Quarto, I noticed that the original code used in this blog post, which involved the R package <code>rstan</code> has started to run very slowly. In the present version, I use <code>cmdstanr</code> instead.</p>
<p>Run these commands to follow along:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_3b78b3893311250fd4a8322deb111456">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)  <span class="co"># for fitting Bayesian models, v. 2.32.2</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior) <span class="co"># for working with posterior distributions</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For drawing scatterplot matrices</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://janhove.github.io/RCode/scatterplot_matrix.R"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2020-02-13</span>, <span class="at">kind =</span> <span class="st">"Mersenne-Twister"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="generating-the-construct-scores" class="level3">
<h3 class="anchored" data-anchor-id="generating-the-construct-scores">Generating the construct scores</h3>
<p>The scenario we’re going to simulate is one in which you have two correlated predictor variables (<code>A</code> and <code>B</code>) and one outcome variable (<code>Z</code>). Unbeknownst to the analyst, <code>Z</code> is causally affected by <code>A</code> but not by <code>B</code>. Moreover, the three variables are measured with some degree of error, but we’ll come to that later. Figure 1 depicts the scenario for which we’re going to simulate data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_49f3c42090373fe1c15810501775917b">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> Graphical causal model for the simulated data. A set of unobserved factors <span class="math inline">\(U\)</span> gives rise to a correlation between <code>A</code> and <code>B</code>. Even though only <code>A</code> causally affects <code>Z</code>, an association between <code>B</code> and <code>Z</code> will be found unless <code>A</code> is controlled for.</figcaption>
</figure>
</div>
</div>
</div>
<p>The first thing we need are two correlated predictor variables. I’m going to generate these from a bivariate normal distribution. <code>A</code> has a mean of 3 units and a standard deviation of 1.5 units, and <code>B</code> has mean -4 and standard deviation 0.8 units. The correlation between them is <span class="math inline">\(\rho = 0.73\)</span>. To generate a sample from this bivariate normal distribution, you need to construct the variance-covariance matrix from the standard deviations and correlation, which I do in the code below:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_2ededbcc036052d50d0f9bcceca4b026">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate correlated constructs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.73</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>mean_A <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>mean_B <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>sd_A <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sd_B <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Given the correlation and the standard deviations,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># construct the variance-covariance matrix for the constructs like so:</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>latent_covariance_matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(sd_A, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, sd_B)) <span class="sc">%*%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho), <span class="fu">c</span>(rho, <span class="dv">1</span>)) <span class="sc">%*%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(sd_A, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, sd_B))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw data from the multivariate normal distribution:</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>constructs <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n, <span class="at">mu =</span> <span class="fu">c</span>(mean_A, mean_B),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Sigma =</span> latent_covariance_matrix)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract variables from object</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> constructs[, <span class="dv">1</span>]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> constructs[, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to generate the outcome. In this simulation, <code>Z</code> depends linearly on <code>A</code> but not on <code>B</code> (hence ‘<span class="math inline">\(0 \times B_i\)</span>’).</p>
<p><span class="math display">\[
Z_i = 2 + 0.7 \times A_i + 0 \times B_i + \varepsilon_i.
\]</span></p>
<p>The error term <span class="math inline">\(\varepsilon\)</span> is drawn from a normal distribution with standard deviation 1.3. Importantly, this error term does <em>not</em> express the measurement error on <code>Z</code>; it is the part of the true score variance in <code>Z</code> that isn’t related to either <code>A</code> or <code>B</code>:</p>
<p><span class="math display">\[
\varepsilon_i \sim \textrm{Normal}(0, 1.3).
\]</span></p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_a2ce4ac0075cad7fe5b92c76fc412211">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Z</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>intercept <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>slope_A <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>slope_B <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>sigma_Z.AB <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> intercept <span class="sc">+</span> slope_A<span class="sc">*</span>A <span class="sc">+</span> slope_B<span class="sc">*</span>B <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> sigma_Z.AB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even though <code>B</code> isn’t causally related to <code>Z</code>, we find that <code>B</code> and <code>Z</code> are correlated thanks to <code>B</code>’s correlation to <code>A</code>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_22544f7e184f625a320c08b3fc5bd5a2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot_matrix</span>(<span class="fu">cbind</span>(Z, A, B))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 2.</strong> <code>B</code> is causally unrelated to <code>Z</code>, but these two variables are still correlated because <code>B</code> correlates with <code>A</code> and <code>A</code> and <code>Z</code> are causally related.</figcaption>
</figure>
</div>
</div>
</div>
<p>A multiple regression model is able to tease apart the effects of <code>A</code> and <code>B</code> on <code>Z</code>:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_19c36b77507eb89daab45f4aca27f09d">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(Z <span class="sc">~</span> A <span class="sc">+</span> B))<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   2.1224     0.7130   2.977 3.15e-03
A             0.6876     0.0706   9.742 1.22e-19
B             0.0196     0.1340   0.146 8.84e-01</code></pre>
</div>
</div>
<p>The confound <code>A</code> is significantly related to <code>Z</code> and its estimated regression parameter is close to its true value of 0.70 (<span class="math inline">\(\widehat{\beta}_A = 0.69 \pm 0.07\)</span>). The variable of interest <code>B</code>, by contrast, isn’t significantly related to <code>Z</code> when <code>A</code> has been accounted for (<span class="math inline">\(\widehat{\beta}_B = 0.02 \pm 0.13\)</span>). This is all as it should be.</p>
</section>
<section id="adding-measurement-error" class="level3">
<h3 class="anchored" data-anchor-id="adding-measurement-error">Adding measurement error</h3>
<p>Now let’s add measurement error to all variables. The <code>A</code> values that we actually observe will then be distorted versions of the true <code>A</code> values:</p>
<p><span class="math display">\[
\textrm{observed } A_i = \textrm{true } A_i + \varepsilon_{Ai}.
\]</span></p>
<p>The ‘noise’ <span class="math inline">\(\varepsilon_{A}\)</span> is commonly assumed to be normally distributed:</p>
<p><span class="math display">\[
\varepsilon_{Ai} \sim \textrm{Normal}(0, \tau_A).
\]</span></p>
<p>That said, you can easily imagine situations where the noise likely has a different distribution. For instance, when measurements are measured to the nearest integer (e.g., body weights in kilograms), the noise is likely uniformly distributed (e.g., a reported body weight of 66 kg means that the true body weight lies between 65.5 and 66.5 kg).</p>
<p>To make the link with the analysis more transparant, I will express the amount of noise in terms of the variables’ reliabilities. For the confound <code>A</code>, I set the reliability at 0.70. Since <code>A</code>’s standard deviation was 1.5 units, this means that the standard deviation of the noise is <span class="math inline">\(\sqrt{1.5^2\left(\frac{1}{0.70} - 1\right)} = 0.98\)</span> units. I set the reliability for <code>B</code>, the variable of actual interest at 0.90. Its standard deviation is 0.8, so the standard deviation of the noise is <span class="math inline">\(\sqrt{0.8^2\left(\frac{1}{0.90} - 1\right)} = 0.27\)</span> units.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_4212a8d1c7d01d4b8e873af9be229807">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add measurement error on A and B</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>obs_A <span class="ot">&lt;-</span> A <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">sd =</span> <span class="fu">sqrt</span>(sd_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">0.70</span> <span class="sc">-</span> <span class="dv">1</span>))) <span class="co"># reliability 0.70</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>obs_B <span class="ot">&lt;-</span> B <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">sd =</span> <span class="fu">sqrt</span>(sd_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">0.90</span> <span class="sc">-</span> <span class="dv">1</span>))) <span class="co"># reliability 0.90</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The same logic applies to adding measurement noise to <code>Z</code>. The difficulty here lies in obtaining the population standard deviation (or variance) of <code>Z</code>. I don’t want to just plug in <code>Z</code>’s sample standard deviation since I want to have exact knowledge of the population parameters. While we specified a <code>sigma_Z.AB</code> above, this is <em>not</em> the total population standard deviation of <code>Z</code>: it’s the population standard deviation of <code>Z</code> once <code>Z</code> has been controlled for <code>A</code> and <code>B</code>. To obtain the <em>total</em> standard deviation of <code>Z</code> (here admittedly confusingly labelled <span class="math inline">\(\sigma_Z\)</span>), we need to add in the variance in <code>Z</code> due to <code>A</code> and <code>B</code>:</p>
<p><span class="math display">\[
\sigma_Z = \sqrt{(\beta_A\sigma_A)^2 + (\beta_B\sigma_B)^2 + 2\beta_A\beta_B\sigma_A\sigma_B\rho_{AB} + \sigma_{Z.AB}^2}.
\]</span></p>
<p>Since <span class="math inline">\(\beta_B = 0\)</span>, this simplifies to <span class="math inline">\(\sigma_Z = \sqrt{(\beta_A\sigma_A)^2 + \sigma_{Z.AB}^2}\)</span>, but if you want to simulate your own datasets, the full formula may be useful.</p>
<p>The population standard deviation of <code>Z</code> is thus <span class="math inline">\(\sqrt{(0.7 \times 1.5)^2 + 1.3^2} = 1.67\)</span>. Setting <code>Z</code>’s reliability to 0.70, we find that the standard deviation of the noise is <span class="math inline">\(\sqrt{1.67^2\left(\frac{1}{0.70} - 1\right)} = 1.09\)</span>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_e1204a626b3eecd96247f79a0d28c42e">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Measurement error on Z</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sd_Z <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((slope_A<span class="sc">*</span>sd_A)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="dv">0</span><span class="sc">*</span>slope_B)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>(slope_A <span class="sc">*</span> slope_B <span class="sc">*</span> latent_covariance_matrix[<span class="dv">1</span>,<span class="dv">2</span>]) <span class="sc">+</span> sigma_Z.AB<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>obs_Z <span class="ot">&lt;-</span> Z <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">sd =</span> <span class="fu">sqrt</span>(sd_Z<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">0.70</span> <span class="sc">-</span> <span class="dv">1</span>))) <span class="co"># reliability 0.70</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Figure 3 shows the causal diagram for the actually observed simulated data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_b394453f322b3f8ca32d86842bf19fbc">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption"><strong>Figure 3.</strong> Graphical causal model for the simulated data. <code>A</code>, <code>B</code> and <code>Z</code> are now unobserved (latent) variables, but so-called ‘descendants’ of them were measured. These reflect their latent constructs imperfectly. Crucially, controlling for <code>obs_A</code> will <em>not</em> entirely control for the confound: the path between <code>obs_B</code> and <code>obs_Z</code> stays open.</figcaption>
</figure>
</div>
</div>
</div>
<p>As Figure 4 shows, the observed variables are all correlated with each other.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_fb4953dd85bad18be6321c480436e14f">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot_matrix</span>(<span class="fu">cbind</span>(obs_Z, obs_A, obs_B))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 4.</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>Crucially, controlling for <code>obs_A</code> in a regression model doesn’t entirely eradicate the confound and we find that <code>obs_B</code> is significantly related to <code>obs_Z</code> even after controlling for <code>obs_A</code> (<span class="math inline">\(\widehat{\beta}_{B_{\textrm{obs}}} = 0.40 \pm 0.15\)</span>). Moreover, the regression model on the observed variables underestimates the strength of the relationship between the true construct scores (<span class="math inline">\(\widehat{\beta}_{A_{\textrm{obs}}} = 0.40 \pm 0.07\)</span>, whereas <span class="math inline">\(\beta_A = 0.7\)</span>).</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_0be6c3f6d88b3deff0bfbaf6711674a1">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(obs_Z <span class="sc">~</span> obs_A <span class="sc">+</span> obs_B))<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    4.498     0.7588    5.93 8.49e-09
obs_A          0.402     0.0737    5.45 1.05e-07
obs_B          0.404     0.1470    2.75 6.41e-03</code></pre>
</div>
</div>
</section>
<section id="statistical-model" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model">Statistical model</h3>
<p>The statistical model, written below in Stan code, corresponds to the data generating mechanism above and tries to infer its parameters from the observed data and some prior information.</p>
<p>The <code>data</code> block specifies the input that the model should handle. I think this is self-explanatory. Note that the latent variable scores <code>A</code>, <code>B</code> and <code>Z</code> aren’t part of the input as we wouldn’t have directly observed these.</p>
<p>The <code>parameters</code> block first defines the parameters needed for the regression model with the unobserved latent variables (the one we used to generate <code>Z</code>). It then defines the parameters needed to generate the true variables scores for <code>A</code> and <code>B</code> as well as the parameters needed to generate the observed scores from the true scores (viz., the true scores themselves and the reliabilities). Note that it is crucial to allow the model to estimate a correlation between <code>A</code> and <code>B</code>, otherwise it won’t ‘know’ that <code>A</code> confounds the <code>B</code>-<code>Z</code> relationship.</p>
<p>The <code>transformed parameters</code> block contains, well, transformations of these parameters. For instance, the standard deviations of <code>A</code> and <code>B</code> and the correlation between <code>A</code> and <code>B</code> are used to generate a variance-covariance matrix. Moreover, the standard deviations of the measurement noise are computed using the latent variables’ standard deviation and their reliabilities.</p>
<p>The <code>model</code> block, finally, specifies how we think the observed data and the (transformed or untransformed) parameters fit together and what plausible a priori values for the (transformed or untransformed) parameters are. These prior distributions are pretty abstract in this example: we generated context-free data ourselves, so it’s not clear what motivates these priors. The real example to follow will hopefully make more sense in this respect. You’ll notice that I’ve also specified a prior for the reliabilities. The reason is that you typically don’t know the reliability of an observed variable with perfect precision but that you have sample estimate with some inherent uncertainty. The priors reflect this uncertainty. Again, this will become clearer in the real example to follow.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_f8d94c11b65c3611e99f7dc1cf1b2147">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>meas_error_code <span class="ot">&lt;-</span> <span class="st">'</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">  // Number of observations</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower = 1&gt; N;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">  // Observed outcome</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] obs_Z;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="st">  // Observed predictors</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] obs_A;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] obs_B;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="st">  // Parameters for regression</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real intercept;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="st">  real slope_A;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="st">  real slope_B;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="st">  // Latent predictors (= constructs):</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviations and means</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma_lat_A;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma_lat_B;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="st">  row_vector[2] latent_means;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="st">  // Correlation between latent predictors</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = -1, upper = 1&gt; latent_rho;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="st">  // Latent variables (true scores)</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[N, 2] latent_predictors;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lat_Z; // latent outcome</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="st">  // Unknown but estimated reliabilities</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0, upper = 1&gt; reliability_A;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0, upper = 1&gt; reliability_B;</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0, upper = 1&gt; reliability_Z;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] mu_Z;  // conditional mean of outcome</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lat_A; // latent variables, separated out</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lat_B;</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="st">  real error_A; // standard error of measurement</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="st">  real error_B;</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="st">  real error_Z;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviations of latent predictors, in matrix form</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, 2] sigma_lat;</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="st">  // correlation and covariance matrix for latent predictors</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="st">  cov_matrix[2] latent_cor;</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="st">  cov_matrix[2] latent_cov;</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviation of latent outcome</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma_lat_Z;</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat_Z = sd(lat_Z);</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="st">  // Express measurement error in terms of</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviation of constructs and reliability</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="st">  error_A = sqrt(sigma_lat_A^2*(1/reliability_A - 1));</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="st">  error_B = sqrt(sigma_lat_B^2*(1/reliability_B - 1));</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="st">  error_Z = sqrt(sigma_lat_Z^2*(1/reliability_Z - 1));</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a><span class="st">  // Define diagonal matrix with standard errors of latent variables</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[1, 1] = sigma_lat_A;</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[2, 2] = sigma_lat_B;</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[1, 2] = 0;</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[2, 1] = 0;</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a><span class="st">  // Define correlation matrix for latent variables</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[1, 1] = 1;</span></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[2, 2] = 1;</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[1, 2] = latent_rho;</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[2, 1] = latent_rho;</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="st">  // Compute covariance matrix for latent variables</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cov = sigma_lat * latent_cor * sigma_lat;</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a><span class="st">  // Extract latent variables from matrix</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_A = latent_predictors[, 1];</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_B = latent_predictors[, 2];</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a><span class="st">  // Regression model for conditional mean of Z</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a><span class="st">  mu_Z = intercept + slope_A*lat_A + slope_B*lat_B;</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a><span class="st">  // Priors for regression parameters</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a><span class="st">  intercept ~ normal(0, 2);</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a><span class="st">  slope_A ~ normal(0, 2);</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a><span class="st">  slope_B ~ normal(0, 2);</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ normal(0, 2);</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior for latent standard deviations</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat_A ~ normal(0, 2);</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat_B ~ normal(0, 2);</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior for latent means</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_means ~ normal(0, 3);</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior expectation for correlation between latent variables.</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="st">  // Tend towards positive correlation, but pretty vague.</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_rho ~ normal(0.4, 0.3);</span></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior for reliabilities.</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="st">  // These are estimated with some uncertainty, i.e.,</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a><span class="st">  // they are not point values but distributions.</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a><span class="st">  reliability_A ~ beta(70, 30);</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="st">  reliability_B ~ beta(90, 10);</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a><span class="st">  reliability_Z ~ beta(70, 30);</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a><span class="st">  // Distribution of latent variable</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a><span class="st">    latent_predictors[i, ] ~ multi_normal(latent_means, latent_cov);</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a><span class="st">  // Generate latent outcome</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_Z ~ normal(mu_Z, sigma);</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a><span class="st">  // Add noise to latent variables</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="st">  obs_A ~ normal(lat_A, error_A);</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a><span class="st">  obs_B ~ normal(lat_B, error_B);</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a><span class="st">  obs_Z ~ normal(lat_Z, error_Z);</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a><span class="st">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Put the data in a list and fit the model:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_b44f6b79cb92550bf604a9cb8a2965fb">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_Z =</span> obs_Z,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_A =</span> obs_A,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_B =</span> obs_B,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> n</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_884acfdfc62d8766e6e2eb37f0721207">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>meas_error_model <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">write_stan_file</span>(meas_error_code))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>model_fit <span class="ot">&lt;-</span> meas_error_model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">seed =</span> <span class="dv">123</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  , <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  , <span class="at">parallel_chains =</span> <span class="dv">4</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  , <span class="at">iter_warmup =</span> <span class="dv">1000</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  , <span class="at">iter_sampling =</span> <span class="dv">1000</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  , <span class="at">refresh =</span> <span class="dv">500</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  , <span class="at">max_treedepth =</span> <span class="dv">15</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  , <span class="at">adapt_delta =</span> <span class="fl">0.99</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 279.7 seconds.
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 320.0 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 355.9 seconds.
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 369.9 seconds.

All 4 chains finished successfully.
Mean chain execution time: 331.4 seconds.
Total execution time: 370.0 seconds.</code></pre>
</div>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<!-- ```{r, echo = FALSE} -->
<!-- meas_error_model <- readRDS("measurement_error_model.rds") -->
<!-- ``` -->
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_c1d9c62ec754412d1ce0b1faa4d3e81d">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>model_fit<span class="sc">$</span><span class="fu">summary</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"intercept"</span>, <span class="st">"slope_A"</span>, <span class="st">"slope_B"</span>, <span class="st">"sigma"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">"sigma_lat_A"</span>, <span class="st">"sigma_lat_B"</span>, <span class="st">"sigma_lat_Z"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">"latent_means"</span>, <span class="st">"latent_rho"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                , <span class="st">"reliability_A"</span>, <span class="st">"reliability_B"</span>, <span class="st">"reliability_Z"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">"error_A"</span>, <span class="st">"error_B"</span>, <span class="st">"error_Z"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  , <span class="st">"mean"</span>, <span class="st">"sd"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  , <span class="at">extra_quantiles =</span> <span class="sc">~</span>posterior<span class="sc">::</span><span class="fu">quantile2</span>(., <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  , <span class="st">"rhat"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 6
   variable          mean     sd   q2.5  q97.5  rhat
   &lt;chr&gt;            &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt;
 1 intercept        0.649 1.49   -2.43   3.37   1.02
 2 slope_A          0.866 0.170   0.564  1.22   1.02
 3 slope_B         -0.200 0.254  -0.719  0.265  1.02
 4 sigma            1.17  0.126   0.903  1.40   1.01
 5 sigma_lat_A      1.40  0.0716  1.26   1.54   1.00
 6 sigma_lat_B      0.797 0.0353  0.731  0.869  1.00
 7 sigma_lat_Z      1.59  0.0702  1.45   1.72   1.01
 8 latent_means[1]  3.07  0.0972  2.87   3.26   1.00
 9 latent_means[2] -4.02  0.0486 -4.11  -3.92   1.00
10 latent_rho       0.780 0.0493  0.678  0.871  1.01
11 reliability_A    0.694 0.0408  0.616  0.773  1.02
12 reliability_B    0.901 0.0277  0.843  0.947  1.00
13 reliability_Z    0.699 0.0466  0.600  0.782  1.01
14 error_A          0.925 0.0710  0.785  1.06   1.01
15 error_B          0.262 0.0382  0.191  0.338  1.01
16 error_Z          1.04  0.0872  0.880  1.22   1.01</code></pre>
</div>
</div>
<p>The model recovers the true parameter values pretty well (Table 1) and, on the basis of this model, you wouldn’t erroneously conclude that <code>B</code> is causally related to <code>Z</code> (see the parameter estimate for <code>slope_B</code>).</p>
<table class="table">
<caption><strong>Table 1.</strong> Comparison of the true parameter values and their estimates. Parameters prefixed with ‘*’ are transformations of other parameters. The estimated reliability parameters aren’t really estimated from the data: they just reflect the prior distributions put on them.</caption>
<thead>
<tr class="header">
<th>Parameter</th>
<th style="text-align: right;">True value</th>
<th style="text-align: right;">Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>intercept</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">0.65 ± 1.53</td>
</tr>
<tr class="even">
<td>slope_A</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.87 ± 0.17</td>
</tr>
<tr class="odd">
<td>slope_B</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.20 ± 0.25</td>
</tr>
<tr class="even">
<td>sigma_Z.AB</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.17 ± 0.13</td>
</tr>
<tr class="odd">
<td>sd_A</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">1.40 ± 0.07</td>
</tr>
<tr class="even">
<td>sd_B</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.80 ± 0.04</td>
</tr>
<tr class="odd">
<td>mean_A</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.07 ± 0.10</td>
</tr>
<tr class="even">
<td>mean_B</td>
<td style="text-align: right;">-4.00</td>
<td style="text-align: right;">-4.02 ± 0.05</td>
</tr>
<tr class="odd">
<td>rho</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.78 ± 0.05</td>
</tr>
<tr class="even">
<td>reliability_A</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.69 ± 0.04</td>
</tr>
<tr class="odd">
<td>reliability_B</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.90 ± 0.03</td>
</tr>
<tr class="even">
<td>reliability_Z</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.70 ± 0.05</td>
</tr>
<tr class="odd">
<td>*sd_Z</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">1.59 ± 0.07</td>
</tr>
<tr class="even">
<td>*error_A</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.93 ± 0.07</td>
</tr>
<tr class="odd">
<td>*error_B</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.26 ± 0.04</td>
</tr>
<tr class="even">
<td>*error_Z</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">1.04 ± 0.09</td>
</tr>
</tbody>
</table>
<p>In the previous blog post, I’ve shown that such a model also estimates the latent true variable scores and that these estimates correspond more closely to the actual true variable scores than do the observed variable scores. I’ll skip this step here.</p>
</section>
</section>
<section id="real-life-example-interdependence" class="level2">
<h2 class="anchored" data-anchor-id="real-life-example-interdependence">Real-life example: Interdependence</h2>
<p>Satisfied that our model can recover the actual parameter values in scenarios such as those depicted in Figure 3, we now turn to a real-life example of such a situation. The example was already described in the previous blog post; here I’ll just draw the causal model that assumes that reflects the null hypothesis that a child’s Portuguese skills at T2 (<code>PT.T2</code>) don’t contribute to their French skills at T3 (<code>FR.T3</code>), but that due to common factors such as intelligence, form on the day etc. (<span class="math inline">\(U\)</span>), French skills and Portuguese skills at T2 are correlated across children. What is observed are test scores, not the children’s actual skills.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_556140410eca893f52d083a83f709a45">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption"><strong>Figure 5</strong></figcaption>
</figure>
</div>
</div>
</div>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>The command below is pig-ugly, but allows you to easily read in the data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_de47d2c996aa26b09fe62e410487979d">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>skills <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">list</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Subject =</span> <span class="fu">c</span>(<span class="st">"A_PLF_1"</span>,<span class="st">"A_PLF_10"</span>,<span class="st">"A_PLF_12"</span>,<span class="st">"A_PLF_13"</span>,<span class="st">"A_PLF_14"</span>,<span class="st">"A_PLF_15"</span>,<span class="st">"A_PLF_16"</span>,<span class="st">"A_PLF_17"</span>,<span class="st">"A_PLF_19"</span>,<span class="st">"A_PLF_2"</span>,<span class="st">"A_PLF_3"</span>,<span class="st">"A_PLF_4"</span>,<span class="st">"A_PLF_5"</span>,<span class="st">"A_PLF_7"</span>,<span class="st">"A_PLF_8"</span>,<span class="st">"A_PLF_9"</span>,<span class="st">"AA_PLF_11"</span>,<span class="st">"AA_PLF_12"</span>,<span class="st">"AA_PLF_13"</span>,<span class="st">"AA_PLF_6"</span>,<span class="st">"AA_PLF_7"</span>,<span class="st">"AA_PLF_8"</span>,<span class="st">"AD_PLF_10"</span>,<span class="st">"AD_PLF_11"</span>,<span class="st">"AD_PLF_13"</span>,<span class="st">"AD_PLF_14"</span>,<span class="st">"AD_PLF_15"</span>,<span class="st">"AD_PLF_16"</span>,<span class="st">"AD_PLF_17"</span>,<span class="st">"AD_PLF_18"</span>,<span class="st">"AD_PLF_19"</span>,<span class="st">"AD_PLF_2"</span>,<span class="st">"AD_PLF_20"</span>,<span class="st">"AD_PLF_21"</span>,<span class="st">"AD_PLF_22"</span>,<span class="st">"AD_PLF_24"</span>,<span class="st">"AD_PLF_25"</span>,<span class="st">"AD_PLF_26"</span>,<span class="st">"AD_PLF_4"</span>,<span class="st">"AD_PLF_6"</span>,<span class="st">"AD_PLF_8"</span>,<span class="st">"AD_PLF_9"</span>,<span class="st">"AE_PLF_1"</span>,<span class="st">"AE_PLF_2"</span>,<span class="st">"AE_PLF_4"</span>,<span class="st">"AE_PLF_5"</span>,<span class="st">"AE_PLF_6"</span>,<span class="st">"C_PLF_1"</span>,<span class="st">"C_PLF_16"</span>,<span class="st">"C_PLF_19"</span>,<span class="st">"C_PLF_30"</span>,<span class="st">"D_PLF_1"</span>,<span class="st">"D_PLF_2"</span>,<span class="st">"D_PLF_3"</span>,<span class="st">"D_PLF_4"</span>,<span class="st">"D_PLF_5"</span>,<span class="st">"D_PLF_6"</span>,<span class="st">"D_PLF_7"</span>,<span class="st">"D_PLF_8"</span>,<span class="st">"Y_PNF_12"</span>,<span class="st">"Y_PNF_15"</span>,<span class="st">"Y_PNF_16"</span>,<span class="st">"Y_PNF_17"</span>,<span class="st">"Y_PNF_18"</span>,<span class="st">"Y_PNF_2"</span>,<span class="st">"Y_PNF_20"</span>,<span class="st">"Y_PNF_24"</span>,<span class="st">"Y_PNF_25"</span>,<span class="st">"Y_PNF_26"</span>,<span class="st">"Y_PNF_27"</span>,<span class="st">"Y_PNF_28"</span>,<span class="st">"Y_PNF_29"</span>,<span class="st">"Y_PNF_3"</span>,<span class="st">"Y_PNF_31"</span>,<span class="st">"Y_PNF_32"</span>,<span class="st">"Y_PNF_33"</span>,<span class="st">"Y_PNF_34"</span>,<span class="st">"Y_PNF_36"</span>,<span class="st">"Y_PNF_4"</span>,<span class="st">"Y_PNF_5"</span>,<span class="st">"Y_PNF_6"</span>,<span class="st">"Y_PNF_7"</span>,<span class="st">"Y_PNF_8"</span>,<span class="st">"Y_PNF_9"</span>,<span class="st">"Z_PLF_2"</span>,<span class="st">"Z_PLF_3"</span>,<span class="st">"Z_PLF_4"</span>,<span class="st">"Z_PLF_5"</span>,<span class="st">"Z_PLF_6"</span>,<span class="st">"Z_PLF_7"</span>,<span class="st">"Z_PLF_8"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  , <span class="at">FR_T2 =</span> <span class="fu">c</span>(<span class="fl">0.6842105263</span>,<span class="fl">0.4736842105</span>,<span class="dv">1</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.2631578947</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.2631578947</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.9473684211</span>,<span class="dv">1</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.9473684211</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">PT_T2 =</span> <span class="fu">c</span>(<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.2631578947</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.0526315789</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.5263157895</span>,<span class="dv">1</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8421052632</span>,<span class="dv">1</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.9473684211</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  , <span class="at">FR_T3 =</span> <span class="fu">c</span>(<span class="fl">0.9473684211</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.7894736842</span>,<span class="dv">1</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.5789473684</span>,<span class="dv">1</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.2631578947</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6842105263</span>,<span class="dv">1</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.9473684211</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  , <span class="at">PT_T3 =</span> <span class="fu">c</span>(<span class="fl">0.8421052632</span>,<span class="fl">0.3684210526</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.7894736842</span>,<span class="dv">1</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7368421053</span>,<span class="dv">1</span>,<span class="fl">0.6842105263</span>,<span class="dv">1</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.3157894737</span>,<span class="fl">0.7894736842</span>,<span class="cn">NA</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.9473684211</span>,<span class="dv">1</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.8947368421</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.4736842105</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.2105263158</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7368421053</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.4210526316</span>,<span class="fl">0.6315789474</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.9473684211</span>,<span class="fl">0.5789473684</span>,<span class="fl">0.5263157895</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.7894736842</span>,<span class="fl">0.6842105263</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8421052632</span>,<span class="fl">0.8947368421</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  , <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span>91L)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  , <span class="at">class =</span> <span class="fu">c</span>(<span class="st">"tbl_df"</span>,<span class="st">"tbl"</span>,<span class="st">"data.frame"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="statistical-model-1" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-1">Statistical model</h3>
<p>The only thing that’s changed in the statistical model compared to the example with the simulated data is that I’ve renamed the parameters and that the prior distributions are better motivated. Let’s consider each prior distribution in turn:</p>
<ul>
<li><code>intercept ~ normal(0.2, 0.1);</code>: The intercept is the average true French skill score at T3 for children whose true French and Portuguese skill scores at T2 are 0. This is the lowest possible score (the theoretical range of the data is [0, 1]), so we’d expect such children to perform poorly at T3, too. A <code>normal(0.2, 0.1)</code> distribution puts 95% probability on such children having a true French score at T3 between 0 and 0.4.</li>
<li><code>slope_FR ~ normal(0.5, 0.25);</code>: This parameter expresses the difference between the average true French skill score at T3 for children with a true French skill score of 1 at T2 (the theoretical maximum) vs.&nbsp;those with a true French skill score of 0 at T2 (the theoretical minimum). This is obviously some value between -1 and 1, and presumably it’s going to be positive. A <code>normal(0.5, 0.25)</code> puts 95% probability on this difference lying between 0 and 1, which I think is reasonable.</li>
<li><code>slope_PT ~ normal(0, 0.25);</code>: The slope for Portuguese is bound to be smaller than the one for French. Moreover, it’s not a given that it will be appreciably different from zero. Hence a prior centred on 0 that still gives the data a chance to pull the estimate in either direction.</li>
<li><code>sigma ~ normal(0.15, 0.08);</code>: If neither of the T2 variables predicts T3, uncertainty is highest when the mean T3 score is 0.5. Since these scores are bounded between 0 and 1, the standard deviation could not be much higher than 0.20. But French T2 is bound to be a predictor, so let us choose a slightly lower value (0.15).</li>
<li><code>latent_means ~ normal(0.5, 0.1);</code>: These are the prior expectations for the true score means of the T2 variables. 0.5 lies in the middle of the scale; the <code>normal(0.5, 0.1)</code> prior puts 95% probability on these means to lie between 0.3 and 0.7.</li>
<li><code>sigma_lat_FR_T2 ~ normal(0, 0.25);</code>, <code>sigma_lat_FR_T2 ~ normal(0, 0.25);</code>: The standard deviations of the latent T2 variables. If these truncated normal distributions put a 95% probability of the latent standard deviations to be lower than 0.50.</li>
<li><code>latent_rho ~ normal(0.4, 0.3);</code>: The a priori expected correlation between the latent variables <code>A</code> and <code>B</code>. These are bound to be positively correlated.</li>
<li><code>reliability_FR_T2 ~ beta(100, 100*0.27/0.73);</code> The prior distribution for the reliability of the French T2 variable. Cronbach’s <span class="math inline">\(\alpha\)</span> for this variable was 0.73 (95% CI: [0.65, 0.78]). This roughly corresponds to a <code>beta(100, 100*0.27/0.73)</code> distribution:</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_1ab8e90670e4a8d46e58bb1deabf6c73">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="dv">100</span>, <span class="dv">100</span><span class="sc">*</span><span class="fl">0.27</span><span class="sc">/</span><span class="fl">0.73</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6529105 0.8007296</code></pre>
</div>
</div>
<ul>
<li><code>reliability_PT_T2 ~ beta(120, 120*0.21/0.79);</code> Similarly, Cronbach’s <span class="math inline">\(\alpha\)</span> for the Portuguese T2 variable was 0.79 (95% CI: [0.72, 0.84]), which roughly corresponds to a <code>beta(120, 120*0.21/0.79)</code> distribution:</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_bad62dcd138c83049f5c0685491e1036">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qbeta</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="dv">120</span>, <span class="dv">120</span><span class="sc">*</span><span class="fl">0.21</span><span class="sc">/</span><span class="fl">0.79</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7219901 0.8507814</code></pre>
</div>
</div>
<ul>
<li><code>reliability_FR_T3 ~ beta(73, 27);</code>: The estimated reliability for the French T3 data was similar to that of the T2 data, so I used the same prior.</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-21_332e3f14c9513161a8b4f9958e16100b">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>interdependence_code <span class="ot">&lt;-</span> <span class="st">'</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="st">  // Number of observations</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower = 1&gt; N;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">  // Observed outcome</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] FR_T3;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="st">  // Observed predictors</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] FR_T2;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] PT_T2;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="st">  // Parameters for regression</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real intercept;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="st">  real slope_FR;</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="st">  real slope_PT;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviations of latent predictors (= constructs)</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma_lat_FR_T2;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma_lat_PT_T2;</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="st">  // Means of latent predictors</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="st">  row_vector[2] latent_means;</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="st">  // Unknown correlation between latent predictors</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = -1, upper = 1&gt; latent_rho;</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="st">  // Latent variables</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[N, 2] latent_predictors;</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lat_FR_T3; // latent outcome</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="st">  // Unknown but estimated reliabilities</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0, upper = 1&gt; reliability_FR_T2;</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0, upper = 1&gt; reliability_PT_T2;</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0, upper = 1&gt; reliability_FR_T3;</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] mu_FR_T3;  // conditional mean of outcome</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lat_FR_T2; // latent variables, separated out</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] lat_PT_T2;</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="st">  real error_FR_T2; // standard error of measurement</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="st">  real error_PT_T2;</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="st">  real error_FR_T3;</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviations of latent predictors, in matrix form</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="st">  matrix[2, 2] sigma_lat;</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="st">  // correlation and covariance matrix for latent predictors</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="st">  cov_matrix[2] latent_cor;</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="st">  cov_matrix[2] latent_cov;</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviation of latent outcome</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower = 0&gt; sigma_lat_FR_T3;</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat_FR_T3 = sd(lat_FR_T3);</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a><span class="st">  // Express measurement error in terms of</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a><span class="st">  // standard deviation of constructs and reliability</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a><span class="st">  error_FR_T2 = sqrt(sigma_lat_FR_T2^2*(1/reliability_FR_T2 - 1));</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a><span class="st">  error_PT_T2 = sqrt(sigma_lat_PT_T2^2*(1/reliability_PT_T2 - 1));</span></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a><span class="st">  error_FR_T3 = sqrt(sigma_lat_FR_T3^2*(1/reliability_FR_T3 - 1));</span></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a><span class="st">  // Define diagonal matrix with standard errors of latent variables</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[1, 1] = sigma_lat_FR_T2;</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[2, 2] = sigma_lat_PT_T2;</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[1, 2] = 0;</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat[2, 1] = 0;</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a><span class="st">  // Define correlation matrix for latent variables</span></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[1, 1] = 1;</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[2, 2] = 1;</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[1, 2] = latent_rho;</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cor[2, 1] = latent_rho;</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="st">  // Compute covariance matrix for latent variables</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_cov = sigma_lat * latent_cor * sigma_lat;</span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a><span class="st">  // Extract latent variables from matrix</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_FR_T2 = latent_predictors[, 1];</span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_PT_T2 = latent_predictors[, 2];</span></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a><span class="st">  // Regression model for conditional mean of Z</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="st">  mu_FR_T3 = intercept + slope_FR*lat_FR_T2 + slope_PT*lat_PT_T2;</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a><span class="st">model { </span></span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a><span class="st">  // Priors for regression parameters </span></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a><span class="st">  intercept ~ normal(0.2, 0.1); </span></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="st">  slope_FR ~ normal(0.5, 0.25); </span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a><span class="st">  slope_PT ~ normal(0, 0.25); </span></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ normal(0.15, 0.08); </span></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior for latent means </span></span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_means ~ normal(0.5, 0.1); </span></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior for latent standard deviations </span></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat_FR_T2 ~ normal(0, 0.25); </span></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_lat_PT_T2 ~ normal(0, 0.25); </span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior expectation for correlation between latent variables. </span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a><span class="st">  latent_rho ~ normal(0.4, 0.3); </span></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a><span class="st">  // Prior for reliabilities. </span></span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a><span class="st">  // These are estimated with some uncertainty, i.e., </span></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a><span class="st">  // they are not point values but distributions. </span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a><span class="st">  reliability_FR_T2 ~ beta(100, 100*0.27/0.73); </span></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a><span class="st">  reliability_PT_T2 ~ beta(120, 120*0.21/0.79); </span></span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a><span class="st">  reliability_FR_T3 ~ beta(100, 100*0.27/0.73); </span></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a><span class="st">  // Distribution of latent variable </span></span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) { </span></span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a><span class="st">    latent_predictors[i, ] ~ multi_normal(latent_means, latent_cov); </span></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a><span class="st">  } </span></span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a><span class="st">  // Generate latent outcome </span></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a><span class="st">  lat_FR_T3 ~ normal(mu_FR_T3, sigma); </span></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a><span class="st">  // Measurement model </span></span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a><span class="st">  FR_T2 ~ normal(lat_FR_T2, error_FR_T2); </span></span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a><span class="st">  PT_T2 ~ normal(lat_PT_T2, error_PT_T2); </span></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a><span class="st">  FR_T3 ~ normal(lat_FR_T3, error_FR_T3); </span></span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a><span class="st">} </span></span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a><span class="st">'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_9939ad75b648d9184c2f4d595cdd3aef">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">FR_T2 =</span> skills<span class="sc">$</span>FR_T2,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">PT_T2 =</span> skills<span class="sc">$</span>PT_T2,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FR_T3 =</span> skills<span class="sc">$</span>FR_T3,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(skills<span class="sc">$</span>FR_T3)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>interdependence_model <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="fu">write_stan_file</span>(interdependence_code))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>interdependence_fit <span class="ot">&lt;-</span> interdependence_model<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  , <span class="at">seed =</span> <span class="dv">42</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  , <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  , <span class="at">parallel_chains =</span> <span class="dv">4</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  , <span class="at">iter_warmup =</span> <span class="dv">2000</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  , <span class="at">iter_sampling =</span> <span class="dv">6000</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  , <span class="at">refresh =</span> <span class="dv">1000</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  , <span class="at">max_treedepth =</span> <span class="dv">15</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  , <span class="at">adapt_delta =</span> <span class="fl">0.9999</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 1 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 4 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 2 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 3 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 1 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 1 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 4 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 4 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 2 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 2 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 3 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 3 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 1 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 4 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 1 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 4 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 2 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 1 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 4 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 4 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 1 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 2 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 3 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 4 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 1 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 4 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 4 finished in 261.0 seconds.
Chain 1 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 1 finished in 271.4 seconds.
Chain 2 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 2 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 3 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 2 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 2 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 2 finished in 384.6 seconds.
Chain 3 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 3 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 3 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 3 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 3 finished in 656.3 seconds.

All 4 chains finished successfully.
Mean chain execution time: 393.3 seconds.
Total execution time: 656.4 seconds.</code></pre>
</div>
</div>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-23_01ed6dc0d500fa8a17ee0d6a570a86e3">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>interdependence_fit<span class="sc">$</span><span class="fu">summary</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"intercept"</span>, <span class="st">"slope_FR"</span>, <span class="st">"slope_PT"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                , <span class="st">"sigma"</span>, <span class="st">"latent_rho"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  , <span class="st">"mean"</span>, <span class="st">"sd"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  , <span class="at">extra_quantiles =</span> <span class="sc">~</span>posterior<span class="sc">::</span><span class="fu">quantile2</span>(., <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  , <span class="st">"rhat"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  variable     mean     sd    q2.5 q97.5  rhat
  &lt;chr&gt;       &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt; &lt;num&gt;
1 intercept  0.189  0.0529  0.0848 0.293  1.00
2 slope_FR   0.712  0.154   0.407  1.01   1.00
3 slope_PT   0.107  0.138  -0.165  0.378  1.00
4 sigma      0.0721 0.0182  0.0331 0.106  1.00
5 latent_rho 0.812  0.0781  0.646  0.950  1.00</code></pre>
</div>
</div>
<p>Unsurprisingly, the model confidently finds a link between French skills at T2 and at T3, even on the level of the unobserved true scores (<span class="math inline">\(\widehat{\beta}_{\textrm{French}} = 0.71 \pm 0.15\)</span>). But more importantly, the evidence for an additional effect of Portuguese skills at T2 on French skills at T3 is flimsy (<span class="math inline">\(\widehat{\beta}_{\textrm{Portuguese}} = 0.11 \pm 0.14\)</span>). The latent T2 variables are estimated to correlate strongly at <span class="math inline">\(\widehat{\rho} = 0.81 \pm 0.08\)</span>. These results don’t change much when a flat prior on <span class="math inline">\(\rho\)</span> is specified (this can be accomplished by not specifying any prior at all for <span class="math inline">\(\rho\)</span>). Compared to the model in the previous blog post (Table 2), little has changed. The only appreciable difference is that the estimate for <code>sigma</code> is lower. The reason is that, unlike the previous model, the current model partitions the variance in the French T3 scores into true score variance and measurement error variance. In this model, <code>sigma</code> captures the true score variance that isn’t accounted for by T2 skills, whereas in the previous model, <code>sigma</code> captured the <em>total</em> variance that wasn’t accounted for by T2 skills. But other than that, the current model doesn’t represent a huge change from the previous one.</p>
<table class="table">
<caption><strong>Table 2.</strong> Comparison of parameter estimates between the model fitted in this blog post and the model fitted in the previous one. In the previous model, the outcome was assumed to be perfectly reliable.</caption>
<thead>
<tr class="header">
<th>Parameter</th>
<th style="text-align: right;">Current estimate</th>
<th style="text-align: right;">Previous estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>intercept</td>
<td style="text-align: right;">0.19 ± 0.05</td>
<td style="text-align: right;">0.19 ± 0.05</td>
</tr>
<tr class="even">
<td>slope_FR</td>
<td style="text-align: right;">0.71 ± 0.15</td>
<td style="text-align: right;">0.71 ± 0.16</td>
</tr>
<tr class="odd">
<td>slope_PT</td>
<td style="text-align: right;">0.11 ± 0.14</td>
<td style="text-align: right;">0.10 ± 0.14</td>
</tr>
<tr class="even">
<td>sigma</td>
<td style="text-align: right;">0.07 ± 0.02</td>
<td style="text-align: right;">0.12 ± 0.01</td>
</tr>
<tr class="odd">
<td>latent_rho</td>
<td style="text-align: right;">0.81 ± 0.08</td>
<td style="text-align: right;">0.81 ± 0.08</td>
</tr>
</tbody>
</table>
<p>A couple of things still remain to be done. First, the French test at T3 was the same as the one at T2 so it’s likely that the measurement errors on both scores won’t be completely independent of one another. I’d like to find out how correlated measurement errors affect the parameter estimates. Second, I’d like to get started with prior and posterior predictive checks: the former to check if the priors give rise to largely possible data patterns, and the latter to check if the full model tends to generate data sets similar to the one actually observed.</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Berthele, Raphael and Jan Vanhove. 2017. <a href="https://doi.org/10.1080/13670050.2017.1385590">What would disprove interdependence? Lessons learned from a study on biliteracy in Portuguese heritage language speakers in Switzerland.</a> <em>International Journal of Bilingual Education and Bilingualism</em>.</p>
<p>Brunner, Jerry and Peter C. Austin. 2009. <a href="https://doi.org/10.1002/cjs.10004">Inflation of Type I error rate in multiple regression when independent variables are measured with error.</a> <em>Canadian Journal of Statistics</em> 37(1). 33–46.</p>
<p>Westfall, Jacob and Tal Yarkoni. 2016. <a href="https://doi.org/10.1371/journal.pone.0152719">Statistically controlling for confounding constructs is harder than you think.</a>. <em>PLOS ONE</em> 11(3). e0152719.</p>
</section>
<section id="software-versions" class="level2">
<h2 class="anchored" data-anchor-id="software-versions">Software versions</h2>
<p>Please note that I reran the code on this page on August 6, 2023.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-24_add61e05ab5fb3b39e0f8d97d115fa4a">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.1 (2023-06-16)
 os       Ubuntu 22.04.2 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_US
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Zurich
 date     2023-08-06
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package        * version date (UTC) lib source
 abind            1.4-5   2016-07-21 [1] CRAN (R 4.3.1)
 backports        1.4.1   2021-12-13 [1] CRAN (R 4.3.0)
 boot             1.3-28  2021-05-03 [4] CRAN (R 4.2.0)
 cachem           1.0.6   2021-08-19 [2] CRAN (R 4.2.0)
 callr            3.7.3   2022-11-02 [1] CRAN (R 4.3.1)
 checkmate        2.2.0   2023-04-27 [1] CRAN (R 4.3.1)
 cli              3.6.1   2023-03-23 [1] CRAN (R 4.3.0)
 cmdstanr       * 0.6.0   2023-08-02 [1] local
 colorspace       2.1-0   2023-01-23 [1] CRAN (R 4.3.0)
 crayon           1.5.2   2022-09-29 [1] CRAN (R 4.3.1)
 curl             5.0.1   2023-06-07 [1] CRAN (R 4.3.1)
 dagitty        * 0.3-1   2021-01-21 [1] CRAN (R 4.3.1)
 devtools         2.4.5   2022-10-11 [1] CRAN (R 4.3.1)
 digest           0.6.29  2021-12-01 [2] CRAN (R 4.2.0)
 distributional   0.3.2   2023-03-22 [1] CRAN (R 4.3.1)
 dplyr            1.1.2   2023-04-20 [1] CRAN (R 4.3.0)
 ellipsis         0.3.2   2021-04-29 [2] CRAN (R 4.2.0)
 evaluate         0.15    2022-02-18 [2] CRAN (R 4.2.0)
 fansi            1.0.4   2023-01-22 [1] CRAN (R 4.3.1)
 farver           2.1.1   2022-07-06 [1] CRAN (R 4.3.0)
 fastmap          1.1.0   2021-01-25 [2] CRAN (R 4.2.0)
 fs               1.5.2   2021-12-08 [2] CRAN (R 4.2.0)
 generics         0.1.3   2022-07-05 [1] CRAN (R 4.3.0)
 ggplot2          3.4.2   2023-04-03 [1] CRAN (R 4.3.0)
 glue             1.6.2   2022-02-24 [2] CRAN (R 4.2.0)
 gtable           0.3.3   2023-03-21 [1] CRAN (R 4.3.0)
 htmltools        0.5.5   2023-03-23 [1] CRAN (R 4.3.0)
 htmlwidgets      1.6.2   2023-03-17 [1] CRAN (R 4.3.1)
 httpuv           1.6.11  2023-05-11 [1] CRAN (R 4.3.1)
 jsonlite         1.8.7   2023-06-29 [1] CRAN (R 4.3.1)
 knitr            1.39    2022-04-26 [2] CRAN (R 4.2.0)
 later            1.3.1   2023-05-02 [1] CRAN (R 4.3.1)
 lifecycle        1.0.3   2022-10-07 [1] CRAN (R 4.3.0)
 magrittr         2.0.3   2022-03-30 [1] CRAN (R 4.3.0)
 MASS             7.3-60  2023-05-04 [4] CRAN (R 4.3.1)
 memoise          2.0.1   2021-11-26 [2] CRAN (R 4.2.0)
 mime             0.10    2021-02-13 [2] CRAN (R 4.0.2)
 miniUI           0.1.1.1 2018-05-18 [1] CRAN (R 4.3.1)
 munsell          0.5.0   2018-06-12 [1] CRAN (R 4.3.0)
 pillar           1.9.0   2023-03-22 [1] CRAN (R 4.3.0)
 pkgbuild         1.4.2   2023-06-26 [1] CRAN (R 4.3.1)
 pkgconfig        2.0.3   2019-09-22 [2] CRAN (R 4.2.0)
 pkgload          1.3.2.1 2023-07-08 [1] CRAN (R 4.3.1)
 posterior      * 1.4.1   2023-03-14 [1] CRAN (R 4.3.1)
 prettyunits      1.1.1   2020-01-24 [2] CRAN (R 4.2.0)
 processx         3.8.2   2023-06-30 [1] CRAN (R 4.3.1)
 profvis          0.3.8   2023-05-02 [1] CRAN (R 4.3.1)
 promises         1.2.0.1 2021-02-11 [1] CRAN (R 4.3.1)
 ps               1.7.5   2023-04-18 [1] CRAN (R 4.3.1)
 purrr            1.0.1   2023-01-10 [1] CRAN (R 4.3.0)
 R6               2.5.1   2021-08-19 [2] CRAN (R 4.2.0)
 Rcpp             1.0.11  2023-07-06 [1] CRAN (R 4.3.1)
 remotes          2.4.2   2021-11-30 [2] CRAN (R 4.2.0)
 rlang            1.1.1   2023-04-28 [1] CRAN (R 4.3.0)
 rmarkdown        2.21    2023-03-26 [1] CRAN (R 4.3.0)
 rstudioapi       0.14    2022-08-22 [1] CRAN (R 4.3.0)
 scales           1.2.1   2022-08-20 [1] CRAN (R 4.3.0)
 sessioninfo      1.2.2   2021-12-06 [2] CRAN (R 4.2.0)
 shiny            1.7.4.1 2023-07-06 [1] CRAN (R 4.3.1)
 stringi          1.7.12  2023-01-11 [1] CRAN (R 4.3.1)
 stringr          1.5.0   2022-12-02 [1] CRAN (R 4.3.0)
 tensorA          0.36.2  2020-11-19 [1] CRAN (R 4.3.1)
 tibble           3.2.1   2023-03-20 [1] CRAN (R 4.3.0)
 tidyselect       1.2.0   2022-10-10 [1] CRAN (R 4.3.0)
 urlchecker       1.0.1   2021-11-30 [1] CRAN (R 4.3.1)
 usethis          2.2.2   2023-07-06 [1] CRAN (R 4.3.1)
 utf8             1.2.3   2023-01-31 [1] CRAN (R 4.3.1)
 V8               4.3.0   2023-04-08 [1] CRAN (R 4.3.0)
 vctrs            0.6.3   2023-06-14 [1] CRAN (R 4.3.0)
 xfun             0.39    2023-04-20 [1] CRAN (R 4.3.0)
 xtable           1.8-4   2019-04-21 [1] CRAN (R 4.3.1)
 yaml             2.3.5   2022-02-21 [2] CRAN (R 4.2.0)

 [1] /home/jan/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>