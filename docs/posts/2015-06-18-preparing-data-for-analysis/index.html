<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jan Vanhove">
<meta name="dcterms.date" content="2015-06-18">

<title>Jan Vanhove :: Blog - Some tips on preparing your data for analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jan Vanhove :: Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html" rel="" target="">
 <span class="menu-text">Blog archive</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html" rel="" target="">
 <span class="menu-text">Teaching resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../archive.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#use-self-explanatory-names-and-labels-but-keep-them-short" id="toc-use-self-explanatory-names-and-labels-but-keep-them-short" class="nav-link active" data-scroll-target="#use-self-explanatory-names-and-labels-but-keep-them-short">Use self-explanatory names and labels, but keep them short</a></li>
  <li><a href="#a-long-data-format-is-usually-easier-to-manage-than-a-wide-one" id="toc-a-long-data-format-is-usually-easier-to-manage-than-a-wide-one" class="nav-link" data-scroll-target="#a-long-data-format-is-usually-easier-to-manage-than-a-wide-one">A ‘long’ data format is usually easier to manage than a ‘wide’ one</a></li>
  <li><a href="#managing-several-smallish-datasets-and-then-joining-them-before-the-analysis-is-easier-than-handling-one-large-dataset" id="toc-managing-several-smallish-datasets-and-then-joining-them-before-the-analysis-is-easier-than-handling-one-large-dataset" class="nav-link" data-scroll-target="#managing-several-smallish-datasets-and-then-joining-them-before-the-analysis-is-easier-than-handling-one-large-dataset">Managing several smallish datasets and then joining them before the analysis is easier than handling one large dataset</a></li>
  <li><a href="#reading-tip" id="toc-reading-tip" class="nav-link" data-scroll-target="#reading-tip">Reading tip</a></li>
  <li><a href="#software-versions" id="toc-software-versions" class="nav-link" data-scroll-target="#software-versions">Software versions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Some tips on preparing your data for analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jan Vanhove </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 18, 2015</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>How to prepare your spreadsheets so that they can be analysed efficiently is something you tend to learn on the job. In this blog post, I give some tips for organising datasets that I hope will be of use to students and researchers starting out in quantitative research.</p>
<section id="use-self-explanatory-names-and-labels-but-keep-them-short" class="level2">
<h2 class="anchored" data-anchor-id="use-self-explanatory-names-and-labels-but-keep-them-short">Use self-explanatory names and labels, but keep them short</h2>
<p>Try to minimise the need to consult the project codebook during the analysis. To this end, name your variables and their values sensibly. If you’re analysing questionnaire data, for instance, a variable name like <code>Q3c</code> means little to the analyst and requires them to refer back to the questionnaire or the codebook. Renaming this variable <code>DialectUse</code> makes it immediately clear that the variable likely encodes the degree to which the informant claims to use a dialect.</p>
<p>Similarly, a series of 0s and 1s in the <code>Sex</code> variable is uninformative. Sure, one of them will mean ‘man’ and the other ‘woman’, but which is which? Using the labels <code>man</code> and <code>woman</code> instead avoids any misunderstandings. Also note that values don’t have to be labelled numerically.</p>
<p>Lastly, use a consistent and unambiguous label to identify missing data. <code>NA</code> is usually a good choice, but don’t use <code>0</code> or <code>-99</code> etc. Especially if you’re analysing numeric data, it may not be immediately obvious to the analyst that <code>0</code> or <code>-99</code> don’t refer to actual measurements. (See exercises 2 and 3 on page 77 in my introduction to statistics, if you can read German.)</p>
<p>Transparent variables names and data labels facilitate the analysis because you don’t have to go back and forth between dataset and codebook to make sense of the data. A further benefit is that the code used for the analysis tends to be more readable, even months after the analysis has been conducted.</p>
<p>That said, when coming up with descriptive names and labels, try to keep them short. A variable name like <code>HowOftenDoYouSpeakTheLocalDialectWithYourChild</code> is self-explanatory but cumbersome to type repeatedly when analysing the data. <code>DialectChild</code> might be less self-explanatory but is easier to use.</p>
<p>Lastly, try to keep the following guidelines in mind:</p>
<ul>
<li>
Capitalisation matters. In R, an informant whose <code>Sex</code> is <code>man</code> is of a different gender than one whose <code>Sex</code> is <code>Man</code>. Any such confusions become clear soon enough when analysing the data and they’re pretty easy to take care of. But avoiding them is better for the analyst’s grumpiness level :)
</li>
<li>
Special characters are tricky. German Umlaut characters and French accents may show up without problems on your computer, but may require the manual specification of a character encoding on a different system. Try to either avoid special characters or know which character encoding you saved the dataset in (see the <a href="https://support.office.com/en-ca/article/Choose-text-encoding-when-you-open-and-save-files-60d59c21-88b5-4006-831c-d536d42fd861">MS Office support page</a> for Excel; LibreOffice users can just use the ‘Save as’ function and will be asked which encoding they prefer).
</li>
<li>
Don’t use spaces, question marks or exclamation marks in variable names.
</li>
<li>
Colour-coding is fine for your own use, but the colours get lost when the dataset is imported into a statistics program.
</li>
<li>
<p>‘Empty’ rows or columns may contain lingering spaces that mess up the dataset when it’s imported into a statistics program. By way of example, the csv file <code>FormantMeasurements1.csv</code> (available <a href="http://janhove.github/io/downloads/FormantMeasurements1.csv">here</a>) looks fine when it’s opened in a spreadsheet program:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://janhove.github.io/images/FormantMeasurements1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example superfluous spaces</figcaption>
</figure>
</div>
<p>When the dataset is imported into <code>R</code>, however, there seem to be two additional variables (<code>X</code> and <code>X.1</code>), some missing values (<code>NA</code>) and a <code>Speaker</code> without an ID:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/FormantMeasurements1.csv"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Speaker     Trial            Word          F1               F2        
   : 2   Min.   : 1.00   baat   : 8   Min.   : 197.0   Min.   : 581.9  
 S1:24   1st Qu.: 6.75   biet   : 8   1st Qu.: 278.5   1st Qu.: 899.7  
 S2:24   Median :12.50   buut   : 8   Median : 350.2   Median :1544.8  
 S3:24   Mean   :12.50   daat   : 8   Mean   : 488.0   Mean   :1557.3  
 S4:24   3rd Qu.:18.25   diet   : 8   3rd Qu.: 772.2   3rd Qu.:2309.4  
         Max.   :24.00   duut   : 8   Max.   :1031.1   Max.   :2773.7  
         NA's   :2       (Other):50   NA's   :2        NA's   :2       
    X             X.1         
 Mode:logical   Mode:logical  
 NA's:98        NA's:98       
                              
                              
                              
                              
                              </code></pre>
</div>
</div>
The reason is that there are superfluous spaces in cells D99 and G9.
</li>
<li>
<p>Similarly, a value label with a trailing space will be inconspicuous in your spreadsheet program but will affect how the dataset is read in into your statistics program. The csv file <code>FormantMeasurements2.csv</code> contains the same data as <code>FormantMeasurements1.csv</code>, but when read into <code>R</code>, there seem to be two <code>Speaker</code>s with the same ID (<code>S2</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/FormantMeasurements2.csv"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Speaker      Trial            Word          F1               F2        
 S1 :24   Min.   : 1.00   baat   : 8   Min.   : 197.0   Min.   : 581.9  
 S2 :23   1st Qu.: 6.75   biet   : 8   1st Qu.: 278.5   1st Qu.: 899.7  
 S2 : 1   Median :12.50   buut   : 8   Median : 350.2   Median :1544.8  
 S3 :24   Mean   :12.50   daat   : 8   Mean   : 488.0   Mean   :1557.3  
 S4 :24   3rd Qu.:18.25   diet   : 8   3rd Qu.: 772.2   3rd Qu.:2309.4  
          Max.   :24.00   duut   : 8   Max.   :1031.1   Max.   :2773.7  
                          (Other):48                                    </code></pre>
</div>
</div>
<p>The reason is that there’s a trailing space in cell A28.</p>
<p>Less obvious (because it doesn’t show up in the <code>summary()</code> output) is that there’s also a superfluous space in the <code>Word</code> column (the carrier word <code>tiet</code> occurs twice, once with and once without trailing space):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat<span class="sc">$</span>Word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "baat"  "biet"  "buut"  "daat"  "diet"  "duut"  "paat"  "piet"  "puut" 
[10] "taat"  "tiet"  "tiet " "tuut" </code></pre>
</div>
</div>
<p>As you can check for yourself, the trailing space is in cell C2.</p>
Problems like inconsistent capitalisation or trailing spaces are pretty easy to fix when you know they’re there, but they aren’t always obvious.
</li>
</ul>
</section>
<section id="a-long-data-format-is-usually-easier-to-manage-than-a-wide-one" class="level2">
<h2 class="anchored" data-anchor-id="a-long-data-format-is-usually-easier-to-manage-than-a-wide-one">A ‘long’ data format is usually easier to manage than a ‘wide’ one</h2>
<p>An example of a ‘wide’ dataset is <code>Cognates_wide.csv</code> (available <a href="http://janhove.github.io/downloads/Cognates_wide.csv">here</a>). The column <code>Subject</code> contains the participants’ IDs and every other column expresses whether the participant translated a given stimulus (e.g.&nbsp;‘ägg’, ‘alltid’, ‘äta’ etc.) correctly. Every participant has their own row:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/Cognates_wide.csv"</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Subject agg alltid alska ata avskaffa bäbis bakgrund barn behärska bliva
1      64   0      0     1   1        0     0        1    0        0     0
2      78   0      0     0   0        0     0        1    0        0     0
3     134   0      0     0   0        0     0        1    0        0     0
4     230   0      0     0   0        0     0        1    0        0     0
5     288   0      0     0   0        0     0        1    0        0     0
6     326   0      0     0   0        0     1        1    1        0     0
  blomma borgmästare borja branna butelj byrå choklad cyckel egenskap elev
1      1           0     0      1      0    0       0      0        0    0
2      1           0     0      1      0    0       0      1        0    0
3      1           0     0      1      0    0       0      0        0    0
4      0           1     0      1      0    0       0      0        0    0
5      0           0     0      1      0    0       0      0        0    0
6      1           0     0      1      0    0       0      1        0    1
  ensam fåtölj fiende flicka fonster försiktig forsoka forst forsvinna
1     0      0      1      0       1         1       0     0         1
2     0      0      0      0       1         1       0     0         1
3     1      0      0      0       1         0       0     0         1
4     0      0      1      0       1         1       0     0         1
5     0      0      0      0       1         1       0     0         0
6     0      0      1      0       1         1       0     0         1
  förutsättning fotboll fraga frasch full ga grupp hård häst hemlig ingenjor
1             1       1     1      1    1  1     0    1    0      0        1
2             0       1     1      1    1  1     0    1    0      0        1
3             0       1     0      1    0  0     1    0    0      1        1
4             0       1     1      0    1  0     0    1    0      0        1
5             0       1     0      0    0  0     0    1    0      0        1
6             0       1     0      1    1  0     0    1    0      0        1
  intryck is kagel kanel karnkraftverk kejsar kniv konst korruption kung kyrka
1       0  0     0     0             0      0    1     1          0    0     1
2       0  0     0     0             1      0    1     1          0    0     1
3       0  0     0     0             1      0    1     1          0    0     0
4       0  0     0     0             0      1    1     1          0    0     1
5       0  0     0     0             1      0    0     1          0    0     0
6       0  0     0     0             1      1    0     1          0    0     1
  kyssa lang larm leka löpa markvardig mjölk möjlig mycket nackdel öppna ost
1     1    1    1    0    0          1     0      0      0       0     1   1
2     1    1    0    0    0          0     1      0      0       0     1   1
3     0    0    1    0    0          1     1      0      0       1     1   1
4     1    1    0    0    0          0     1      1      0       0     1   1
5     0    0    1    0    0          1     0      0      0       0     0   0
6     1    1    0    0    0          1     1      0      0       0     0   1
  overraska översätta paraply passiv potatis rådhus rytmisk saliv sitta
1         0         0       1      1       1      1       1     1     1
2         0         0       1      1       1      1       1     0     1
3         0         1       1      1       1      1       1     0     1
4         0         0       1      0       0      1       1     0     1
5         0         0       0      1       0      0       0     0     0
6         0         0       0      1       1      1       1     0     1
  sjalvstandig skarm skola skön skriva skrubba skyskrapa smart smink söka
1            1     0     1    1      0       1         1     1     0    0
2            0     0     1    0      0       0         0     0     1    0
3            1     0     0    0      0       0         1     0     1    0
4            0     0     1    0      0       0         1     1     0    1
5            1     0     0    0      0       0         1     1     0    0
6            0     0     1    1      0       0         0     1     1    0
  spegel språk städa stjärn sverige tanka tårta torsdag trakig tunga tvivla
1      1     1     0      0       0     1     1       1      0     0      1
2      1     1     0      1       0     0     1       0      0     0      0
3      0     0     0      1       0     1     0       1      0     0      0
4      1     1     0      1       0     0     1       1      0     0      0
5      1     0     0      1       0     0     0       1      0     0      0
6      1     1     0      1       0     1     1       1      0     1      0
  tydlig ursprung värld varm vaxla viktig ytterst
1      0        1     0    1     1      1       0
2      0        1     0    1     1      1       0
3      0        1     0    1     1      0       0
4      0        1     0    1     0      1       0
5      0        0     0    1     1      1       0
6      0        1     0    1     1      1       0</code></pre>
</div>
</div>
<p>In a ‘long’ dataset (e.g.&nbsp;<code>Cognates_long.csv</code>), the data are arranged differently, typically with one row per ‘observation unit’:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/Cognates_long.csv"</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat); <span class="fu">tail</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Subject Stimulus Correct
1    1034      agg       0
2    2151      agg       0
3    9022      agg       0
4    7337      agg       0
5    8477      agg       0
6    6544      agg       0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      Subject Stimulus Correct
16295    5290  ytterst       0
16296    3125  ytterst       0
16297    4137  ytterst       0
16298    1967  ytterst       0
16299    8942  ytterst       0
16300    9913  ytterst       0</code></pre>
</div>
</div>
<p>I prefer long datasets for the following reasons:</p>
<ul>
<li><p>The statistical tools I usually work with (mixed-effects models) require data in a long format.</p></li>
<li><p>It’s easier to add information to a long than to a wide dataset. For instance, if I wanted to add the order in which the participants saw the stimuli to the wide format, I’d have to add 100 columns to save the trial numbers (i.e.&nbsp;<code>aggTrial</code>, <code>alltidTrial</code> etc.). I’d only have to add one column (<code>Trial</code>) in the case of long data.</p></li>
<li><p>While wide datasets are useful for analytical techniques such as principal component analysis, factor analysis or structural equation modeling as well as paired t-tests, I find it easier to convert a long dataset to a wide dataset than vice versa, especially if the dataset contains additional information about the stimuli or trials.</p></li>
</ul>
<p>A useful package for converting long data to wide data and vice versa is <code>reshape2</code>, whose use is helpfully explained by <a href="http://seananderson.ca/2013/10/19/reshape.html">Sean Anderson</a>.</p>
</section>
<section id="managing-several-smallish-datasets-and-then-joining-them-before-the-analysis-is-easier-than-handling-one-large-dataset" class="level2">
<h2 class="anchored" data-anchor-id="managing-several-smallish-datasets-and-then-joining-them-before-the-analysis-is-easier-than-handling-one-large-dataset">Managing several smallish datasets and then joining them before the analysis is easier than handling one large dataset</h2>
<p>Complex datasets often contain repeated data. For instance, we could add the participants’ age to <code>Cognates_long.csv</code> above, but we’d have to repeat each participant’s age 100 times. Similarly, we could add information about the stimuli to <code>Cognates_long.csv</code> (e.g.&nbsp;their length in phonemes), but we’d have to repeat each stimulus’s length 163 times (once for each participant). In such cases, I find it easiest to compile several smaller datasets with as little information repeated as possible and to combine them when needed. That way, if I make a mistake when entering the data, I’ll only have to correct it once and then recombine the datasets.</p>
<p>Here’s an illustration of what I mean. The participants’ accuracy per stimulus is stored in <code>Cognates_long.csv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/Cognates_long.csv"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Background information about the participants is available in <code>ParticipantInformation.csv</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>participants <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/ParticipantInformation.csv"</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(participants)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Subject         Sex          Age            NrLang         DS.Span     
 Min.   :  64   female:90   Min.   :10.00   Min.   :1.000   Min.   :2.000  
 1st Qu.:2990   male  :73   1st Qu.:16.00   1st Qu.:2.000   1st Qu.:4.000  
 Median :5731               Median :39.00   Median :3.000   Median :4.000  
 Mean   :5317               Mean   :40.28   Mean   :3.067   Mean   :4.613  
 3rd Qu.:7769               3rd Qu.:59.50   3rd Qu.:4.000   3rd Qu.:5.000  
 Max.   :9913               Max.   :86.00   Max.   :9.000   Max.   :8.000  
                                                                           
    DS.Total          GmVoc           Raven       EnglishScore  
 Min.   : 2.000   Min.   : 4.00   Min.   : 0.0   Min.   : 3.00  
 1st Qu.: 5.000   1st Qu.:29.00   1st Qu.:12.0   1st Qu.:20.75  
 Median : 6.000   Median :34.00   Median :19.0   Median :31.00  
 Mean   : 6.374   Mean   :30.24   Mean   :17.8   Mean   :28.30  
 3rd Qu.: 7.500   3rd Qu.:36.00   3rd Qu.:24.0   3rd Qu.:37.00  
 Max.   :12.000   Max.   :41.00   Max.   :35.0   Max.   :44.00  
                  NA's   :1                      NA's   :3      </code></pre>
</div>
</div>
<p>The entries in the <code>Subject</code> column in <code>Cognates_long.csv</code> correspond to those in the same column in <code>ParticipantInformation.csv</code>. Using <code>merge()</code>, we can add the information in the latter dataset to the corresponding rows in the former:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">merge</span>(dat, participants, <span class="st">"Subject"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat); <span class="fu">tail</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Subject      Stimulus Correct    Sex Age NrLang DS.Span DS.Total GmVoc Raven
1      64         forst       0 female  27      4       6        7    34    28
2      64          löpa       0 female  27      4       6        7    34    28
3      64           ost       1 female  27      4       6        7    34    28
4      64         tunga       0 female  27      4       6        7    34    28
5      64 förutsättning       1 female  27      4       6        7    34    28
6      64         ensam       0 female  27      4       6        7    34    28
  EnglishScore
1           42
2           42
3           42
4           42
5           42
6           42</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      Subject  Stimulus Correct    Sex Age NrLang DS.Span DS.Total GmVoc Raven
16295    9913     grupp       1 female  40      3       5        8    29    17
16296    9913      kung       0 female  40      3       5        8    29    17
16297    9913     städa       0 female  40      3       5        8    29    17
16298    9913     tanka       1 female  40      3       5        8    29    17
16299    9913 skyskrapa       0 female  40      3       5        8    29    17
16300    9913   rytmisk       0 female  40      3       5        8    29    17
      EnglishScore
16295           17
16296           17
16297           17
16298           17
16299           17
16300           17</code></pre>
</div>
</div>
<p>Similarly, we can add information about the stimuli, available in <code>StimulusInformation.csv</code>, to <code>dat</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stimuli <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://janhove.github.io/downloads/StimulusInformation.csv"</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stimuli)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Stimulus      Status      Duration          Swedish          German  
 agg     : 1   profile:10   Min.   : 516.0   2st     : 1   abschaffen: 1  
 alltid  : 1   target :90   1st Qu.: 708.8   2v@raska: 1   ai        : 1  
 alska   : 1                Median : 869.5   alltid  : 1   aig@nSaft : 1  
 ata     : 1                Mean   : 843.4   avskaffa: 1   aindruk   : 1  
 avskaffa: 1                3rd Qu.: 929.8   b2rja   : 1   ainzam    : 1  
 bäbis   : 1                Max.   :1264.0   babis   : 1   (Other)   :75  
 (Other) :94                NA's   :50       (Other) :94   NA's      :20  
       English        French       LevGer           LevEng      
 @larm     : 1   alarm   : 1   Min.   :0.1429   Min.   :0.0000  
 ais       : 1   bebe    : 1   1st Qu.:0.4000   1st Qu.:0.4000  
 b2rn      : 1   bureau  : 1   Median :0.5000   Median :1.0000  
 baby      : 1   butEj   : 1   Mean   :0.5859   Mean   :0.6997  
 background: 1   cannelle: 1   3rd Qu.:0.8333   3rd Qu.:1.0000  
 (Other)   :42   (Other) :18   Max.   :1.0000   Max.   :1.0000  
 NA's      :53   NA's    :77                                    
     LevFre         FreqGerman        FreqEnglish       FreqFrench   
 Min.   :0.0000   Min.   :   0.000   Min.   :   0.0   Min.   :    0  
 1st Qu.:1.0000   1st Qu.:   0.932   1st Qu.:   0.0   1st Qu.:    0  
 Median :1.0000   Median :  20.020   Median :   0.0   Median :    0  
 Mean   :0.8529   Mean   : 109.714   Mean   : 119.4   Mean   :  237  
 3rd Qu.:1.0000   3rd Qu.:  60.138   3rd Qu.:  43.6   3rd Qu.:    0  
 Max.   :1.0000   Max.   :3460.090   Max.   :3793.0   Max.   :22823  
                                                                     </code></pre>
</div>
</div>
<p>The shared denominator of both datasets is stored in the column <code>Stimulus</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">merge</span>(dat, stimuli, <span class="st">"Stimulus"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat); <span class="fu">tail</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Stimulus Subject Correct    Sex Age NrLang DS.Span DS.Total GmVoc Raven
1      agg    7479       0   male  25      4       8       11    38    34
2      agg    7337       0 female  49      3       4        5    36    19
3      agg    2846       0 female  11      3       4        6     4    15
4      agg    5153       0 female  51      3       4        6    37    18
5      agg    6510       0 female  41      2       5        8    34    30
6      agg    6329       0 female  56      3       5        6    37    21
  EnglishScore Status Duration Swedish German English French LevGer LevEng
1           43 target      547      Eg     ai      Eg   &lt;NA&gt;      1      0
2           30 target      547      Eg     ai      Eg   &lt;NA&gt;      1      0
3            6 target      547      Eg     ai      Eg   &lt;NA&gt;      1      0
4           37 target      547      Eg     ai      Eg   &lt;NA&gt;      1      0
5           40 target      547      Eg     ai      Eg   &lt;NA&gt;      1      0
6           42 target      547      Eg     ai      Eg   &lt;NA&gt;      1      0
  LevFre FreqGerman FreqEnglish FreqFrench
1      1      24.06       26.04          0
2      1      24.06       26.04          0
3      1      24.06       26.04          0
4      1      24.06       26.04          0
5      1      24.06       26.04          0
6      1      24.06       26.04          0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      Stimulus Subject Correct    Sex Age NrLang DS.Span DS.Total GmVoc Raven
16295  ytterst    1350       0   male  43      4       7       10    38    31
16296  ytterst    7337       0 female  49      3       4        5    36    19
16297  ytterst    8578       0   male  11      2       4        6     9    20
16298  ytterst     717       0 female  15      2       5        6    29    21
16299  ytterst    8805       0   male  70      4       4        4    35    22
16300  ytterst    9912       0   male  10      2       4        4     9    14
      EnglishScore Status Duration Swedish   German English French LevGer
16295           38 target       NA ytterst ausserst    &lt;NA&gt;   &lt;NA&gt;    0.5
16296           30 target       NA ytterst ausserst    &lt;NA&gt;   &lt;NA&gt;    0.5
16297           17 target       NA ytterst ausserst    &lt;NA&gt;   &lt;NA&gt;    0.5
16298           25 target       NA ytterst ausserst    &lt;NA&gt;   &lt;NA&gt;    0.5
16299           35 target       NA ytterst ausserst    &lt;NA&gt;   &lt;NA&gt;    0.5
16300            9 target       NA ytterst ausserst    &lt;NA&gt;   &lt;NA&gt;    0.5
      LevEng LevFre FreqGerman FreqEnglish FreqFrench
16295      1      1      23.19           0          0
16296      1      1      23.19           0          0
16297      1      1      23.19           0          0
16298      1      1      23.19           0          0
16299      1      1      23.19           0          0
16300      1      1      23.19           0          0</code></pre>
</div>
</div>
</section>
<section id="reading-tip" class="level2">
<h2 class="anchored" data-anchor-id="reading-tip">Reading tip</h2>
<p>Hadley Wickham’s <a href="http://vita.had.co.nz/papers/tidy-data.pdf"><em>Tidy data</em></a>, while primarily geared towards software developers, is well worth a read.</p>
</section>
<section id="software-versions" class="level2">
<h2 class="anchored" data-anchor-id="software-versions">Software versions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.1 (2023-06-16)
 os       Ubuntu 22.04.3 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_US
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Zurich
 date     2023-08-26
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version date (UTC) lib source
 cachem        1.0.6   2021-08-19 [2] CRAN (R 4.2.0)
 callr         3.7.3   2022-11-02 [1] CRAN (R 4.3.1)
 cli           3.6.1   2023-03-23 [1] CRAN (R 4.3.0)
 crayon        1.5.2   2022-09-29 [1] CRAN (R 4.3.1)
 devtools      2.4.5   2022-10-11 [1] CRAN (R 4.3.1)
 digest        0.6.29  2021-12-01 [2] CRAN (R 4.2.0)
 ellipsis      0.3.2   2021-04-29 [2] CRAN (R 4.2.0)
 evaluate      0.15    2022-02-18 [2] CRAN (R 4.2.0)
 fastmap       1.1.0   2021-01-25 [2] CRAN (R 4.2.0)
 fs            1.5.2   2021-12-08 [2] CRAN (R 4.2.0)
 glue          1.6.2   2022-02-24 [2] CRAN (R 4.2.0)
 htmltools     0.5.5   2023-03-23 [1] CRAN (R 4.3.0)
 htmlwidgets   1.6.2   2023-03-17 [1] CRAN (R 4.3.1)
 httpuv        1.6.11  2023-05-11 [1] CRAN (R 4.3.1)
 jsonlite      1.8.7   2023-06-29 [1] CRAN (R 4.3.1)
 knitr         1.39    2022-04-26 [2] CRAN (R 4.2.0)
 later         1.3.1   2023-05-02 [1] CRAN (R 4.3.1)
 lifecycle     1.0.3   2022-10-07 [1] CRAN (R 4.3.0)
 magrittr      2.0.3   2022-03-30 [1] CRAN (R 4.3.0)
 memoise       2.0.1   2021-11-26 [2] CRAN (R 4.2.0)
 mime          0.10    2021-02-13 [2] CRAN (R 4.0.2)
 miniUI        0.1.1.1 2018-05-18 [1] CRAN (R 4.3.1)
 pkgbuild      1.4.2   2023-06-26 [1] CRAN (R 4.3.1)
 pkgload       1.3.2.1 2023-07-08 [1] CRAN (R 4.3.1)
 prettyunits   1.1.1   2020-01-24 [2] CRAN (R 4.2.0)
 processx      3.8.2   2023-06-30 [1] CRAN (R 4.3.1)
 profvis       0.3.8   2023-05-02 [1] CRAN (R 4.3.1)
 promises      1.2.0.1 2021-02-11 [1] CRAN (R 4.3.1)
 ps            1.7.5   2023-04-18 [1] CRAN (R 4.3.1)
 purrr         1.0.1   2023-01-10 [1] CRAN (R 4.3.0)
 R6            2.5.1   2021-08-19 [2] CRAN (R 4.2.0)
 Rcpp          1.0.11  2023-07-06 [1] CRAN (R 4.3.1)
 remotes       2.4.2   2021-11-30 [2] CRAN (R 4.2.0)
 rlang         1.1.1   2023-04-28 [1] CRAN (R 4.3.0)
 rmarkdown     2.21    2023-03-26 [1] CRAN (R 4.3.0)
 rstudioapi    0.14    2022-08-22 [1] CRAN (R 4.3.0)
 sessioninfo   1.2.2   2021-12-06 [2] CRAN (R 4.2.0)
 shiny         1.7.4.1 2023-07-06 [1] CRAN (R 4.3.1)
 stringi       1.7.12  2023-01-11 [1] CRAN (R 4.3.1)
 stringr       1.5.0   2022-12-02 [1] CRAN (R 4.3.0)
 urlchecker    1.0.1   2021-11-30 [1] CRAN (R 4.3.1)
 usethis       2.2.2   2023-07-06 [1] CRAN (R 4.3.1)
 vctrs         0.6.3   2023-06-14 [1] CRAN (R 4.3.0)
 xfun          0.39    2023-04-20 [1] CRAN (R 4.3.0)
 xtable        1.8-4   2019-04-21 [1] CRAN (R 4.3.1)
 yaml          2.3.5   2022-02-21 [2] CRAN (R 4.2.0)

 [1] /home/jan/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>