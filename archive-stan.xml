<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Jan Vanhove :: Blog</title>
<link>https://janhove.github.io/archive.html#category=Stan</link>
<atom:link href="https://janhove.github.io/archive-stan.xml" rel="self" type="application/rss+xml"/>
<description>I blog about statistics and research design with an audience consisting of researchers in bilingualism, multilingualism, and applied linguistics in mind.</description>
<generator>quarto-1.3.433</generator>
<lastBuildDate>Mon, 17 Feb 2020 23:00:00 GMT</lastBuildDate>
<item>
  <title>Baby steps in Bayes: Incorporating reliability estimates in regression models</title>
  <dc:creator>Jan Vanhove</dc:creator>
  <link>https://janhove.github.io/posts/2020-02-18-measurement-error/index.html</link>
  <description><![CDATA[ 



<p>Researchers sometimes calculate reliability indices such as Cronbach’s <img src="https://latex.codecogs.com/png.latex?%5Calpha"> or Revelle’s <img src="https://latex.codecogs.com/png.latex?%5Comega_T">, but their statistical models rarely take these reliability indices into account. Here I want to show you how you can incorporate information about the reliability about your measurements in a statistical model so as to obtain more honest and more readily interpretable parameter estimates.</p>
<section id="reliability-and-measurement-error" class="level2">
<h2 class="anchored" data-anchor-id="reliability-and-measurement-error">Reliability and measurement error</h2>
<p>This blog post is the sequel to the <a href="../2020-01-21-statistical-control-measurement-error">previous</a> one, where I demonstrated how imperfectly measured control variables undercorrect for the actual confounding in observational studies (also see Berthele &amp; Vanhove 2017; Brunner &amp; Austin 2009; Westfall &amp; Yarkoni 2016). A model that doesn’t account for measurement error on the confounding variable—and hence implicitly assumes that the confound was measured perfectly—may confidently conclude that the variable of actual interest is related to the outcome even when taking into account the confound. From such a finding, researchers typically infer that the variable of actual interest is causally related to the outcome even in absence of the confound. But once this measurement error is duly accounted for, you may find that the evidence for a causal link between the variable of interest and the outcome is more tenuous than originally believed.</p>
<p>So especially in observational studies, where confounds abound, it behooves researchers to account for the measurement error in their variables so that they don’t draw unwarranted conclusions from their data too often. The amount of measurement error on your variables is usually unknown. But if you’ve calculated some reliability estimate such as Cronbach’s <img src="https://latex.codecogs.com/png.latex?%5Calpha"> for your variables, you can use this to obtain an estimate of the amount of measurement error.</p>
<p>To elaborate, in classical test theory, the reliability <img src="https://latex.codecogs.com/png.latex?%5Crho_%7BXX'%7D"> of a measure is equal to the ratio of the variance of the (error-free) true scores to the variance of the observed scores. The latter is the sum of the variance of the true scores and the error variance:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Crho_%7BXX'%7D%20=%20%5Cfrac%7B%5Ctextrm%7Btrue%20score%20variance%7D%7D%7B%5Ctextrm%7Btrue%20score%20variance%7D%20+%20%5Ctextrm%7Bmeasurement%20error%20variance%7D%7D%20=%20%5Cfrac%7B%5Csigma%5E2_T%7D%7B%5Csigma%5E2_T%20+%20%5Csigma%5E2_E%7D.%0A"></p>
<p>Rearranging, we get</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma%5E2_E%20=%20%5Csigma%5E2_T%5Cleft(%5Cfrac%7B1%7D%7B%5Crho_%7BXX'%7D%7D-1%5Cright).%0A"></p>
<p>None of these values are known, but they can be estimated based on the sample. Specifically, <img src="https://latex.codecogs.com/png.latex?%5Crho_%7BXX'%7D"> can be estimated by a reliability index such as Cronbach’s <img src="https://latex.codecogs.com/png.latex?%5Calpha"> and the sum <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_T%20+%20%5Csigma%5E2_E"> can be estimated by computing the variable’s sample variance.</p>
</section>
<section id="a-simulated-example" class="level2">
<h2 class="anchored" data-anchor-id="a-simulated-example">A simulated example</h2>
<p>Let’s first deal with a simulated dataset. The main advantage of analysing simulated data is that you check that what comes out of the model corresponds to what went into the data. In preparing this blog post, I was able to detect an arithmetic error in my model code in this way as one parameter was consistently underestimated. Had I applied the model immediately to the real data set, I wouldn’t have noticed anything wrong. But we’ll deal with real data afterwards.</p>
<p><strong>Update (2023-08-06):</strong> When converting this blog from Jekyll/Bootstrap to Quarto, I noticed that the original code used in this blog post, which involved the R package <code>rstan</code> has started to run very slowly. In the present version, I use <code>cmdstanr</code> instead.</p>
<p>Run these commands to follow along:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_3b78b3893311250fd4a8322deb111456">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cmdstanr)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for fitting Bayesian models, v. 2.32.2</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(posterior) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for working with posterior distributions</span></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For drawing scatterplot matrices</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://janhove.github.io/RCode/scatterplot_matrix.R"</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed for reproducibility</span></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020-02-13</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kind =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mersenne-Twister"</span>)</span></code></pre></div>
</div>
<section id="generating-the-construct-scores" class="level3">
<h3 class="anchored" data-anchor-id="generating-the-construct-scores">Generating the construct scores</h3>
<p>The scenario we’re going to simulate is one in which you have two correlated predictor variables (<code>A</code> and <code>B</code>) and one outcome variable (<code>Z</code>). Unbeknownst to the analyst, <code>Z</code> is causally affected by <code>A</code> but not by <code>B</code>. Moreover, the three variables are measured with some degree of error, but we’ll come to that later. Figure 1 depicts the scenario for which we’re going to simulate data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_49f3c42090373fe1c15810501775917b">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-02-18-measurement-error/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> Graphical causal model for the simulated data. A set of unobserved factors <img src="https://latex.codecogs.com/png.latex?U"> gives rise to a correlation between <code>A</code> and <code>B</code>. Even though only <code>A</code> causally affects <code>Z</code>, an association between <code>B</code> and <code>Z</code> will be found unless <code>A</code> is controlled for.</figcaption>
</figure>
</div>
</div>
</div>
<p>The first thing we need are two correlated predictor variables. I’m going to generate these from a bivariate normal distribution. <code>A</code> has a mean of 3 units and a standard deviation of 1.5 units, and <code>B</code> has mean -4 and standard deviation 0.8 units. The correlation between them is <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%200.73">. To generate a sample from this bivariate normal distribution, you need to construct the variance-covariance matrix from the standard deviations and correlation, which I do in the code below:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_2ededbcc036052d50d0f9bcceca4b026">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate correlated constructs</span></span>
<span id="cb2-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb2-3">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.73</span></span>
<span id="cb2-4">mean_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb2-5">mean_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb2-6">sd_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span></span>
<span id="cb2-7">sd_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Given the correlation and the standard deviations,</span></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># construct the variance-covariance matrix for the constructs like so:</span></span>
<span id="cb2-11">latent_covariance_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sd_A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sd_B)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, rho), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rho, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sd_A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sd_B))</span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Draw data from the multivariate normal distribution:</span></span>
<span id="cb2-16">constructs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MASS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mvrnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_A, mean_B),</span>
<span id="cb2-17">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sigma =</span> latent_covariance_matrix)</span>
<span id="cb2-18"></span>
<span id="cb2-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract variables from object</span></span>
<span id="cb2-20">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> constructs[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb2-21">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> constructs[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span></code></pre></div>
</div>
<p>Next, we need to generate the outcome. In this simulation, <code>Z</code> depends linearly on <code>A</code> but not on <code>B</code> (hence ‘<img src="https://latex.codecogs.com/png.latex?0%20%5Ctimes%20B_i">’).</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AZ_i%20=%202%20+%200.7%20%5Ctimes%20A_i%20+%200%20%5Ctimes%20B_i%20+%20%5Cvarepsilon_i.%0A"></p>
<p>The error term <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon"> is drawn from a normal distribution with standard deviation 1.3. Importantly, this error term does <em>not</em> express the measurement error on <code>Z</code>; it is the part of the true score variance in <code>Z</code> that isn’t related to either <code>A</code> or <code>B</code>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cvarepsilon_i%20%5Csim%20%5Ctextrm%7BNormal%7D(0,%201.3).%0A"></p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_a2ce4ac0075cad7fe5b92c76fc412211">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create Z</span></span>
<span id="cb3-2">intercept <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb3-3">slope_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb3-4">slope_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-5">sigma_Z.AB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span></span>
<span id="cb3-6">Z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> intercept <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> slope_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> slope_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma_Z.AB)</span></code></pre></div>
</div>
<p>Even though <code>B</code> isn’t causally related to <code>Z</code>, we find that <code>B</code> and <code>Z</code> are correlated thanks to <code>B</code>’s correlation to <code>A</code>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_22544f7e184f625a320c08b3fc5bd5a2">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scatterplot_matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(Z, A, B))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-02-18-measurement-error/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 2.</strong> <code>B</code> is causally unrelated to <code>Z</code>, but these two variables are still correlated because <code>B</code> correlates with <code>A</code> and <code>A</code> and <code>Z</code> are causally related.</figcaption>
</figure>
</div>
</div>
</div>
<p>A multiple regression model is able to tease apart the effects of <code>A</code> and <code>B</code> on <code>Z</code>:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_19c36b77507eb89daab45f4aca27f09d">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> B))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)   2.1224     0.7130   2.977 3.15e-03
A             0.6876     0.0706   9.742 1.22e-19
B             0.0196     0.1340   0.146 8.84e-01</code></pre>
</div>
</div>
<p>The confound <code>A</code> is significantly related to <code>Z</code> and its estimated regression parameter is close to its true value of 0.70 (<img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Cbeta%7D_A%20=%200.69%20%5Cpm%200.07">). The variable of interest <code>B</code>, by contrast, isn’t significantly related to <code>Z</code> when <code>A</code> has been accounted for (<img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Cbeta%7D_B%20=%200.02%20%5Cpm%200.13">). This is all as it should be.</p>
</section>
<section id="adding-measurement-error" class="level3">
<h3 class="anchored" data-anchor-id="adding-measurement-error">Adding measurement error</h3>
<p>Now let’s add measurement error to all variables. The <code>A</code> values that we actually observe will then be distorted versions of the true <code>A</code> values:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctextrm%7Bobserved%20%7D%20A_i%20=%20%5Ctextrm%7Btrue%20%7D%20A_i%20+%20%5Cvarepsilon_%7BAi%7D.%0A"></p>
<p>The ‘noise’ <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon_%7BA%7D"> is commonly assumed to be normally distributed:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cvarepsilon_%7BAi%7D%20%5Csim%20%5Ctextrm%7BNormal%7D(0,%20%5Ctau_A).%0A"></p>
<p>That said, you can easily imagine situations where the noise likely has a different distribution. For instance, when measurements are measured to the nearest integer (e.g., body weights in kilograms), the noise is likely uniformly distributed (e.g., a reported body weight of 66 kg means that the true body weight lies between 65.5 and 66.5 kg).</p>
<p>To make the link with the analysis more transparant, I will express the amount of noise in terms of the variables’ reliabilities. For the confound <code>A</code>, I set the reliability at 0.70. Since <code>A</code>’s standard deviation was 1.5 units, this means that the standard deviation of the noise is <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B1.5%5E2%5Cleft(%5Cfrac%7B1%7D%7B0.70%7D%20-%201%5Cright)%7D%20=%200.98"> units. I set the reliability for <code>B</code>, the variable of actual interest at 0.90. Its standard deviation is 0.8, so the standard deviation of the noise is <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B0.8%5E2%5Cleft(%5Cfrac%7B1%7D%7B0.90%7D%20-%201%5Cright)%7D%20=%200.27"> units.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_4212a8d1c7d01d4b8e873af9be229807">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add measurement error on A and B</span></span>
<span id="cb7-2">obs_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sd_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reliability 0.70</span></span>
<span id="cb7-3">obs_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sd_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reliability 0.90</span></span></code></pre></div>
</div>
<p>The same logic applies to adding measurement noise to <code>Z</code>. The difficulty here lies in obtaining the population standard deviation (or variance) of <code>Z</code>. I don’t want to just plug in <code>Z</code>’s sample standard deviation since I want to have exact knowledge of the population parameters. While we specified a <code>sigma_Z.AB</code> above, this is <em>not</em> the total population standard deviation of <code>Z</code>: it’s the population standard deviation of <code>Z</code> once <code>Z</code> has been controlled for <code>A</code> and <code>B</code>. To obtain the <em>total</em> standard deviation of <code>Z</code> (here admittedly confusingly labelled <img src="https://latex.codecogs.com/png.latex?%5Csigma_Z">), we need to add in the variance in <code>Z</code> due to <code>A</code> and <code>B</code>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma_Z%20=%20%5Csqrt%7B(%5Cbeta_A%5Csigma_A)%5E2%20+%20(%5Cbeta_B%5Csigma_B)%5E2%20+%202%5Cbeta_A%5Cbeta_B%5Csigma_A%5Csigma_B%5Crho_%7BAB%7D%20+%20%5Csigma_%7BZ.AB%7D%5E2%7D.%0A"></p>
<p>Since <img src="https://latex.codecogs.com/png.latex?%5Cbeta_B%20=%200">, this simplifies to <img src="https://latex.codecogs.com/png.latex?%5Csigma_Z%20=%20%5Csqrt%7B(%5Cbeta_A%5Csigma_A)%5E2%20+%20%5Csigma_%7BZ.AB%7D%5E2%7D">, but if you want to simulate your own datasets, the full formula may be useful.</p>
<p>The population standard deviation of <code>Z</code> is thus <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B(0.7%20%5Ctimes%201.5)%5E2%20+%201.3%5E2%7D%20=%201.67">. Setting <code>Z</code>’s reliability to 0.70, we find that the standard deviation of the noise is <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B1.67%5E2%5Cleft(%5Cfrac%7B1%7D%7B0.70%7D%20-%201%5Cright)%7D%20=%201.09">.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_e1204a626b3eecd96247f79a0d28c42e">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Measurement error on Z</span></span>
<span id="cb8-2">sd_Z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>((slope_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sd_A)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>slope_B)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(slope_A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> slope_B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> latent_covariance_matrix[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_Z.AB<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-3">obs_Z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sd_Z<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reliability 0.70</span></span></code></pre></div>
</div>
<p>Figure 3 shows the causal diagram for the actually observed simulated data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_b394453f322b3f8ca32d86842bf19fbc">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-02-18-measurement-error/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption"><strong>Figure 3.</strong> Graphical causal model for the simulated data. <code>A</code>, <code>B</code> and <code>Z</code> are now unobserved (latent) variables, but so-called ‘descendants’ of them were measured. These reflect their latent constructs imperfectly. Crucially, controlling for <code>obs_A</code> will <em>not</em> entirely control for the confound: the path between <code>obs_B</code> and <code>obs_Z</code> stays open.</figcaption>
</figure>
</div>
</div>
</div>
<p>As Figure 4 shows, the observed variables are all correlated with each other.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_fb4953dd85bad18be6321c480436e14f">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scatterplot_matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(obs_Z, obs_A, obs_B))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-02-18-measurement-error/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 4.</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>Crucially, controlling for <code>obs_A</code> in a regression model doesn’t entirely eradicate the confound and we find that <code>obs_B</code> is significantly related to <code>obs_Z</code> even after controlling for <code>obs_A</code> (<img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Cbeta%7D_%7BB_%7B%5Ctextrm%7Bobs%7D%7D%7D%20=%200.40%20%5Cpm%200.15">). Moreover, the regression model on the observed variables underestimates the strength of the relationship between the true construct scores (<img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Cbeta%7D_%7BA_%7B%5Ctextrm%7Bobs%7D%7D%7D%20=%200.40%20%5Cpm%200.07">, whereas <img src="https://latex.codecogs.com/png.latex?%5Cbeta_A%20=%200.7">).</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_0be6c3f6d88b3deff0bfbaf6711674a1">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(obs_Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> obs_A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> obs_B))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    4.498     0.7588    5.93 8.49e-09
obs_A          0.402     0.0737    5.45 1.05e-07
obs_B          0.404     0.1470    2.75 6.41e-03</code></pre>
</div>
</div>
</section>
<section id="statistical-model" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model">Statistical model</h3>
<p>The statistical model, written below in Stan code, corresponds to the data generating mechanism above and tries to infer its parameters from the observed data and some prior information.</p>
<p>The <code>data</code> block specifies the input that the model should handle. I think this is self-explanatory. Note that the latent variable scores <code>A</code>, <code>B</code> and <code>Z</code> aren’t part of the input as we wouldn’t have directly observed these.</p>
<p>The <code>parameters</code> block first defines the parameters needed for the regression model with the unobserved latent variables (the one we used to generate <code>Z</code>). It then defines the parameters needed to generate the true variables scores for <code>A</code> and <code>B</code> as well as the parameters needed to generate the observed scores from the true scores (viz., the true scores themselves and the reliabilities). Note that it is crucial to allow the model to estimate a correlation between <code>A</code> and <code>B</code>, otherwise it won’t ‘know’ that <code>A</code> confounds the <code>B</code>-<code>Z</code> relationship.</p>
<p>The <code>transformed parameters</code> block contains, well, transformations of these parameters. For instance, the standard deviations of <code>A</code> and <code>B</code> and the correlation between <code>A</code> and <code>B</code> are used to generate a variance-covariance matrix. Moreover, the standard deviations of the measurement noise are computed using the latent variables’ standard deviation and their reliabilities.</p>
<p>The <code>model</code> block, finally, specifies how we think the observed data and the (transformed or untransformed) parameters fit together and what plausible a priori values for the (transformed or untransformed) parameters are. These prior distributions are pretty abstract in this example: we generated context-free data ourselves, so it’s not clear what motivates these priors. The real example to follow will hopefully make more sense in this respect. You’ll notice that I’ve also specified a prior for the reliabilities. The reason is that you typically don’t know the reliability of an observed variable with perfect precision but that you have sample estimate with some inherent uncertainty. The priors reflect this uncertainty. Again, this will become clearer in the real example to follow.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_f8d94c11b65c3611e99f7dc1cf1b2147">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">meas_error_code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb12-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data {</span></span>
<span id="cb12-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Number of observations</span></span>
<span id="cb12-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int&lt;lower = 1&gt; N;</span></span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed outcome</span></span>
<span id="cb12-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] obs_Z;</span></span>
<span id="cb12-8"></span>
<span id="cb12-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed predictors</span></span>
<span id="cb12-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] obs_A;</span></span>
<span id="cb12-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] obs_B;</span></span>
<span id="cb12-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-13"></span>
<span id="cb12-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parameters {</span></span>
<span id="cb12-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Parameters for regression</span></span>
<span id="cb12-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real intercept;</span></span>
<span id="cb12-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_A;</span></span>
<span id="cb12-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_B;</span></span>
<span id="cb12-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma;</span></span>
<span id="cb12-20"></span>
<span id="cb12-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Latent predictors (= constructs):</span></span>
<span id="cb12-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations and means</span></span>
<span id="cb12-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_A;</span></span>
<span id="cb12-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_B;</span></span>
<span id="cb12-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  row_vector[2] latent_means;</span></span>
<span id="cb12-26"></span>
<span id="cb12-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Correlation between latent predictors</span></span>
<span id="cb12-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = -1, upper = 1&gt; latent_rho;</span></span>
<span id="cb12-29"></span>
<span id="cb12-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Latent variables (true scores)</span></span>
<span id="cb12-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[N, 2] latent_predictors;</span></span>
<span id="cb12-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_Z; // latent outcome</span></span>
<span id="cb12-33"></span>
<span id="cb12-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown but estimated reliabilities</span></span>
<span id="cb12-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_A;</span></span>
<span id="cb12-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_B;</span></span>
<span id="cb12-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_Z;</span></span>
<span id="cb12-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-39"></span>
<span id="cb12-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">transformed parameters {</span></span>
<span id="cb12-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] mu_Z;  // conditional mean of outcome</span></span>
<span id="cb12-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_A; // latent variables, separated out</span></span>
<span id="cb12-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_B;</span></span>
<span id="cb12-44"></span>
<span id="cb12-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_A; // standard error of measurement</span></span>
<span id="cb12-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_B;</span></span>
<span id="cb12-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_Z;</span></span>
<span id="cb12-48"></span>
<span id="cb12-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations of latent predictors, in matrix form</span></span>
<span id="cb12-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[2, 2] sigma_lat;</span></span>
<span id="cb12-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // correlation and covariance matrix for latent predictors</span></span>
<span id="cb12-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cor;</span></span>
<span id="cb12-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cov;</span></span>
<span id="cb12-54"></span>
<span id="cb12-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviation of latent outcome</span></span>
<span id="cb12-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_Z;</span></span>
<span id="cb12-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_Z = sd(lat_Z);</span></span>
<span id="cb12-58"></span>
<span id="cb12-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Express measurement error in terms of</span></span>
<span id="cb12-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviation of constructs and reliability</span></span>
<span id="cb12-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_A = sqrt(sigma_lat_A^2*(1/reliability_A - 1));</span></span>
<span id="cb12-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_B = sqrt(sigma_lat_B^2*(1/reliability_B - 1));</span></span>
<span id="cb12-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_Z = sqrt(sigma_lat_Z^2*(1/reliability_Z - 1));</span></span>
<span id="cb12-64"></span>
<span id="cb12-65"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define diagonal matrix with standard errors of latent variables</span></span>
<span id="cb12-66"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 1] = sigma_lat_A;</span></span>
<span id="cb12-67"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 2] = sigma_lat_B;</span></span>
<span id="cb12-68"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 2] = 0;</span></span>
<span id="cb12-69"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 1] = 0;</span></span>
<span id="cb12-70"></span>
<span id="cb12-71"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define correlation matrix for latent variables</span></span>
<span id="cb12-72"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 1] = 1;</span></span>
<span id="cb12-73"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 2] = 1;</span></span>
<span id="cb12-74"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 2] = latent_rho;</span></span>
<span id="cb12-75"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 1] = latent_rho;</span></span>
<span id="cb12-76"></span>
<span id="cb12-77"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Compute covariance matrix for latent variables</span></span>
<span id="cb12-78"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cov = sigma_lat * latent_cor * sigma_lat;</span></span>
<span id="cb12-79"></span>
<span id="cb12-80"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Extract latent variables from matrix</span></span>
<span id="cb12-81"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_A = latent_predictors[, 1];</span></span>
<span id="cb12-82"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_B = latent_predictors[, 2];</span></span>
<span id="cb12-83"></span>
<span id="cb12-84"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Regression model for conditional mean of Z</span></span>
<span id="cb12-85"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  mu_Z = intercept + slope_A*lat_A + slope_B*lat_B;</span></span>
<span id="cb12-86"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-87"></span>
<span id="cb12-88"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">model {</span></span>
<span id="cb12-89"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Priors for regression parameters</span></span>
<span id="cb12-90"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  intercept ~ normal(0, 2);</span></span>
<span id="cb12-91"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_A ~ normal(0, 2);</span></span>
<span id="cb12-92"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_B ~ normal(0, 2);</span></span>
<span id="cb12-93"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma ~ normal(0, 2);</span></span>
<span id="cb12-94"></span>
<span id="cb12-95"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for latent standard deviations</span></span>
<span id="cb12-96"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_A ~ normal(0, 2);</span></span>
<span id="cb12-97"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_B ~ normal(0, 2);</span></span>
<span id="cb12-98"></span>
<span id="cb12-99"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for latent means</span></span>
<span id="cb12-100"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_means ~ normal(0, 3);</span></span>
<span id="cb12-101"></span>
<span id="cb12-102"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior expectation for correlation between latent variables.</span></span>
<span id="cb12-103"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Tend towards positive correlation, but pretty vague.</span></span>
<span id="cb12-104"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_rho ~ normal(0.4, 0.3);</span></span>
<span id="cb12-105"></span>
<span id="cb12-106"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for reliabilities.</span></span>
<span id="cb12-107"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // These are estimated with some uncertainty, i.e.,</span></span>
<span id="cb12-108"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // they are not point values but distributions.</span></span>
<span id="cb12-109"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_A ~ beta(70, 30);</span></span>
<span id="cb12-110"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_B ~ beta(90, 10);</span></span>
<span id="cb12-111"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_Z ~ beta(70, 30);</span></span>
<span id="cb12-112"></span>
<span id="cb12-113"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Distribution of latent variable</span></span>
<span id="cb12-114"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) {</span></span>
<span id="cb12-115"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    latent_predictors[i, ] ~ multi_normal(latent_means, latent_cov);</span></span>
<span id="cb12-116"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb12-117"></span>
<span id="cb12-118"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Generate latent outcome</span></span>
<span id="cb12-119"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_Z ~ normal(mu_Z, sigma);</span></span>
<span id="cb12-120"></span>
<span id="cb12-121"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Add noise to latent variables</span></span>
<span id="cb12-122"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  obs_A ~ normal(lat_A, error_A);</span></span>
<span id="cb12-123"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  obs_B ~ normal(lat_B, error_B);</span></span>
<span id="cb12-124"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  obs_Z ~ normal(lat_Z, error_Z);</span></span>
<span id="cb12-125"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-126"></span>
<span id="cb12-127"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span></code></pre></div>
</div>
<p>Put the data in a list and fit the model:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_b44f6b79cb92550bf604a9cb8a2965fb">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb13-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_Z =</span> obs_Z,</span>
<span id="cb13-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_A =</span> obs_A,</span>
<span id="cb13-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_B =</span> obs_B,</span>
<span id="cb13-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> n</span>
<span id="cb13-6">)</span></code></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_884acfdfc62d8766e6e2eb37f0721207">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">meas_error_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cmdstan_model</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_stan_file</span>(meas_error_code))</span>
<span id="cb14-2">model_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> meas_error_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(</span>
<span id="cb14-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list</span>
<span id="cb14-4">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span></span>
<span id="cb14-5">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb14-6">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parallel_chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb14-7">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb14-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_sampling =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb14-9">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refresh =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb14-10">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_treedepth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span id="cb14-11">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb14-12">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 279.7 seconds.
Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 320.0 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 355.9 seconds.
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 369.9 seconds.

All 4 chains finished successfully.
Mean chain execution time: 331.4 seconds.
Total execution time: 370.0 seconds.</code></pre>
</div>
</div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<!-- ```{r, echo = FALSE} -->
<!-- meas_error_model <- readRDS("measurement_error_model.rds") -->
<!-- ``` -->
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_c1d9c62ec754412d1ce0b1faa4d3e81d">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">model_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(</span>
<span id="cb16-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variables =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span></span>
<span id="cb16-3">                ,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_Z"</span></span>
<span id="cb16-4">                ,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_means"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_rho"</span></span>
<span id="cb16-5">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_Z"</span></span>
<span id="cb16-6">                ,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error_B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error_Z"</span>)</span>
<span id="cb16-7">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sd"</span></span>
<span id="cb16-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">extra_quantiles =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile2</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>))</span>
<span id="cb16-9">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rhat"</span></span>
<span id="cb16-10">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 6
   variable          mean     sd   q2.5  q97.5  rhat
   &lt;chr&gt;            &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt;
 1 intercept        0.649 1.49   -2.43   3.37   1.02
 2 slope_A          0.866 0.170   0.564  1.22   1.02
 3 slope_B         -0.200 0.254  -0.719  0.265  1.02
 4 sigma            1.17  0.126   0.903  1.40   1.01
 5 sigma_lat_A      1.40  0.0716  1.26   1.54   1.00
 6 sigma_lat_B      0.797 0.0353  0.731  0.869  1.00
 7 sigma_lat_Z      1.59  0.0702  1.45   1.72   1.01
 8 latent_means[1]  3.07  0.0972  2.87   3.26   1.00
 9 latent_means[2] -4.02  0.0486 -4.11  -3.92   1.00
10 latent_rho       0.780 0.0493  0.678  0.871  1.01
11 reliability_A    0.694 0.0408  0.616  0.773  1.02
12 reliability_B    0.901 0.0277  0.843  0.947  1.00
13 reliability_Z    0.699 0.0466  0.600  0.782  1.01
14 error_A          0.925 0.0710  0.785  1.06   1.01
15 error_B          0.262 0.0382  0.191  0.338  1.01
16 error_Z          1.04  0.0872  0.880  1.22   1.01</code></pre>
</div>
</div>
<p>The model recovers the true parameter values pretty well (Table 1) and, on the basis of this model, you wouldn’t erroneously conclude that <code>B</code> is causally related to <code>Z</code> (see the parameter estimate for <code>slope_B</code>).</p>
<table class="table">
<caption><strong>Table 1.</strong> Comparison of the true parameter values and their estimates. Parameters prefixed with ‘*’ are transformations of other parameters. The estimated reliability parameters aren’t really estimated from the data: they just reflect the prior distributions put on them.</caption>
<thead>
<tr class="header">
<th>Parameter</th>
<th style="text-align: right;">True value</th>
<th style="text-align: right;">Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>intercept</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">0.65 ± 1.53</td>
</tr>
<tr class="even">
<td>slope_A</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.87 ± 0.17</td>
</tr>
<tr class="odd">
<td>slope_B</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">-0.20 ± 0.25</td>
</tr>
<tr class="even">
<td>sigma_Z.AB</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.17 ± 0.13</td>
</tr>
<tr class="odd">
<td>sd_A</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">1.40 ± 0.07</td>
</tr>
<tr class="even">
<td>sd_B</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.80 ± 0.04</td>
</tr>
<tr class="odd">
<td>mean_A</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.07 ± 0.10</td>
</tr>
<tr class="even">
<td>mean_B</td>
<td style="text-align: right;">-4.00</td>
<td style="text-align: right;">-4.02 ± 0.05</td>
</tr>
<tr class="odd">
<td>rho</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.78 ± 0.05</td>
</tr>
<tr class="even">
<td>reliability_A</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.69 ± 0.04</td>
</tr>
<tr class="odd">
<td>reliability_B</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.90 ± 0.03</td>
</tr>
<tr class="even">
<td>reliability_Z</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.70 ± 0.05</td>
</tr>
<tr class="odd">
<td>*sd_Z</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">1.59 ± 0.07</td>
</tr>
<tr class="even">
<td>*error_A</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.93 ± 0.07</td>
</tr>
<tr class="odd">
<td>*error_B</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.26 ± 0.04</td>
</tr>
<tr class="even">
<td>*error_Z</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">1.04 ± 0.09</td>
</tr>
</tbody>
</table>
<p>In the previous blog post, I’ve shown that such a model also estimates the latent true variable scores and that these estimates correspond more closely to the actual true variable scores than do the observed variable scores. I’ll skip this step here.</p>
</section>
</section>
<section id="real-life-example-interdependence" class="level2">
<h2 class="anchored" data-anchor-id="real-life-example-interdependence">Real-life example: Interdependence</h2>
<p>Satisfied that our model can recover the actual parameter values in scenarios such as those depicted in Figure 3, we now turn to a real-life example of such a situation. The example was already described in the previous blog post; here I’ll just draw the causal model that assumes that reflects the null hypothesis that a child’s Portuguese skills at T2 (<code>PT.T2</code>) don’t contribute to their French skills at T3 (<code>FR.T3</code>), but that due to common factors such as intelligence, form on the day etc. (<img src="https://latex.codecogs.com/png.latex?U">), French skills and Portuguese skills at T2 are correlated across children. What is observed are test scores, not the children’s actual skills.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_556140410eca893f52d083a83f709a45">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-02-18-measurement-error/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption"><strong>Figure 5</strong></figcaption>
</figure>
</div>
</div>
</div>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>The command below is pig-ugly, but allows you to easily read in the data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_de47d2c996aa26b09fe62e410487979d">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">skills <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">structure</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb18-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Subject =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_14"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_15"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_17"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_11"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_11"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_14"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_15"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_17"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_18"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_20"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_21"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_22"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_24"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_25"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_26"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_30"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_15"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_17"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_18"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_20"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_24"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_25"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_26"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_27"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_28"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_29"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_31"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_32"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_33"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_34"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_36"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_8"</span>)</span>
<span id="cb18-3">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>)</span>
<span id="cb18-4">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0526315789</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>)</span>
<span id="cb18-5">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>)</span>
<span id="cb18-6">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2105263158</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>)</span>
<span id="cb18-7">  )</span>
<span id="cb18-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>91L)</span>
<span id="cb18-9">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tbl_df"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tbl"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.frame"</span>)</span>
<span id="cb18-10">)</span></code></pre></div>
</div>
</section>
<section id="statistical-model-1" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-1">Statistical model</h3>
<p>The only thing that’s changed in the statistical model compared to the example with the simulated data is that I’ve renamed the parameters and that the prior distributions are better motivated. Let’s consider each prior distribution in turn:</p>
<ul>
<li><code>intercept ~ normal(0.2, 0.1);</code>: The intercept is the average true French skill score at T3 for children whose true French and Portuguese skill scores at T2 are 0. This is the lowest possible score (the theoretical range of the data is [0, 1]), so we’d expect such children to perform poorly at T3, too. A <code>normal(0.2, 0.1)</code> distribution puts 95% probability on such children having a true French score at T3 between 0 and 0.4.</li>
<li><code>slope_FR ~ normal(0.5, 0.25);</code>: This parameter expresses the difference between the average true French skill score at T3 for children with a true French skill score of 1 at T2 (the theoretical maximum) vs.&nbsp;those with a true French skill score of 0 at T2 (the theoretical minimum). This is obviously some value between -1 and 1, and presumably it’s going to be positive. A <code>normal(0.5, 0.25)</code> puts 95% probability on this difference lying between 0 and 1, which I think is reasonable.</li>
<li><code>slope_PT ~ normal(0, 0.25);</code>: The slope for Portuguese is bound to be smaller than the one for French. Moreover, it’s not a given that it will be appreciably different from zero. Hence a prior centred on 0 that still gives the data a chance to pull the estimate in either direction.</li>
<li><code>sigma ~ normal(0.15, 0.08);</code>: If neither of the T2 variables predicts T3, uncertainty is highest when the mean T3 score is 0.5. Since these scores are bounded between 0 and 1, the standard deviation could not be much higher than 0.20. But French T2 is bound to be a predictor, so let us choose a slightly lower value (0.15).</li>
<li><code>latent_means ~ normal(0.5, 0.1);</code>: These are the prior expectations for the true score means of the T2 variables. 0.5 lies in the middle of the scale; the <code>normal(0.5, 0.1)</code> prior puts 95% probability on these means to lie between 0.3 and 0.7.</li>
<li><code>sigma_lat_FR_T2 ~ normal(0, 0.25);</code>, <code>sigma_lat_FR_T2 ~ normal(0, 0.25);</code>: The standard deviations of the latent T2 variables. If these truncated normal distributions put a 95% probability of the latent standard deviations to be lower than 0.50.</li>
<li><code>latent_rho ~ normal(0.4, 0.3);</code>: The a priori expected correlation between the latent variables <code>A</code> and <code>B</code>. These are bound to be positively correlated.</li>
<li><code>reliability_FR_T2 ~ beta(100, 100*0.27/0.73);</code> The prior distribution for the reliability of the French T2 variable. Cronbach’s <img src="https://latex.codecogs.com/png.latex?%5Calpha"> for this variable was 0.73 (95% CI: [0.65, 0.78]). This roughly corresponds to a <code>beta(100, 100*0.27/0.73)</code> distribution:</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_1ab8e90670e4a8d46e58bb1deabf6c73">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qbeta</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.73</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6529105 0.8007296</code></pre>
</div>
</div>
<ul>
<li><code>reliability_PT_T2 ~ beta(120, 120*0.21/0.79);</code> Similarly, Cronbach’s <img src="https://latex.codecogs.com/png.latex?%5Calpha"> for the Portuguese T2 variable was 0.79 (95% CI: [0.72, 0.84]), which roughly corresponds to a <code>beta(120, 120*0.21/0.79)</code> distribution:</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_bad62dcd138c83049f5c0685491e1036">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qbeta</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.21</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.79</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7219901 0.8507814</code></pre>
</div>
</div>
<ul>
<li><code>reliability_FR_T3 ~ beta(73, 27);</code>: The estimated reliability for the French T3 data was similar to that of the T2 data, so I used the same prior.</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-21_332e3f14c9513161a8b4f9958e16100b">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">interdependence_code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb23-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data {</span></span>
<span id="cb23-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Number of observations</span></span>
<span id="cb23-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int&lt;lower = 1&gt; N;</span></span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed outcome</span></span>
<span id="cb23-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] FR_T3;</span></span>
<span id="cb23-8"></span>
<span id="cb23-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed predictors</span></span>
<span id="cb23-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] FR_T2;</span></span>
<span id="cb23-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] PT_T2;</span></span>
<span id="cb23-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-13"></span>
<span id="cb23-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parameters {</span></span>
<span id="cb23-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Parameters for regression</span></span>
<span id="cb23-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real intercept;</span></span>
<span id="cb23-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_FR;</span></span>
<span id="cb23-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_PT;</span></span>
<span id="cb23-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma;</span></span>
<span id="cb23-20"></span>
<span id="cb23-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations of latent predictors (= constructs)</span></span>
<span id="cb23-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_FR_T2;</span></span>
<span id="cb23-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_PT_T2;</span></span>
<span id="cb23-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb23-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Means of latent predictors</span></span>
<span id="cb23-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  row_vector[2] latent_means;</span></span>
<span id="cb23-27"></span>
<span id="cb23-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown correlation between latent predictors</span></span>
<span id="cb23-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = -1, upper = 1&gt; latent_rho;</span></span>
<span id="cb23-30"></span>
<span id="cb23-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Latent variables</span></span>
<span id="cb23-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[N, 2] latent_predictors;</span></span>
<span id="cb23-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_FR_T3; // latent outcome</span></span>
<span id="cb23-34"></span>
<span id="cb23-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown but estimated reliabilities</span></span>
<span id="cb23-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_FR_T2;</span></span>
<span id="cb23-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_PT_T2;</span></span>
<span id="cb23-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_FR_T3;</span></span>
<span id="cb23-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-40"></span>
<span id="cb23-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">transformed parameters {</span></span>
<span id="cb23-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] mu_FR_T3;  // conditional mean of outcome</span></span>
<span id="cb23-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_FR_T2; // latent variables, separated out</span></span>
<span id="cb23-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_PT_T2;</span></span>
<span id="cb23-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_FR_T2; // standard error of measurement</span></span>
<span id="cb23-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_PT_T2;</span></span>
<span id="cb23-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_FR_T3;</span></span>
<span id="cb23-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb23-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations of latent predictors, in matrix form</span></span>
<span id="cb23-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[2, 2] sigma_lat;</span></span>
<span id="cb23-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb23-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // correlation and covariance matrix for latent predictors</span></span>
<span id="cb23-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cor;</span></span>
<span id="cb23-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cov;</span></span>
<span id="cb23-55"></span>
<span id="cb23-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviation of latent outcome</span></span>
<span id="cb23-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_FR_T3;</span></span>
<span id="cb23-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_FR_T3 = sd(lat_FR_T3);</span></span>
<span id="cb23-59"></span>
<span id="cb23-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Express measurement error in terms of</span></span>
<span id="cb23-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviation of constructs and reliability</span></span>
<span id="cb23-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_FR_T2 = sqrt(sigma_lat_FR_T2^2*(1/reliability_FR_T2 - 1));</span></span>
<span id="cb23-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_PT_T2 = sqrt(sigma_lat_PT_T2^2*(1/reliability_PT_T2 - 1));</span></span>
<span id="cb23-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_FR_T3 = sqrt(sigma_lat_FR_T3^2*(1/reliability_FR_T3 - 1));</span></span>
<span id="cb23-65"></span>
<span id="cb23-66"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define diagonal matrix with standard errors of latent variables</span></span>
<span id="cb23-67"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 1] = sigma_lat_FR_T2;</span></span>
<span id="cb23-68"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 2] = sigma_lat_PT_T2;</span></span>
<span id="cb23-69"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 2] = 0;</span></span>
<span id="cb23-70"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 1] = 0;</span></span>
<span id="cb23-71"></span>
<span id="cb23-72"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define correlation matrix for latent variables</span></span>
<span id="cb23-73"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 1] = 1;</span></span>
<span id="cb23-74"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 2] = 1;</span></span>
<span id="cb23-75"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 2] = latent_rho;</span></span>
<span id="cb23-76"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 1] = latent_rho;</span></span>
<span id="cb23-77"></span>
<span id="cb23-78"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Compute covariance matrix for latent variables</span></span>
<span id="cb23-79"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cov = sigma_lat * latent_cor * sigma_lat;</span></span>
<span id="cb23-80"></span>
<span id="cb23-81"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Extract latent variables from matrix</span></span>
<span id="cb23-82"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_FR_T2 = latent_predictors[, 1];</span></span>
<span id="cb23-83"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_PT_T2 = latent_predictors[, 2];</span></span>
<span id="cb23-84"></span>
<span id="cb23-85"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Regression model for conditional mean of Z</span></span>
<span id="cb23-86"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  mu_FR_T3 = intercept + slope_FR*lat_FR_T2 + slope_PT*lat_PT_T2;</span></span>
<span id="cb23-87"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-88"></span>
<span id="cb23-89"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">model { </span></span>
<span id="cb23-90"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Priors for regression parameters </span></span>
<span id="cb23-91"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  intercept ~ normal(0.2, 0.1); </span></span>
<span id="cb23-92"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_FR ~ normal(0.5, 0.25); </span></span>
<span id="cb23-93"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_PT ~ normal(0, 0.25); </span></span>
<span id="cb23-94"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma ~ normal(0.15, 0.08); </span></span>
<span id="cb23-95"></span>
<span id="cb23-96"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for latent means </span></span>
<span id="cb23-97"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_means ~ normal(0.5, 0.1); </span></span>
<span id="cb23-98"></span>
<span id="cb23-99"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for latent standard deviations </span></span>
<span id="cb23-100"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_FR_T2 ~ normal(0, 0.25); </span></span>
<span id="cb23-101"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_PT_T2 ~ normal(0, 0.25); </span></span>
<span id="cb23-102"></span>
<span id="cb23-103"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior expectation for correlation between latent variables. </span></span>
<span id="cb23-104"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_rho ~ normal(0.4, 0.3); </span></span>
<span id="cb23-105"></span>
<span id="cb23-106"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for reliabilities. </span></span>
<span id="cb23-107"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // These are estimated with some uncertainty, i.e., </span></span>
<span id="cb23-108"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // they are not point values but distributions. </span></span>
<span id="cb23-109"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_FR_T2 ~ beta(100, 100*0.27/0.73); </span></span>
<span id="cb23-110"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_PT_T2 ~ beta(120, 120*0.21/0.79); </span></span>
<span id="cb23-111"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_FR_T3 ~ beta(100, 100*0.27/0.73); </span></span>
<span id="cb23-112"></span>
<span id="cb23-113"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Distribution of latent variable </span></span>
<span id="cb23-114"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) { </span></span>
<span id="cb23-115"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    latent_predictors[i, ] ~ multi_normal(latent_means, latent_cov); </span></span>
<span id="cb23-116"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  } </span></span>
<span id="cb23-117"></span>
<span id="cb23-118"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Generate latent outcome </span></span>
<span id="cb23-119"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_FR_T3 ~ normal(mu_FR_T3, sigma); </span></span>
<span id="cb23-120"></span>
<span id="cb23-121"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Measurement model </span></span>
<span id="cb23-122"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FR_T2 ~ normal(lat_FR_T2, error_FR_T2); </span></span>
<span id="cb23-123"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  PT_T2 ~ normal(lat_PT_T2, error_PT_T2); </span></span>
<span id="cb23-124"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FR_T3 ~ normal(lat_FR_T3, error_FR_T3); </span></span>
<span id="cb23-125"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">} </span></span>
<span id="cb23-126"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> </span></code></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_9939ad75b648d9184c2f4d595cdd3aef">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb24-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T2 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T2,</span>
<span id="cb24-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T2 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PT_T2,</span>
<span id="cb24-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T3 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3,</span>
<span id="cb24-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3)</span>
<span id="cb24-6">)</span>
<span id="cb24-7"></span>
<span id="cb24-8">interdependence_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cmdstan_model</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_stan_file</span>(interdependence_code))</span>
<span id="cb24-9">interdependence_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> interdependence_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(</span>
<span id="cb24-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list</span>
<span id="cb24-11">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span></span>
<span id="cb24-12">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb24-13">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parallel_chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb24-14">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb24-15">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_sampling =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6000</span></span>
<span id="cb24-16">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refresh =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb24-17">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_treedepth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span id="cb24-18">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9999</span></span>
<span id="cb24-19">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 1 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 4 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 2 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 3 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 1 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 1 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 4 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 4 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 2 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 2 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 3 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 3 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 1 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 4 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 1 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 4 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 2 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 1 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 4 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 4 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 1 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 2 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 3 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 4 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 1 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 4 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 4 finished in 261.0 seconds.
Chain 1 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 1 finished in 271.4 seconds.
Chain 2 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 2 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 3 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 2 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 2 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 2 finished in 384.6 seconds.
Chain 3 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 3 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 3 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 3 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 3 finished in 656.3 seconds.

All 4 chains finished successfully.
Mean chain execution time: 393.3 seconds.
Total execution time: 656.4 seconds.</code></pre>
</div>
</div>
</section>
<section id="results-1" class="level3">
<h3 class="anchored" data-anchor-id="results-1">Results</h3>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-23_01ed6dc0d500fa8a17ee0d6a570a86e3">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">interdependence_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(</span>
<span id="cb26-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variables =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_FR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_PT"</span></span>
<span id="cb26-3">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_rho"</span>)</span>
<span id="cb26-4">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sd"</span></span>
<span id="cb26-5">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">extra_quantiles =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile2</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>))</span>
<span id="cb26-6">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rhat"</span></span>
<span id="cb26-7">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  variable     mean     sd    q2.5 q97.5  rhat
  &lt;chr&gt;       &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt; &lt;num&gt;
1 intercept  0.189  0.0529  0.0848 0.293  1.00
2 slope_FR   0.712  0.154   0.407  1.01   1.00
3 slope_PT   0.107  0.138  -0.165  0.378  1.00
4 sigma      0.0721 0.0182  0.0331 0.106  1.00
5 latent_rho 0.812  0.0781  0.646  0.950  1.00</code></pre>
</div>
</div>
<p>Unsurprisingly, the model confidently finds a link between French skills at T2 and at T3, even on the level of the unobserved true scores (<img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Cbeta%7D_%7B%5Ctextrm%7BFrench%7D%7D%20=%200.71%20%5Cpm%200.15">). But more importantly, the evidence for an additional effect of Portuguese skills at T2 on French skills at T3 is flimsy (<img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Cbeta%7D_%7B%5Ctextrm%7BPortuguese%7D%7D%20=%200.11%20%5Cpm%200.14">). The latent T2 variables are estimated to correlate strongly at <img src="https://latex.codecogs.com/png.latex?%5Cwidehat%7B%5Crho%7D%20=%200.81%20%5Cpm%200.08">. These results don’t change much when a flat prior on <img src="https://latex.codecogs.com/png.latex?%5Crho"> is specified (this can be accomplished by not specifying any prior at all for <img src="https://latex.codecogs.com/png.latex?%5Crho">). Compared to the model in the previous blog post (Table 2), little has changed. The only appreciable difference is that the estimate for <code>sigma</code> is lower. The reason is that, unlike the previous model, the current model partitions the variance in the French T3 scores into true score variance and measurement error variance. In this model, <code>sigma</code> captures the true score variance that isn’t accounted for by T2 skills, whereas in the previous model, <code>sigma</code> captured the <em>total</em> variance that wasn’t accounted for by T2 skills. But other than that, the current model doesn’t represent a huge change from the previous one.</p>
<table class="table">
<caption><strong>Table 2.</strong> Comparison of parameter estimates between the model fitted in this blog post and the model fitted in the previous one. In the previous model, the outcome was assumed to be perfectly reliable.</caption>
<thead>
<tr class="header">
<th>Parameter</th>
<th style="text-align: right;">Current estimate</th>
<th style="text-align: right;">Previous estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>intercept</td>
<td style="text-align: right;">0.19 ± 0.05</td>
<td style="text-align: right;">0.19 ± 0.05</td>
</tr>
<tr class="even">
<td>slope_FR</td>
<td style="text-align: right;">0.71 ± 0.15</td>
<td style="text-align: right;">0.71 ± 0.16</td>
</tr>
<tr class="odd">
<td>slope_PT</td>
<td style="text-align: right;">0.11 ± 0.14</td>
<td style="text-align: right;">0.10 ± 0.14</td>
</tr>
<tr class="even">
<td>sigma</td>
<td style="text-align: right;">0.07 ± 0.02</td>
<td style="text-align: right;">0.12 ± 0.01</td>
</tr>
<tr class="odd">
<td>latent_rho</td>
<td style="text-align: right;">0.81 ± 0.08</td>
<td style="text-align: right;">0.81 ± 0.08</td>
</tr>
</tbody>
</table>
<p>A couple of things still remain to be done. First, the French test at T3 was the same as the one at T2 so it’s likely that the measurement errors on both scores won’t be completely independent of one another. I’d like to find out how correlated measurement errors affect the parameter estimates. Second, I’d like to get started with prior and posterior predictive checks: the former to check if the priors give rise to largely possible data patterns, and the latter to check if the full model tends to generate data sets similar to the one actually observed.</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Berthele, Raphael and Jan Vanhove. 2017. <a href="https://doi.org/10.1080/13670050.2017.1385590">What would disprove interdependence? Lessons learned from a study on biliteracy in Portuguese heritage language speakers in Switzerland.</a> <em>International Journal of Bilingual Education and Bilingualism</em>.</p>
<p>Brunner, Jerry and Peter C. Austin. 2009. <a href="https://doi.org/10.1002/cjs.10004">Inflation of Type I error rate in multiple regression when independent variables are measured with error.</a> <em>Canadian Journal of Statistics</em> 37(1). 33–46.</p>
<p>Westfall, Jacob and Tal Yarkoni. 2016. <a href="https://doi.org/10.1371/journal.pone.0152719">Statistically controlling for confounding constructs is harder than you think.</a>. <em>PLOS ONE</em> 11(3). e0152719.</p>
</section>
<section id="software-versions" class="level2">
<h2 class="anchored" data-anchor-id="software-versions">Software versions</h2>
<p>Please note that I reran the code on this page on August 6, 2023.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-24_add61e05ab5fb3b39e0f8d97d115fa4a">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">session_info</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.1 (2023-06-16)
 os       Ubuntu 22.04.2 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_US
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Zurich
 date     2023-08-06
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package        * version date (UTC) lib source
 abind            1.4-5   2016-07-21 [1] CRAN (R 4.3.1)
 backports        1.4.1   2021-12-13 [1] CRAN (R 4.3.0)
 boot             1.3-28  2021-05-03 [4] CRAN (R 4.2.0)
 cachem           1.0.6   2021-08-19 [2] CRAN (R 4.2.0)
 callr            3.7.3   2022-11-02 [1] CRAN (R 4.3.1)
 checkmate        2.2.0   2023-04-27 [1] CRAN (R 4.3.1)
 cli              3.6.1   2023-03-23 [1] CRAN (R 4.3.0)
 cmdstanr       * 0.6.0   2023-08-02 [1] local
 colorspace       2.1-0   2023-01-23 [1] CRAN (R 4.3.0)
 crayon           1.5.2   2022-09-29 [1] CRAN (R 4.3.1)
 curl             5.0.1   2023-06-07 [1] CRAN (R 4.3.1)
 dagitty        * 0.3-1   2021-01-21 [1] CRAN (R 4.3.1)
 devtools         2.4.5   2022-10-11 [1] CRAN (R 4.3.1)
 digest           0.6.29  2021-12-01 [2] CRAN (R 4.2.0)
 distributional   0.3.2   2023-03-22 [1] CRAN (R 4.3.1)
 dplyr            1.1.2   2023-04-20 [1] CRAN (R 4.3.0)
 ellipsis         0.3.2   2021-04-29 [2] CRAN (R 4.2.0)
 evaluate         0.15    2022-02-18 [2] CRAN (R 4.2.0)
 fansi            1.0.4   2023-01-22 [1] CRAN (R 4.3.1)
 farver           2.1.1   2022-07-06 [1] CRAN (R 4.3.0)
 fastmap          1.1.0   2021-01-25 [2] CRAN (R 4.2.0)
 fs               1.5.2   2021-12-08 [2] CRAN (R 4.2.0)
 generics         0.1.3   2022-07-05 [1] CRAN (R 4.3.0)
 ggplot2          3.4.2   2023-04-03 [1] CRAN (R 4.3.0)
 glue             1.6.2   2022-02-24 [2] CRAN (R 4.2.0)
 gtable           0.3.3   2023-03-21 [1] CRAN (R 4.3.0)
 htmltools        0.5.5   2023-03-23 [1] CRAN (R 4.3.0)
 htmlwidgets      1.6.2   2023-03-17 [1] CRAN (R 4.3.1)
 httpuv           1.6.11  2023-05-11 [1] CRAN (R 4.3.1)
 jsonlite         1.8.7   2023-06-29 [1] CRAN (R 4.3.1)
 knitr            1.39    2022-04-26 [2] CRAN (R 4.2.0)
 later            1.3.1   2023-05-02 [1] CRAN (R 4.3.1)
 lifecycle        1.0.3   2022-10-07 [1] CRAN (R 4.3.0)
 magrittr         2.0.3   2022-03-30 [1] CRAN (R 4.3.0)
 MASS             7.3-60  2023-05-04 [4] CRAN (R 4.3.1)
 memoise          2.0.1   2021-11-26 [2] CRAN (R 4.2.0)
 mime             0.10    2021-02-13 [2] CRAN (R 4.0.2)
 miniUI           0.1.1.1 2018-05-18 [1] CRAN (R 4.3.1)
 munsell          0.5.0   2018-06-12 [1] CRAN (R 4.3.0)
 pillar           1.9.0   2023-03-22 [1] CRAN (R 4.3.0)
 pkgbuild         1.4.2   2023-06-26 [1] CRAN (R 4.3.1)
 pkgconfig        2.0.3   2019-09-22 [2] CRAN (R 4.2.0)
 pkgload          1.3.2.1 2023-07-08 [1] CRAN (R 4.3.1)
 posterior      * 1.4.1   2023-03-14 [1] CRAN (R 4.3.1)
 prettyunits      1.1.1   2020-01-24 [2] CRAN (R 4.2.0)
 processx         3.8.2   2023-06-30 [1] CRAN (R 4.3.1)
 profvis          0.3.8   2023-05-02 [1] CRAN (R 4.3.1)
 promises         1.2.0.1 2021-02-11 [1] CRAN (R 4.3.1)
 ps               1.7.5   2023-04-18 [1] CRAN (R 4.3.1)
 purrr            1.0.1   2023-01-10 [1] CRAN (R 4.3.0)
 R6               2.5.1   2021-08-19 [2] CRAN (R 4.2.0)
 Rcpp             1.0.11  2023-07-06 [1] CRAN (R 4.3.1)
 remotes          2.4.2   2021-11-30 [2] CRAN (R 4.2.0)
 rlang            1.1.1   2023-04-28 [1] CRAN (R 4.3.0)
 rmarkdown        2.21    2023-03-26 [1] CRAN (R 4.3.0)
 rstudioapi       0.14    2022-08-22 [1] CRAN (R 4.3.0)
 scales           1.2.1   2022-08-20 [1] CRAN (R 4.3.0)
 sessioninfo      1.2.2   2021-12-06 [2] CRAN (R 4.2.0)
 shiny            1.7.4.1 2023-07-06 [1] CRAN (R 4.3.1)
 stringi          1.7.12  2023-01-11 [1] CRAN (R 4.3.1)
 stringr          1.5.0   2022-12-02 [1] CRAN (R 4.3.0)
 tensorA          0.36.2  2020-11-19 [1] CRAN (R 4.3.1)
 tibble           3.2.1   2023-03-20 [1] CRAN (R 4.3.0)
 tidyselect       1.2.0   2022-10-10 [1] CRAN (R 4.3.0)
 urlchecker       1.0.1   2021-11-30 [1] CRAN (R 4.3.1)
 usethis          2.2.2   2023-07-06 [1] CRAN (R 4.3.1)
 utf8             1.2.3   2023-01-31 [1] CRAN (R 4.3.1)
 V8               4.3.0   2023-04-08 [1] CRAN (R 4.3.0)
 vctrs            0.6.3   2023-06-14 [1] CRAN (R 4.3.0)
 xfun             0.39    2023-04-20 [1] CRAN (R 4.3.0)
 xtable           1.8-4   2019-04-21 [1] CRAN (R 4.3.1)
 yaml             2.3.5   2022-02-21 [2] CRAN (R 4.2.0)

 [1] /home/jan/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>Stan</category>
  <category>Bayesian statistics</category>
  <category>measurement error</category>
  <category>correlational studies</category>
  <category>reliability</category>
  <guid>https://janhove.github.io/posts/2020-02-18-measurement-error/index.html</guid>
  <pubDate>Mon, 17 Feb 2020 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Baby steps in Bayes: Accounting for measurement error on a control variable</title>
  <dc:creator>Jan Vanhove</dc:creator>
  <link>https://janhove.github.io/posts/2020-01-21-statistical-control-measurement-error/index.html</link>
  <description><![CDATA[ 



<p>In observational studies, it is customary to account for confounding variables by including measurements of them in the statistical model. This practice is referred to as <em>statistically controlling</em> for the confounding variables. An underappreciated problem is that if the confounding variables were measured imperfectly, then statistical control will be imperfect as well, and the confound won’t be eradicated entirely (see Berthele &amp; Vanhove 2017; Brunner &amp; Austin 2009; Westfall &amp; Yarkoni 2016) (see also <a href="../2015-08-24-caveats-confounds-correlational-designs"><em>Controlling for confounding variables in correlational research: Four caveats</em></a>).</p>
<p>This blog post details my efforts to specify a Bayesian model in which the measurement error on the confounding variable was taken into account. The ultimate aim was to obtain more honest estimates of the impact of the confounding variable and the variable of actual interest on the outcome. First, I’ll discuss a simulated example to demonstrate the consequences of measurement error on statistical control and what a model needs to do to appropriately take measurement error into account. Then I apply the insights gained on a real-life study in applied linguistics.</p>
<p>I will preface all of this with the disclaimer that I don’t consider myself an expert in the techniques discussed below; one reason for writing this blog is to solicit feedback from readers more knowledgeable than I am.</p>
<section id="preliminaries" class="level2">
<h2 class="anchored" data-anchor-id="preliminaries">Preliminaries</h2>
<p><strong>Update (2023-08-06):</strong> When converting this blog from Jekyll/Bootstrap to Quarto, I noticed that the original code used in this blog post, which involved the R package <code>rstan</code> has started to run very slowly. In the present version, I use <code>cmdstanr</code> instead.</p>
<p>If you want to follow along, you need the following R packages/settings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cmdstanr)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for fitting Bayesian models, v. 2.32.2</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(posterior) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for working with posterior distributions</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For drawing scatterplot matrices</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://janhove.github.io/RCode/scatterplot_matrix.R"</span>)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed for reproducibility</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020-01-21</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kind =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mersenne-Twister"</span>)</span></code></pre></div>
</div>
<p>You’ll also need the <code>MASS</code> package, but you don’t need to load it.</p>
</section>
<section id="demonstration-measurement-error-messes-up-statistical-control" class="level2">
<h2 class="anchored" data-anchor-id="demonstration-measurement-error-messes-up-statistical-control">Demonstration: Measurement error messes up statistical control</h2>
<p>Let’s first illustrate the problem that measurement error causes for statistical control using simulated data. That way, we know what goes into the data and what we hope a model should take out of it.</p>
<p>The scenario I want to focus on is the following. You are pretty sure that a given construct <code>A</code> causally affects a variable <code>Z</code>. You are, however, interested in finding out if another construct <code>B</code> also affects <code>Z</code>. You can’t manipulate any of the variables, so you have to make do with an observational study. Unfortunately, <code>A</code> and <code>B</code> are likely to be correlated. Let’s simulate some data to make this more concrete:</p>
<ul>
<li>500 datapoints (<code>n</code>)</li>
<li>Constructs <code>A</code> and <code>B</code> are correlated at <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%200.73">.</li>
<li>Constructs <code>A</code> and <code>B</code> are normally distributed with standard deviations of 1.5 (<code>sd_A</code>) and 0.8 (<code>sd_B</code>), respectively. The means of these normal distributions are 3 and -4, respectively.</li>
</ul>
<p>The numbers in the list above aren’t special; I just wanted to make sure the model I will specify further down below isn’t restricted to assuming that the constructs are distributed normally with mean 0 and standard deviation 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate correlated constructs</span></span>
<span id="cb2-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb2-3">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.73</span></span>
<span id="cb2-4">sd_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span></span>
<span id="cb2-5">sd_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Given the correlation and the standard deviations,</span></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># construct the covariance matrix for the constructs like so:</span></span>
<span id="cb2-9">latent_covariance_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sd_A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sd_B)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, rho), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rho, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sd_A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sd_B))</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Draw data from the multivariate normal distribution:</span></span>
<span id="cb2-14">constructs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MASS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mvrnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb2-15">                            , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sigma =</span> latent_covariance_matrix)</span>
<span id="cb2-16">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> constructs[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb2-17">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> constructs[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span></code></pre></div>
</div>
<p>For the purposes of this simulation, I’ll generate data for <code>Z</code> that are affected by <code>A</code> but not by <code>B</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A influences Z, B doesn't</span></span>
<span id="cb3-2">Z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>)</span></code></pre></div>
</div>
<p>As <strong>Figure 1</strong> shows, <code>B</code> and <code>Z</code> are correlated, even though neither influences the other. This is because of their link with <code>A</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scatterplot_matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(Z, A, B))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-01-21-statistical-control-measurement-error/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> Even though variable <code>Z</code> isn’t causally affected by construct <code>B</code>, there exists a considerable correlation between <code>B</code> and <code>Z</code>. This correlation exists because <code>Z</code> is causally affected by construct <code>A</code>, which is correlated with <code>B</code>.</figcaption>
</figure>
</div>
</div>
</div>
<p>In situations such as these, researchers typically include both <code>A</code> and <code>B</code> as predictors in a model with <code>Z</code> as the outcome. And this works: we find a significant relationship between <code>A</code> and <code>Z</code>, but not between <code>B</code> and <code>Z</code>. Moreover, all estimated parameters are in the vicinity of their true values, as specified in the simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> B))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    2.881     0.5439    5.30 1.78e-07
A              0.609     0.0546   11.14 6.93e-26
B              0.146     0.1025    1.43 1.54e-01</code></pre>
</div>
</div>
<p>But in real life, the situation is more complicated. When researchers “statistically control” for a possible confound, they’re usually interested in controlling for the confounding <em>construct</em> rather than for any one <em>measurement</em> of this construct. For instance, when teasing apart the influences of L2 vocabulary knowledge and L2 morphosyntactic knowledge on L2 speaking fluency, researchers don’t actually want to control for the learners performance on this or that vocabulary test: they want to control for L2 vocabulary knowledge itself. One would hope that the vocabulary test gives a good indication of the learners’ vocabulary knowledge, but it’s understood that their performance will be affected by other factors as well (e.g., form on the day, luck with guessing, luck with the words occurring in the test etc.).</p>
<p>So let’s add some noise (measurement error) to constructs <code>A</code> and <code>B</code>. Here I express the measurement error in terms of the reliability of the instruments used to measure the constructs: If <img src="https://latex.codecogs.com/png.latex?%5Csigma_A"> is the standard deviation of the unobserved construct scores and <img src="https://latex.codecogs.com/png.latex?r_%7BAA'%7D"> is the reliability of the measurement instrument, then the standard deviation of the measurement error is <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B%5Cfrac%7B%5Csigma_A%5E2%7D%7Br_%7BAA'%7D%7D%20-%20%5Csigma_A%5E2%7D">. For the purposes of this demonstration, I’m going to specify that construct <code>A</code> was measured with ‘okay’ reliability (0.70), whereas construct <code>B</code> was measured with exceptional reliability (0.95):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">obs_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sd_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sd_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb7-2">obs_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sd_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sd_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</div>
<p>Crucially, if we include the observed values <code>obs_A</code> and <code>obs_B</code> as predictors in a model with <code>Z</code> as the outcome, we find that the parameter for <code>obs_B</code> is significant—even though there is no causal link between <code>B</code> and <code>Z</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> obs_A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> obs_B))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    4.842     0.4557   10.63 6.68e-24
obs_A          0.364     0.0418    8.71 4.36e-17
obs_B          0.456     0.0911    5.01 7.66e-07</code></pre>
</div>
</div>
<p>Descriptively, this is perfectly fine: You do indeed now know more about <code>Z</code> if you take into account <code>obs_B</code> in addition to <code>obs_A</code>. But you take this to interpret that the <em>construct</em> of <code>B</code> can explain variation in <code>Z</code> over and beyond that which can be explained by the construct of <code>A</code>, this would be a mistake.</p>
<p>Conceptually, what has happened is that since <code>obs_A</code> imperfectly reflects construct <code>A</code>, including <code>obs_A</code> in the model control for construct <code>A</code> imperfectly.</p>
</section>
<section id="fitting-a-model-that-takes-measurement-into-account" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-model-that-takes-measurement-into-account">Fitting a model that takes measurement into account</h2>
<p>Below is the Stan code I used for fitting the simulated data. The model takes as its input the three observed variables (<code>obs_A</code>, <code>obs_B</code> and <code>Z</code>). Information about the reliability of <code>obs_A</code> and <code>obs_B</code> is also provided in the form of a prior distribution on <code>reliability_A</code> and <code>reliability_B</code>. Specifically, it’s assumed that the reliability coefficient for <code>obs_A</code> is drawn from a <code>beta(30, 10)</code>-distribution. This assigns a 95% probability to the reliability coefficient lying between roughly 0.61 and 0.87. <code>obs_B</code> is assumed to be measured more reliably, as encoded by a <code>beta(95, 5)</code>-distribution, which assigns a 95% probability to the reliability coefficient lying between 0.90 and 0.98.</p>
<p>Importantly, as I <a href="https://homeweb.unifr.ch/VanhoveJ/Pub/statistical_control.html">noted</a> in some earlier explorations, the model has to take into account the possibility that the constructs of <code>A</code> and <code>B</code> are correlated. I specified a prior vaguely expecting a positive correlation but that wouldn’t find correlations close to or below zero to be too surprising either. Priors on the other parameters are pretty vague; I find it difficult to come up with reasonable priors in context-free examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">meas_error_code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb10-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data { </span></span>
<span id="cb10-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Number of observations</span></span>
<span id="cb10-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int&lt;lower = 1&gt; N;      </span></span>
<span id="cb10-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed outcome</span></span>
<span id="cb10-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] Z;         </span></span>
<span id="cb10-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed predictors</span></span>
<span id="cb10-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] obs_A;</span></span>
<span id="cb10-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] obs_B;</span></span>
<span id="cb10-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parameters {</span></span>
<span id="cb10-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Parameters for regression</span></span>
<span id="cb10-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real intercept;  </span></span>
<span id="cb10-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_A;</span></span>
<span id="cb10-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_B;</span></span>
<span id="cb10-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma; </span></span>
<span id="cb10-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations of latent variables (= constructs)</span></span>
<span id="cb10-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_A; </span></span>
<span id="cb10-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_B;</span></span>
<span id="cb10-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown but estimated reliabilities</span></span>
<span id="cb10-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_A;</span></span>
<span id="cb10-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_B;</span></span>
<span id="cb10-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Means of latent predictors</span></span>
<span id="cb10-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  row_vector[2] latent_means;</span></span>
<span id="cb10-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown correlation between latent predictors</span></span>
<span id="cb10-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = -1, upper = 1&gt; latent_rho;</span></span>
<span id="cb10-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Latent variables</span></span>
<span id="cb10-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[N, 2] latent_variables;</span></span>
<span id="cb10-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">} </span></span>
<span id="cb10-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">transformed parameters {</span></span>
<span id="cb10-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] mu_Z;  // conditional mean of outcome</span></span>
<span id="cb10-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_A; // latent variables, separated out</span></span>
<span id="cb10-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_B;</span></span>
<span id="cb10-39"></span>
<span id="cb10-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_A; // standard error of measurement</span></span>
<span id="cb10-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_B;</span></span>
<span id="cb10-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb10-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations of latent variables, in matrix form</span></span>
<span id="cb10-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[2, 2] sigma_lat; </span></span>
<span id="cb10-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // correlation and covariance matrix for latent variables </span></span>
<span id="cb10-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cor; </span></span>
<span id="cb10-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cov;</span></span>
<span id="cb10-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Standardised slopes for A and B</span></span>
<span id="cb10-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_A_std;</span></span>
<span id="cb10-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_B_std;</span></span>
<span id="cb10-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Express measurement error in terms of </span></span>
<span id="cb10-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviation of constructs and reliability</span></span>
<span id="cb10-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_A = sqrt(sigma_lat_A^2/reliability_A - sigma_lat_A^2);</span></span>
<span id="cb10-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_B = sqrt(sigma_lat_B^2/reliability_B - sigma_lat_B^2);</span></span>
<span id="cb10-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define diagonal matrix with standard errors of latent variables</span></span>
<span id="cb10-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 1] = sigma_lat_A;</span></span>
<span id="cb10-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 2] = sigma_lat_B;</span></span>
<span id="cb10-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 2] = 0;</span></span>
<span id="cb10-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 1] = 0;</span></span>
<span id="cb10-63"></span>
<span id="cb10-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define correlation matrix for latent variables</span></span>
<span id="cb10-65"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 1] = 1;</span></span>
<span id="cb10-66"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 2] = 1;</span></span>
<span id="cb10-67"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 2] = latent_rho;</span></span>
<span id="cb10-68"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 1] = latent_rho;</span></span>
<span id="cb10-69"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-70"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Compute covariance matrix for latent variables</span></span>
<span id="cb10-71"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cov = sigma_lat * latent_cor * sigma_lat;</span></span>
<span id="cb10-72"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-73"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Extract latent variables from matrix</span></span>
<span id="cb10-74"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_A = latent_variables[, 1];</span></span>
<span id="cb10-75"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_B = latent_variables[, 2];</span></span>
<span id="cb10-76"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-77"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Regression model</span></span>
<span id="cb10-78"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  mu_Z = intercept + slope_A*lat_A + slope_B*lat_B;</span></span>
<span id="cb10-79"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-80"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Standardised regression parameters</span></span>
<span id="cb10-81"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_A_std = slope_A * sigma_lat_A;</span></span>
<span id="cb10-82"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_B_std = slope_B * sigma_lat_B;</span></span>
<span id="cb10-83"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-84"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">model {</span></span>
<span id="cb10-85"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Priors for regression parameters</span></span>
<span id="cb10-86"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  intercept ~ normal(0, 2);</span></span>
<span id="cb10-87"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_A ~ normal(0, 2);</span></span>
<span id="cb10-88"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_B ~ normal(0, 2);</span></span>
<span id="cb10-89"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma ~ normal(0, 2);</span></span>
<span id="cb10-90"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-91"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for reliabilities</span></span>
<span id="cb10-92"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_A ~ beta(30, 10); // assume this has been estimated using some metric to be </span></span>
<span id="cb10-93"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                                // roughly 0.78, but with considerable uncertainty</span></span>
<span id="cb10-94"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_B ~ beta(95, 5); // assume this has been estimated using exceptional reliability</span></span>
<span id="cb10-95"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-96"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for latent means</span></span>
<span id="cb10-97"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_means ~ normal(0, 3);</span></span>
<span id="cb10-98"></span>
<span id="cb10-99"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior for latent standard deviations</span></span>
<span id="cb10-100"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_A ~ normal(0, 2);</span></span>
<span id="cb10-101"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat_B ~ normal(0, 2);</span></span>
<span id="cb10-102"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-103"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior expectation for correlation between latent variables:</span></span>
<span id="cb10-104"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // tend towards positive rho</span></span>
<span id="cb10-105"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_rho ~ normal(0.4, 0.3);</span></span>
<span id="cb10-106"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-107"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Distribution of latent variable</span></span>
<span id="cb10-108"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) {</span></span>
<span id="cb10-109"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    latent_variables[i, ] ~ multi_normal(latent_means, latent_cov);</span></span>
<span id="cb10-110"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb10-111"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-112"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Measurement model</span></span>
<span id="cb10-113"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  obs_A ~ normal(lat_A, error_A);</span></span>
<span id="cb10-114"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  obs_B ~ normal(lat_B, error_B);</span></span>
<span id="cb10-115"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-116"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Generate outcome</span></span>
<span id="cb10-117"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  Z ~ normal(mu_Z, sigma);</span></span>
<span id="cb10-118"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-119"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span></code></pre></div>
</div>
<p>Let’s put the data into a Stan-friendly list and fit the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb11-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z =</span> Z,</span>
<span id="cb11-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_A =</span> obs_A,</span>
<span id="cb11-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_B =</span> obs_B,</span>
<span id="cb11-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> n</span>
<span id="cb11-6">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">meas_error_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cmdstan_model</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_stan_file</span>(meas_error_code))</span>
<span id="cb12-2">model_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> meas_error_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list</span>
<span id="cb12-4">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span></span>
<span id="cb12-5">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb12-6">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parallel_chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb12-7">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb12-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_sampling =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb12-9">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refresh =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb12-10">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_treedepth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span id="cb12-11">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span></span>
<span id="cb12-12">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 1 Iteration:  500 / 4000 [ 12%]  (Warmup) 
Chain 4 Iteration:  500 / 4000 [ 12%]  (Warmup) 
Chain 3 Iteration:  500 / 4000 [ 12%]  (Warmup) 
Chain 2 Iteration:  500 / 4000 [ 12%]  (Warmup) 
Chain 1 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
Chain 3 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
Chain 4 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
Chain 2 Iteration: 1000 / 4000 [ 25%]  (Warmup) 
Chain 1 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
Chain 3 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
Chain 4 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
Chain 2 Iteration: 1500 / 4000 [ 37%]  (Warmup) 
Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 1 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
Chain 3 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 3 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
Chain 4 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 4 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 2 Iteration: 2001 / 4000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
Chain 3 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
Chain 2 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
Chain 3 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
Chain 4 Iteration: 2500 / 4000 [ 62%]  (Sampling) 
Chain 1 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
Chain 2 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
Chain 3 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
Chain 1 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
Chain 4 Iteration: 3000 / 4000 [ 75%]  (Sampling) 
Chain 3 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 3 finished in 283.6 seconds.
Chain 2 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 1 finished in 311.5 seconds.
Chain 4 Iteration: 3500 / 4000 [ 87%]  (Sampling) 
Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 2 finished in 330.5 seconds.
Chain 4 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 4 finished in 349.7 seconds.

All 4 chains finished successfully.
Mean chain execution time: 318.8 seconds.
Total execution time: 349.9 seconds.</code></pre>
</div>
</div>
<p>I’ve turn off warning notifications for this blog post, but I did receive this one:</p>
<blockquote class="blockquote">
<p>Warning: 4 of 4 chains had an E-BFMI less than 0.2. See https://mc-stan.org/misc/warnings for details.</p>
</blockquote>
<p>The mc-stan website does indeed contain some advice, but I’m going to ignore this warning for the time being and get on with the blog post.</p>
<p>That said, all estimated parameters are pretty much on the money. Importantly, include the estimated slope for the <code>B</code> construct (<code>slope_B</code>: -0.09, with a 95% credible interval of [-0.66, 0.33]). Notice, too, that the model was able to figure out the correlation between the latent constructs <code>A</code> and <code>B</code> (<code>latent_rho</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">model_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(</span>
<span id="cb14-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variables =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span></span>
<span id="cb14-3">                ,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_B"</span></span>
<span id="cb14-4">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_means"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_rho"</span></span>
<span id="cb14-5">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_A_std"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_B_std"</span></span>
<span id="cb14-6">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_B"</span>)</span>
<span id="cb14-7">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sd"</span></span>
<span id="cb14-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">extra_quantiles =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile2</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>))</span>
<span id="cb14-9">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rhat"</span></span>
<span id="cb14-10">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 6
   variable          mean     sd   q2.5  q97.5  rhat
   &lt;chr&gt;            &lt;num&gt;  &lt;num&gt;  &lt;num&gt;  &lt;num&gt; &lt;num&gt;
 1 intercept        1.25  1.63   -2.38   3.92   1.01
 2 slope_A          0.782 0.185   0.483  1.20   1.02
 3 slope_B         -0.137 0.277  -0.750  0.316  1.01
 4 sigma            1.21  0.0742  1.05   1.35   1.01
 5 sigma_lat_A      1.55  0.0850  1.39   1.72   1.01
 6 sigma_lat_B      0.828 0.0279  0.775  0.883  1.00
 7 latent_means[1]  2.90  0.0830  2.74   3.07   1.00
 8 latent_means[2] -4.01  0.0370 -4.08  -3.93   1.00
 9 latent_rho       0.775 0.0465  0.680  0.861  1.01
10 slope_A_std      1.21  0.249   0.792  1.76   1.01
11 slope_B_std     -0.114 0.230  -0.620  0.262  1.01
12 reliability_A    0.705 0.0618  0.593  0.829  1.01
13 reliability_B    0.950 0.0209  0.903  0.984  1.01</code></pre>
</div>
</div>
<p>To get some sense of what the model is doing, I’m going to extract the posterior distributions for the latent construct scores. These are the model’s guesses of which scores the simulated participants would have had if there had been no measurement error. These guesses are based on the information we’ve fed the model, including the observed variables, the relationships among them, and their probable reliability. I’m just going to work with the means of these posterior distributions, but there can be substantial uncertainty about the model’s guesses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">est_lat_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draws</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat_A"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"draws_matrix"</span>)</span>
<span id="cb16-2">est_lat_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> model_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draws</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat_B"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"draws_matrix"</span>)</span>
<span id="cb16-3"></span>
<span id="cb16-4"></span>
<span id="cb16-5">df_variables <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb16-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Z =</span> Z,</span>
<span id="cb16-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_A =</span> obs_A,</span>
<span id="cb16-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">obs_B =</span> obs_B,</span>
<span id="cb16-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">est_A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(est_lat_A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean),</span>
<span id="cb16-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">est_B =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(est_lat_B, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean)</span>
<span id="cb16-11">)</span></code></pre></div>
</div>
<p><strong>Figure 2</strong> shows the relationships among the three variables and shows <em>shrinkage</em> at work. For the variables about whose actual values there is uncertainty (viz., A and B), the model reckons that extreme values are caused by a combination of skill (or lack thereof) as well as good (or bad) luck. Accordingly, it adjusts these values towards the bulk of the data. In doing so, it takes into account both the correlation that we ‘expected’ between A and B as well as the possible relationship between A and B on the one hand and Z on the other. For A, the adjustments are fairly large because this variable was assumed to be measured with considerable error. For B, the adjustments are smaller. Z, finally, was assumed to be measured without error and so no adjustments are required.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Z vs. A</span></span>
<span id="cb17-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> obs_A, df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb17-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>)</span>
<span id="cb17-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> est_A, df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb17-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>obs_A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_A,</span>
<span id="cb17-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Z,</span>
<span id="cb17-9">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb17-10"></span>
<span id="cb17-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Z vs. B</span></span>
<span id="cb17-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> obs_B, df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb17-13">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z"</span>)</span>
<span id="cb17-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> est_B, df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb17-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>obs_B, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_B,</span>
<span id="cb17-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Z,</span>
<span id="cb17-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb17-18"></span>
<span id="cb17-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B vs. A</span></span>
<span id="cb17-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(obs_B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> obs_A, df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb17-21">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>)</span>
<span id="cb17-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(est_B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> est_A, df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb17-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>obs_A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_A,</span>
<span id="cb17-24">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>obs_B, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_B,</span>
<span id="cb17-25">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb17-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-01-21-statistical-control-measurement-error/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 2.</strong> The relationships among the three variables. The empty circles represent the variables as they were observed. The black circles represent, for each observation, the mean of the model’s guesses as to what the value would have been if there hadn’t been any measurement error.</figcaption>
</figure>
</div>
</div>
</div>
<p>In statistics at least, shrinkage is generally a good thing: The shrunken values (i.e., the model’s guesses) lie, on average, closer to the true but unobserved values than the observed values do. This is clearly the case for variable A:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> obs_A))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.724</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_A))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.518</code></pre>
</div>
</div>
<p>For variable B, the difference is negligible seeing as this variable was measured with exceptional reliability:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> obs_B))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.149</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_B))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.146</code></pre>
</div>
</div>
</section>
<section id="a-real-life-example-linguistic-interdependence" class="level2">
<h2 class="anchored" data-anchor-id="a-real-life-example-linguistic-interdependence">A real-life example: Linguistic interdependence</h2>
<p>For the simulated data, the model seemed to work okay, so let’s turn to a real-life example. I’ll skip the theoretical background, but several studies in applied linguistics have tried to find out if knowledge in a ‘heritage language’ contributes to the development of the societal language (For more information about such research, see Berthele &amp; Lambelet (2017), Vanhove &amp; Berthele (2017) and Berthele &amp; Vanhove (2017)). In a typical research design, researchers collect data on a group of pupils’ language skills in their heritage language as well as in their societal languages at the beginning of the school year. Then, at the end of the school year, they collect similar data. Unsurprisingly, pupils with relatively good societal language skills at the beginning of the year are still relatively good at the end. But what is sometimes also observed is that heritage language proficiency at the first data collection is a predictor of societal language proficiency at the second data collection, even after taking into account societal language proficiency at the first data collection.</p>
<p>It’s tempting but premature to interpret such findings as evidence for a beneficial effect of heritage language skills on the development of societal language proficiency. The reason is that (a) societal and heritage language proficiency are bound to be correlated at the first data collection due to factors such as intelligence, testwiseness, form on the day etc., and (b) language proficiency is invariably measured with error. This is true of heritage language proficiency, but most importantly, it’s true of the variable that is “statistically controlled for”, i.e., societal language proficiency. Consequently, it’s likely that an off-the-shelf statistical model undercorrects for the role of societal language proficiency and overestimates the role of heritage language profiency.</p>
<p>So let’s fit a model that takes measurement error into account.</p>
<section id="data-and-question" class="level3">
<h3 class="anchored" data-anchor-id="data-and-question">Data and question</h3>
<p>The data we’re going to analyse are a subset of those analysed by Vanhove &amp; Berthele (2017) and Berthele &amp; Vanhove (2017). We have data on 91 pupils with French as their societal language and Portuguese as their heritage language. The study consisted of three data collections (and many more pupils), but we’re just going to analyse the reading proficiency data collected during waves 2 and 3 here.</p>
<p>The full datasets are are available as an R package from https://github.com/janhove/helascot, but copy-paste the command below into R to work with the reduced dataset we’ll work with here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">skills <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">structure</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb26-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Subject =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_14"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_15"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_17"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A_PLF_9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_11"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AA_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_10"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_11"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_13"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_14"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_15"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_17"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_18"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_20"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_21"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_22"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_24"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_25"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_26"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AD_PLF_9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AE_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_19"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C_PLF_30"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_1"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D_PLF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_12"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_15"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_16"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_17"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_18"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_20"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_24"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_25"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_26"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_27"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_28"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_29"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_31"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_32"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_33"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_34"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_36"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_8"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y_PNF_9"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_2"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_3"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_4"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_5"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_6"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_7"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z_PLF_8"</span>)</span>
<span id="cb26-3">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>)</span>
<span id="cb26-4">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0526315789</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>)</span>
<span id="cb26-5">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2631578947</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>)</span>
<span id="cb26-6">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T3 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3684210526</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3157894737</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4736842105</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2105263158</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7368421053</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4210526316</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6315789474</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9473684211</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5789473684</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5263157895</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7894736842</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6842105263</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8421052632</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8947368421</span>)</span>
<span id="cb26-7">  )</span>
<span id="cb26-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>91L)</span>
<span id="cb26-9">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tbl_df"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tbl"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.frame"</span>)</span>
<span id="cb26-10">)</span></code></pre></div>
</div>
<p>We’re going to fit the French reading scores at the third data collection (<code>FR_T3</code>) in terms of the French and Portuguese reading scores at the second data collection (<code>FR_T2</code> and <code>PT_T2</code>). <strong>Figure 3</strong> shows the observed variables. Note that all values are bounded between 0 and 1, where 1 was the highest possible result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scatterplot_matrix</span>(skills <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(FR_T3, FR_T2, PT_T2))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-01-21-statistical-control-measurement-error/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 3.</strong> The relationships between the French proficiency scores at T3, the French proficiency scores at T2 and the Portuguese profiency scores at T2.</figcaption>
</figure>
</div>
</div>
</div>
<p>Fitting an off-the-shelf regression model, we find that <code>PT_T2</code> is significantly related to <code>FR_T3</code>, even when accounting for <code>FR_T2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(FR_T3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> FR_T2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> PT_T2, skills))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    0.266     0.0520    5.11 1.84e-06
FR_T2          0.506     0.0990    5.11 1.84e-06
PT_T2          0.196     0.0868    2.26 2.60e-02</code></pre>
</div>
</div>
<p>Lastly, as reported by Pestana et al.&nbsp;(2017), the reliability of the French reading test at T2 was estimated to be 0.73, with a 95% confidence interval of [0.65, 0.78]. For Portuguese at T2, the reliability was estimated to be 0.79, with a 95% confidence interval of [0.72, 0.84]. This is information we can feed to the model. (For French at T3, the estimated reliability coefficient was 0.73, 95% CI: [0.65, 0.79], but for now, we’re not going to model the measurement error on the outcome variable.)</p>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<p>The model specified below is essentially the same as the model for the simulated example, but with more informed priors.</p>
<p>The reliability estimates for the French T2 and Portuguese T2 variables were incorporated by means of prior distributions.</p>
<ul>
<li>For French T2, I put a <code>beta(73, 27)</code> prior on the reliability coefficient, which assigns a 95% probability of the reliablity coefficient lying between 0.64 and 0.81. This doesn’t exactly correspond to the estimated reliability coefficient’s confidence interval, but I think it’s close enough.</li>
<li>For Portuguese T2, I put a <code>beta(79, 21)</code> prior on the reliability coefficient, which assigns a 95% probability of the reliablity coefficient lying between 0.71 and 0.86.</li>
</ul>
<p>Other prior distributions reflect the fact that the predictor and the outcome data were restricted to the [0, 1] range and some common knowledge. The rationale for them is explained in the comments sprinkled throughout the code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">interdependence_code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb30-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data { </span></span>
<span id="cb30-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Number of observations</span></span>
<span id="cb30-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int&lt;lower = 1&gt; N;      </span></span>
<span id="cb30-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed outcome</span></span>
<span id="cb30-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] FR_T3;         </span></span>
<span id="cb30-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Observed predictors</span></span>
<span id="cb30-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] FR_T2;</span></span>
<span id="cb30-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] PT_T2;</span></span>
<span id="cb30-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parameters {</span></span>
<span id="cb30-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Parameters for regression</span></span>
<span id="cb30-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real intercept;  </span></span>
<span id="cb30-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_FR;</span></span>
<span id="cb30-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_PT;</span></span>
<span id="cb30-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma; </span></span>
<span id="cb30-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviations of latent variables</span></span>
<span id="cb30-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_FR_T2; </span></span>
<span id="cb30-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; sigma_lat_PT_T2;</span></span>
<span id="cb30-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown but estimated reliabilities</span></span>
<span id="cb30-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_FR_T2;</span></span>
<span id="cb30-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0, upper = 1&gt; reliability_PT_T2;</span></span>
<span id="cb30-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Means of latent predictors</span></span>
<span id="cb30-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  row_vector[2] latent_means;</span></span>
<span id="cb30-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Unknown correlation between latent predictors</span></span>
<span id="cb30-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = -1, upper = 1&gt; latent_rho;</span></span>
<span id="cb30-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Latent variables</span></span>
<span id="cb30-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[N, 2] latent_variables;</span></span>
<span id="cb30-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">} </span></span>
<span id="cb30-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">transformed parameters {</span></span>
<span id="cb30-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] mu_FR_T3;  // conditional mean of outcome</span></span>
<span id="cb30-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_FR_T2; // latent variables, separated out</span></span>
<span id="cb30-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] lat_PT_T2;</span></span>
<span id="cb30-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_FR_T2; // standard error of measurement</span></span>
<span id="cb30-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real error_PT_T2;</span></span>
<span id="cb30-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  matrix[2, 2] sigma_lat; // standard deviations of latent variables, in matrix form</span></span>
<span id="cb30-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cor; // correlation and covariance matrix for latent variables </span></span>
<span id="cb30-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cov_matrix[2] latent_cov;</span></span>
<span id="cb30-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_FR_std;</span></span>
<span id="cb30-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_PT_std;</span></span>
<span id="cb30-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Express measurement error in terms of </span></span>
<span id="cb30-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // standard deviation of constructs and reliability</span></span>
<span id="cb30-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_FR_T2 = sqrt(sigma_lat_FR_T2^2/reliability_FR_T2 - sigma_lat_FR_T2^2);</span></span>
<span id="cb30-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error_PT_T2 = sqrt(sigma_lat_PT_T2^2/reliability_PT_T2 - sigma_lat_PT_T2^2);</span></span>
<span id="cb30-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define diagonal matrix with standard errors of latent variables</span></span>
<span id="cb30-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 1] = sigma_lat_FR_T2;</span></span>
<span id="cb30-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 2] = sigma_lat_PT_T2;</span></span>
<span id="cb30-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[1, 2] = 0;</span></span>
<span id="cb30-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma_lat[2, 1] = 0;</span></span>
<span id="cb30-57"></span>
<span id="cb30-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Define correlation matrix for latent variables</span></span>
<span id="cb30-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 1] = 1;</span></span>
<span id="cb30-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 2] = 1;</span></span>
<span id="cb30-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[1, 2] = latent_rho;</span></span>
<span id="cb30-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cor[2, 1] = latent_rho;</span></span>
<span id="cb30-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Compute covariance matrix for latent variables</span></span>
<span id="cb30-65"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_cov = sigma_lat * latent_cor * sigma_lat;</span></span>
<span id="cb30-66"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-67"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Extract latent variables from matrix</span></span>
<span id="cb30-68"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_FR_T2 = latent_variables[, 1];</span></span>
<span id="cb30-69"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  lat_PT_T2 = latent_variables[, 2];</span></span>
<span id="cb30-70"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-71"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Regression model</span></span>
<span id="cb30-72"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  mu_FR_T3 = intercept + slope_FR*lat_FR_T2 + slope_PT*lat_PT_T2;</span></span>
<span id="cb30-73"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-74"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Standardised regression parameters</span></span>
<span id="cb30-75"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_FR_std = slope_FR * sigma_lat_FR_T2;</span></span>
<span id="cb30-76"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_PT_std = slope_PT * sigma_lat_PT_T2;</span></span>
<span id="cb30-77"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-78"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">model {</span></span>
<span id="cb30-79"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Priors for regression parameters; these essentially</span></span>
<span id="cb30-80"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // reflect the fact that the data lie in the [0, 1] interval.</span></span>
<span id="cb30-81"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // The intercept is for FR_T2 and PT_T2 = 0, so a pupil with</span></span>
<span id="cb30-82"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // poor scores at T2. So probably pretty low.</span></span>
<span id="cb30-83"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  intercept ~ normal(0.20, 0.10);</span></span>
<span id="cb30-84"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // French at T2 is bound to positively predict French at T3,</span></span>
<span id="cb30-85"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // but the slope can at most be 1 (bounded data).</span></span>
<span id="cb30-86"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_FR ~ normal(0.50, 0.25);</span></span>
<span id="cb30-87"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Portuguese at T2 is not necessarily a positive predictor of</span></span>
<span id="cb30-88"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // French at T3, given French at T2. So centre around 0.</span></span>
<span id="cb30-89"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_PT ~ normal(0, 0.25);</span></span>
<span id="cb30-90"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // If neither of the T2 variables predicts T3, uncertainty</span></span>
<span id="cb30-91"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // is highest when the mean T3 score is 0.5. Since these scores</span></span>
<span id="cb30-92"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // are bounded between 0 and 1, the standard deviation could not </span></span>
<span id="cb30-93"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // be much higher than 0.20. But French T2 is bound to be a predictor,</span></span>
<span id="cb30-94"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // so let us choose a slighlty lower value.</span></span>
<span id="cb30-95"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  sigma ~ normal(0.15, 0.08);</span></span>
<span id="cb30-96"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-97"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior reliabilities</span></span>
<span id="cb30-98"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_FR_T2 ~ beta(73, 27); // alpha = 0.73, 95% CI [0.65, 0.78], </span></span>
<span id="cb30-99"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                                    // which is roughly beta(73, 27)</span></span>
<span id="cb30-100"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  reliability_PT_T2 ~ beta(79, 21);  // alpha = 0.79, 95% CI [0.72, 0.84]</span></span>
<span id="cb30-101"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-102"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior expectation for latent means, viz., the means</span></span>
<span id="cb30-103"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // for French and Portuguese T2. These are going to be in the 0.4-0.6</span></span>
<span id="cb30-104"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // range.</span></span>
<span id="cb30-105"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_means ~ normal(0.50, 0.10);</span></span>
<span id="cb30-106"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-107"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Prior expectation for correlation between latent variables:</span></span>
<span id="cb30-108"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // tend towards positive rho; pretty vague;</span></span>
<span id="cb30-109"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  latent_rho ~ normal(0.4, 0.3);</span></span>
<span id="cb30-110"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-111"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Distribution of latent variable</span></span>
<span id="cb30-112"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) {</span></span>
<span id="cb30-113"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    latent_variables[i, ] ~ multi_normal(latent_means, latent_cov);</span></span>
<span id="cb30-114"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb30-115"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-116"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Measurement model</span></span>
<span id="cb30-117"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FR_T2 ~ normal(lat_FR_T2, error_FR_T2);</span></span>
<span id="cb30-118"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  PT_T2 ~ normal(lat_PT_T2, error_PT_T2);</span></span>
<span id="cb30-119"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-120"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Generate outcome</span></span>
<span id="cb30-121"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FR_T3 ~ normal(mu_FR_T3, sigma);</span></span>
<span id="cb30-122"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-123"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb31-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T2 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T2,</span>
<span id="cb31-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T2 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PT_T2,</span>
<span id="cb31-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T3 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3,</span>
<span id="cb31-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(skills)</span>
<span id="cb31-6">)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">interdependence_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cmdstan_model</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_stan_file</span>(interdependence_code))</span>
<span id="cb32-2">interdependence_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> interdependence_model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(</span>
<span id="cb32-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list</span>
<span id="cb32-4">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span></span>
<span id="cb32-5">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb32-6">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parallel_chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb32-7">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb32-8">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter_sampling =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6000</span></span>
<span id="cb32-9">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refresh =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb32-10">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_treedepth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb32-11">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">adapt_delta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb32-12">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 8000 [  0%]  (Warmup) 
Chain 4 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 1 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 2 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 3 Iteration: 1000 / 8000 [ 12%]  (Warmup) 
Chain 4 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 4 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 1 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 1 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 2 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 2 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 3 Iteration: 2000 / 8000 [ 25%]  (Warmup) 
Chain 3 Iteration: 2001 / 8000 [ 25%]  (Sampling) 
Chain 4 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 1 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 2 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 3 Iteration: 3000 / 8000 [ 37%]  (Sampling) 
Chain 4 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 1 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 2 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 3 Iteration: 4000 / 8000 [ 50%]  (Sampling) 
Chain 4 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 1 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 2 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 3 Iteration: 5000 / 8000 [ 62%]  (Sampling) 
Chain 1 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 4 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 2 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 3 Iteration: 6000 / 8000 [ 75%]  (Sampling) 
Chain 1 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 2 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 4 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 3 Iteration: 7000 / 8000 [ 87%]  (Sampling) 
Chain 1 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 1 finished in 119.3 seconds.
Chain 2 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 2 finished in 119.8 seconds.
Chain 4 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 4 finished in 120.4 seconds.
Chain 3 Iteration: 8000 / 8000 [100%]  (Sampling) 
Chain 3 finished in 124.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 120.9 seconds.
Total execution time: 124.2 seconds.</code></pre>
</div>
</div>
<p>After tweaking the <code>adapt_delta</code> and <code>max_treedepth</code> parameters and letting the model run for a sufficient number of iterations, it converged without errors or warnings.</p>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p>Compared to the off-the-shelf <code>lm()</code> model, the model that takes measurement errors and correlated predictors into account estimates the parameter for <code>FR_T2</code> to be higher and that of <code>PT_T2</code> to be lower. It is also more uncertain about these parameters than the off-the-shelf model, I think appropriately so. The slope for <code>PT_T2</code>, which is the important bit, is now estimated to be 0.10, with a 95% credible interval of [-0.17, 0.38]. So when you take measurement error into account, you find that there is less evidence for a beneficial effect of heritage language proficiency on the development of societal language proficiency that you could otherwise have thought. Moreover, the model estimates that the correlation between <code>FR_T2</code> and <code>PT_T2</code> is in the vicinity of 0.81 rather than 0.67, once measurement error has been accounted for.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">interdependence_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(</span>
<span id="cb34-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variables =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_FR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_PT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span></span>
<span id="cb34-3">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_FR_T2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma_lat_PT_T2"</span></span>
<span id="cb34-4">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_means"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latent_rho"</span></span>
<span id="cb34-5">                , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_FR_T2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reliability_PT_T2"</span>)</span>
<span id="cb34-6">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sd"</span></span>
<span id="cb34-7">  , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">extra_quantiles =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile2</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">probs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>))</span>
<span id="cb34-8">  , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rhat"</span></span>
<span id="cb34-9">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 6
   variable           mean     sd    q2.5 q97.5  rhat
   &lt;chr&gt;             &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt; &lt;num&gt;
 1 intercept         0.191 0.0536  0.0869 0.297  1.00
 2 slope_FR          0.712 0.156   0.405  1.02   1.00
 3 slope_PT          0.105 0.140  -0.169  0.382  1.00
 4 sigma             0.116 0.0114  0.0941 0.139  1.00
 5 sigma_lat_FR_T2   0.155 0.0122  0.133  0.181  1.00
 6 sigma_lat_PT_T2   0.182 0.0141  0.157  0.212  1.00
 7 latent_means[1]   0.653 0.0183  0.617  0.689  1.00
 8 latent_means[2]   0.642 0.0210  0.601  0.683  1.00
 9 latent_rho        0.813 0.0783  0.643  0.949  1.00
10 reliability_FR_T2 0.750 0.0392  0.670  0.823  1.00
11 reliability_PT_T2 0.790 0.0402  0.706  0.863  1.00</code></pre>
</div>
</div>
<p>Considerable shrinkage is observed for both predictors (<strong>Figure 4</strong>); keep in mind that we didn’t account for measurement error on the outcome. The plots in the top row shows how predictor values that are pretty low given a certain outcome value are shifted toward the right and how predictor values that are pretty high given a certain outcome value get shifted toward the left. The plot in the bottom row additionally shows that the model has learnt, among other things, that if a participant has a high <code>PT_T2</code> score but a low <code>FR_T2</code> score, that the former is probably an overestimate and the latter is likely an underestimate. So it adjusts both values towards the centre.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">lat_FR_T2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> interdependence_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draws</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat_FR_T2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"draws_matrix"</span>)</span>
<span id="cb36-2">lat_PT_T2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> interdependence_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draws</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat_PT_T2"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"draws_matrix"</span>)</span>
<span id="cb36-3"></span>
<span id="cb36-4">df_variables <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb36-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T3 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3,</span>
<span id="cb36-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FR_T2 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T2,</span>
<span id="cb36-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PT_T2 =</span> skills<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PT_T2,</span>
<span id="cb36-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">est_FR_T2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(lat_FR_T2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean),</span>
<span id="cb36-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">est_PT_T2 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(lat_PT_T2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean)</span>
<span id="cb36-10">)</span>
<span id="cb36-11"></span>
<span id="cb36-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb36-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(FR_T3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> FR_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb36-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(FR_T3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> est_FR_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb36-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_FR_T2,</span>
<span id="cb36-16">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3,</span>
<span id="cb36-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey60"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb36-18"></span>
<span id="cb36-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(FR_T3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> PT_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb36-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(FR_T3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> est_PT_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb36-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PT_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_PT_T2,</span>
<span id="cb36-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T3,</span>
<span id="cb36-23">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey60"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb36-24"></span>
<span id="cb36-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(PT_T2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> FR_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb36-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">points</span>(est_PT_T2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> est_FR_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_variables, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb36-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>FR_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_FR_T2,</span>
<span id="cb36-28">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>PT_T2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> df_variables<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>est_PT_T2,</span>
<span id="cb36-29">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey60"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2020-01-21-statistical-control-measurement-error/index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 4.</strong> Relationships among the predictors and the outcome. The empty circles represent the variables as they were observed. The black circles represent, for each observation, the mean of the model’s guesses as to what the value would have been if there hadn’t been any measurement error.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="caveats" class="level2">
<h2 class="anchored" data-anchor-id="caveats">Caveats</h2>
<ul>
<li>I’m just trying to figure out this stuff, so this blog posts comes with absolutely no warranties.</li>
<li>We only took into account <em>reliability</em> and we took <em>validity</em> for granted. In the real-life example, this means that we acknowledged that the French reading test measured French reading proficiency imperfectly — but we did assume that it, deep down, measured French reading proficiency. You can easily imagine a test that measures something highly reliably, but that still doesn’t reflect what it’s supposed to measure well. (For instance, a highly reliable trivia quiz about the Belgian national football team under the reign of Georges Leekens that’s used to represent general intelligence.) Taking measurement error (in terms of unreliability) into account doesn’t fix possible validity problems.</li>
</ul>
</section>
<section id="software-versions" class="level2">
<h2 class="anchored" data-anchor-id="software-versions">Software versions</h2>
<p>Please note that I reran the code on this page on August 6, 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">session_info</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.1 (2023-06-16)
 os       Ubuntu 22.04.2 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_US
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Zurich
 date     2023-08-06
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package        * version date (UTC) lib source
 abind            1.4-5   2016-07-21 [1] CRAN (R 4.3.1)
 backports        1.4.1   2021-12-13 [1] CRAN (R 4.3.0)
 cachem           1.0.6   2021-08-19 [2] CRAN (R 4.2.0)
 callr            3.7.3   2022-11-02 [1] CRAN (R 4.3.1)
 checkmate        2.2.0   2023-04-27 [1] CRAN (R 4.3.1)
 cli              3.6.1   2023-03-23 [1] CRAN (R 4.3.0)
 cmdstanr       * 0.6.0   2023-08-02 [1] local
 colorspace       2.1-0   2023-01-23 [1] CRAN (R 4.3.0)
 crayon           1.5.2   2022-09-29 [1] CRAN (R 4.3.1)
 data.table       1.14.8  2023-02-17 [1] CRAN (R 4.3.0)
 devtools         2.4.5   2022-10-11 [1] CRAN (R 4.3.1)
 digest           0.6.29  2021-12-01 [2] CRAN (R 4.2.0)
 distributional   0.3.2   2023-03-22 [1] CRAN (R 4.3.1)
 dplyr          * 1.1.2   2023-04-20 [1] CRAN (R 4.3.0)
 ellipsis         0.3.2   2021-04-29 [2] CRAN (R 4.2.0)
 evaluate         0.15    2022-02-18 [2] CRAN (R 4.2.0)
 fansi            1.0.4   2023-01-22 [1] CRAN (R 4.3.1)
 farver           2.1.1   2022-07-06 [1] CRAN (R 4.3.0)
 fastmap          1.1.0   2021-01-25 [2] CRAN (R 4.2.0)
 forcats        * 1.0.0   2023-01-29 [1] CRAN (R 4.3.0)
 fs               1.5.2   2021-12-08 [2] CRAN (R 4.2.0)
 generics         0.1.3   2022-07-05 [1] CRAN (R 4.3.0)
 ggplot2        * 3.4.2   2023-04-03 [1] CRAN (R 4.3.0)
 glue             1.6.2   2022-02-24 [2] CRAN (R 4.2.0)
 gtable           0.3.3   2023-03-21 [1] CRAN (R 4.3.0)
 hms              1.1.3   2023-03-21 [1] CRAN (R 4.3.0)
 htmltools        0.5.5   2023-03-23 [1] CRAN (R 4.3.0)
 htmlwidgets      1.6.2   2023-03-17 [1] CRAN (R 4.3.1)
 httpuv           1.6.11  2023-05-11 [1] CRAN (R 4.3.1)
 jsonlite         1.8.7   2023-06-29 [1] CRAN (R 4.3.1)
 knitr            1.39    2022-04-26 [2] CRAN (R 4.2.0)
 later            1.3.1   2023-05-02 [1] CRAN (R 4.3.1)
 lifecycle        1.0.3   2022-10-07 [1] CRAN (R 4.3.0)
 lubridate      * 1.9.2   2023-02-10 [1] CRAN (R 4.3.0)
 magrittr         2.0.3   2022-03-30 [1] CRAN (R 4.3.0)
 MASS             7.3-60  2023-05-04 [4] CRAN (R 4.3.1)
 matrixStats      1.0.0   2023-06-02 [1] CRAN (R 4.3.1)
 memoise          2.0.1   2021-11-26 [2] CRAN (R 4.2.0)
 mime             0.10    2021-02-13 [2] CRAN (R 4.0.2)
 miniUI           0.1.1.1 2018-05-18 [1] CRAN (R 4.3.1)
 munsell          0.5.0   2018-06-12 [1] CRAN (R 4.3.0)
 pillar           1.9.0   2023-03-22 [1] CRAN (R 4.3.0)
 pkgbuild         1.4.2   2023-06-26 [1] CRAN (R 4.3.1)
 pkgconfig        2.0.3   2019-09-22 [2] CRAN (R 4.2.0)
 pkgload          1.3.2.1 2023-07-08 [1] CRAN (R 4.3.1)
 posterior      * 1.4.1   2023-03-14 [1] CRAN (R 4.3.1)
 prettyunits      1.1.1   2020-01-24 [2] CRAN (R 4.2.0)
 processx         3.8.2   2023-06-30 [1] CRAN (R 4.3.1)
 profvis          0.3.8   2023-05-02 [1] CRAN (R 4.3.1)
 promises         1.2.0.1 2021-02-11 [1] CRAN (R 4.3.1)
 ps               1.7.5   2023-04-18 [1] CRAN (R 4.3.1)
 purrr          * 1.0.1   2023-01-10 [1] CRAN (R 4.3.0)
 R6               2.5.1   2021-08-19 [2] CRAN (R 4.2.0)
 Rcpp             1.0.11  2023-07-06 [1] CRAN (R 4.3.1)
 readr          * 2.1.4   2023-02-10 [1] CRAN (R 4.3.0)
 remotes          2.4.2   2021-11-30 [2] CRAN (R 4.2.0)
 rlang            1.1.1   2023-04-28 [1] CRAN (R 4.3.0)
 rmarkdown        2.21    2023-03-26 [1] CRAN (R 4.3.0)
 rstudioapi       0.14    2022-08-22 [1] CRAN (R 4.3.0)
 scales           1.2.1   2022-08-20 [1] CRAN (R 4.3.0)
 sessioninfo      1.2.2   2021-12-06 [2] CRAN (R 4.2.0)
 shiny            1.7.4.1 2023-07-06 [1] CRAN (R 4.3.1)
 stringi          1.7.12  2023-01-11 [1] CRAN (R 4.3.1)
 stringr        * 1.5.0   2022-12-02 [1] CRAN (R 4.3.0)
 tensorA          0.36.2  2020-11-19 [1] CRAN (R 4.3.1)
 tibble         * 3.2.1   2023-03-20 [1] CRAN (R 4.3.0)
 tidyr          * 1.3.0   2023-01-24 [1] CRAN (R 4.3.0)
 tidyselect       1.2.0   2022-10-10 [1] CRAN (R 4.3.0)
 tidyverse      * 2.0.0   2023-02-22 [1] CRAN (R 4.3.1)
 timechange       0.2.0   2023-01-11 [1] CRAN (R 4.3.0)
 tzdb             0.4.0   2023-05-12 [1] CRAN (R 4.3.0)
 urlchecker       1.0.1   2021-11-30 [1] CRAN (R 4.3.1)
 usethis          2.2.2   2023-07-06 [1] CRAN (R 4.3.1)
 utf8             1.2.3   2023-01-31 [1] CRAN (R 4.3.1)
 vctrs            0.6.3   2023-06-14 [1] CRAN (R 4.3.0)
 withr            2.5.0   2022-03-03 [2] CRAN (R 4.2.0)
 xfun             0.39    2023-04-20 [1] CRAN (R 4.3.0)
 xtable           1.8-4   2019-04-21 [1] CRAN (R 4.3.1)
 yaml             2.3.5   2022-02-21 [2] CRAN (R 4.2.0)

 [1] /home/jan/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>Stan</category>
  <category>Bayesian statistics</category>
  <category>measurement error</category>
  <category>correlational studies</category>
  <guid>https://janhove.github.io/posts/2020-01-21-statistical-control-measurement-error/index.html</guid>
  <pubDate>Mon, 20 Jan 2020 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Baby steps in Bayes: Piecewise regression with two breakpoints</title>
  <dc:creator>Jan Vanhove</dc:creator>
  <link>https://janhove.github.io/posts/2018-07-27-bayesian-two-breakpoint-model/index.html</link>
  <description><![CDATA[ 



<p>In this follow-up to the blog post <a href="../2018-07-04-bayesian-breakpoint-model"><em>Baby steps in Bayes: Piecewise regression</em></a>, I’m going to try to model the relationship between two continuous variables using a piecewise regression with not one but two breakpoints. (The rights to the movie about the first installment are still up for grabs, incidentally.)</p>
<p>The kind of relationship I want to model is plotted in Figure 1. According to some applied linguists, relationships similar to these underpin some aspects of language learning, but we don’t need to go into those discussions here.</p>
<p><strong>Update (2023-08-06):</strong> When I reran the code in this blog post using newer versions of Stan and R, I ran into serious convergence issues. I have pulled down this blog post till I figure out how to fix these.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_53b534ad284dc7a0378bc08f553af82a">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-27-bayesian-two-breakpoint-model/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> The underlying form of the x-y relationship is characterised by two breakpoints. The function’s three pieces are connected to each other.</figcaption>
</figure>
</div>
</div>
</div>
<!-- The code below shows how you can generate such an x-y relationship -->
<!-- and adds a modicum of noise to it. Figure 2 shows the simulated -->
<!-- data we'll work with in this blog post. I'm not going to analyse -->
<!-- actual data at this juncture because it's Friday afternoon and -->
<!-- I want to ride my bike. -->
<!-- ```{r, fig.width = 6, fig.height = 4} -->
<!-- # Set random seed (today's date) -->
<!-- set.seed(2018-07-27) -->
<!-- # 56 data points -->
<!-- n <- 56 -->
<!-- # Generate predictor data -->
<!-- x <- runif(n, min = 0, max = 20) -->
<!-- # Set the breakpoints -->
<!-- bp1 <- 4.3 -->
<!-- bp2 <- 13.6 -->
<!-- # Set the intercept and the slope  -->
<!-- # for the first piece (before first breakpoint) -->
<!-- a1 <- 4 -->
<!-- b1 <- 0.2 -->
<!-- # Set the intercept and the slope -->
<!-- # for the *third* piece (after the second breakpoint) -->
<!-- a3 <- 12 -->
<!-- b3 <- 0.1 -->
<!-- # The underlying form of the second piece -->
<!-- # is a straight line connecting the first and third piece -->
<!-- # at the breakpoints. I won't bore you with the derivation, -->
<!-- # but this results in the following intercept and slope: -->
<!-- a2 <- (a1*bp2 + b1*bp1*bp2 - a3*bp1 - b3*bp1*bp2) / (bp2 - bp1) -->
<!-- b2 <- ((a3 + b3*bp2) - (a1 + b1*bp1)) / (bp2 - bp1) -->
<!-- # Generate average conditional y values -->
<!-- y <- vector(length = n) -->
<!-- for (i in 1:n) { -->
<!--   # Before 1st breakpoint -->
<!--   if (x[i] < bp1) { -->
<!--     y[i] <- a1 + b1*x[i] -->
<!--   # After 2nd breakpoint -->
<!--   } else if (x[i] > bp2) { -->
<!--     y[i] <- a3 + b3*x[i] -->
<!--   # Else (between the two breakpoints) -->
<!--   } else { -->
<!--     y[i] <- a2 + b2*x[i] -->
<!--   } -->
<!-- } -->
<!-- # Add some noise -->
<!-- y_obs <- y + rnorm(n = n, sd = 1) -->
<!-- # Plot -->
<!-- plot(x, y_obs) -->
<!-- ``` -->
<!-- > **Figure 2.** The simulated data we'll work with. -->
<!-- ## Specifying the model -->
<!-- If none of this makes sense to you, please refer to the previous -->
<!-- _Baby steps in Bayes_ blog post. -->
<!-- ### `data` -->
<!-- There's an _x_ and a _y_ variable, both of length _N_ (here: N = 56). -->
<!-- ### `parameters` -->
<!-- This model has 7 parameters: -->
<!-- * Two breakpoints. Instead of specifying both breakpoints in the `parameters` block, I specify the first one (`bp1`) as well as the distance between the first and the second one (`bp_distance`). This allows me to tell the model that that the second breakpoint needs to occur after the first one by constraining the distance between them to be positive. -->
<!-- * the intercept and slope of the regression before the first breakpoint -->
<!-- (`a1` and `b1`); -->
<!-- * the intercept and slope of the regression after the _third_ breakpoint -->
<!-- (`a3` and `b3`). Note that I don't specify the intercept and the slope of the model's second piece, i.e., between the two breakpoints. The reason is that I want the three pieces to be connected at the breakpoints. With this constraint, if you know the form of the first and third piece as well as the position of the two breakpoint, you get the intercept and the slope of the second piece for free. -->
<!-- * the standard deviation of the normal error. Standard deviations are always positive; -->
<!--     this constraint is set by including `<lower = 0>` in the declaration. -->
<!-- ### `transformed parameters` -->
<!-- As in the previous blog post, I specify a transformed parameter -->
<!-- that contains the mean of _y_ conditional on the value of _x_. -->
<!-- Additionally, for convenience, I derive three parameters from -->
<!-- those specified in the previous block: the position of the -->
<!-- second breakpoint (from the position of the first and the -->
<!-- distance between them), as well as the intercept and slope -->
<!-- of the second piece (`a2` and `b2`). -->
<!-- (Sidebar: Since the second piece needs to be connected to -->
<!-- the other two pieces at the respective breakpoint, the  -->
<!-- expected _y_ value at the first breakpoint equals -->
<!-- both `a1` + `b1`*`bp1`  -->
<!-- and `a2` + `b2`*`bp1`. Similarly, the expected _y_ value -->
<!-- at the second breakpoint equals both -->
<!-- `a3` + `b3`*`bp2` -->
<!-- and `a2` + `b2`*`bp2`. From these equalities, `a2` and `b2` -->
<!-- can be expressed in terms of the parameters specified above.) -->
<!-- ### `model` -->
<!-- This works similarly to the model specification in the previous blog post. -->
<!-- Since I only work with simulated data here, the priors aren't informed -->
<!-- by any subject-matter knowledge. -->
<!-- ### `generated quantities` -->
<!-- To check if the model picks up on the relevant aspects of the data, -->
<!-- I let it generate alternative datasets. Ideally, these look similar -->
<!-- to the actual data analysed. -->
<!-- ```{r} -->
<!-- model_2bp <- ' -->
<!-- data {  -->
<!--   int<lower=1> N;  // total number of observations (integer); at least 1 -->
<!--   real y[N];       // outcome variable with N elements (real-valued) -->
<!--   real x[N];       // predictor variable with N elements (real-valued) -->
<!-- } -->
<!-- parameters {  -->
<!--   real bp1;                       // breakpoint 1 -->
<!--   real<lower = 0> bp_distance;    // distance between breakpoint1 and 2; -->
<!--                                   // bp2 needs to occur after bp1 -->
<!--   real a_1;          // intercept and slope before breakpoint 1 -->
<!--   real b_1; -->
<!--   real a_3;          // intercept and slope before breakpoint 3 -->
<!--   real b_3; -->
<!--   real<lower = 0> error;  // standard deviation of residuals -->
<!-- }  -->
<!-- transformed parameters{ -->
<!--   vector[N] conditional_mean; // the estimated average -->
<!--   real bp2;  // second breakpoint -->
<!--   real a_2;  // intercept and slope of the second piece -->
<!--   real b_2;  // (between two breakpoints) -->
<!--   bp2 = bp1 + bp_distance; -->
<!--   a_2 = (a_1*bp2 + b_1*bp1*bp2 - a_3*bp1 - b_3*bp1*bp2) / (bp2 - bp1); -->
<!--   b_2 = ((a_3 + b_3*bp2) - (a_1 + b_1*bp1)) / (bp2 - bp1); -->
<!--   // the conditional mean depends on the predictor value s -->
<!--   // position relative to the breakpoints -->
<!--   for (i in 1:N) { -->
<!--     if (x[i] < bp1) { -->
<!--       conditional_mean[i] = a_1 + b_1 * x[i]; -->
<!--     } else if (x[i] > bp2) { -->
<!--       conditional_mean[i] = a_3 + b_3 * x[i]; -->
<!--     } else { -->
<!--       conditional_mean[i] = a_2 + b_2 * x[i]; -->
<!--     } -->
<!--   } -->
<!-- } -->
<!-- model { -->
<!--   // Set priors. These are painfully uninformed. -->
<!--   a_1 ~ normal(0, 25); -->
<!--   a_3 ~ normal(0, 25); -->
<!--   a_1 ~ normal(0, 25); -->
<!--   a_3 ~ normal(0, 25); -->
<!--   bp1 ~ normal(0, 25); -->
<!--   bp_distance ~ normal(0, 25);  // constrained to be positive -->
<!--   error ~ normal(0, 25);        // Residual error, likely between 0 and 2*25 -->
<!--   // How the data are expected to have been generated: -->
<!--   // normal distribution with mu = conditional_mean and  -->
<!--   // std = error, estimated from data. -->
<!--   for (i in 1:N) { -->
<!--     y[i] ~ normal(conditional_mean[i], error); -->
<!--   } -->
<!-- } -->
<!-- generated quantities { -->
<!--   vector[N] sim_y;               // Simulate new data using estimated parameters. -->
<!--   for (i in 1:N) { -->
<!--     sim_y[i] = normal_rng(conditional_mean[i], error); -->
<!--   } -->
<!-- } -->
<!-- ' -->
<!-- ``` -->
<!-- ## Running the model -->
<!-- To fit the model, first put the input data in a list. -->
<!-- Then supply this list and the model code to the `stan()` -->
<!-- function. The `stan()` function prints a lot of output  -->
<!-- to the console, which I didn't reproduce here.  -->
<!-- Unless you receive genuine warnings or error (i.e., red text),  -->
<!-- everything's fine. (Apologies for the blatant self-plagiarism throughout, -->
<!-- by the way.) -->
<!-- ```{r, eval = FALSE} -->
<!-- data_list <- list( -->
<!--   x = x, -->
<!--   y = y_obs, -->
<!--   N = n -->
<!-- ) -->
<!-- fit_2bp_sim <- stan(model_code = model_2bp,  -->
<!--                    data = data_list) -->
<!-- ``` -->
<!-- ## Inspecting the model -->
<!-- ### Model summary -->
<!-- A summary with the parameter estimates and their -->
<!-- uncertainties can be generated using the `print()` function. -->
<!-- ```{r, eval = FALSE} -->
<!-- print(fit_2bp_sim, -->
<!--       par = c("bp1", "bp2", -->
<!--               "a_1", "b_1",  -->
<!--               "a_2", "b_2", -->
<!--               "a_3", "b_3", -->
<!--               "error")) -->
<!-- ``` -->
<!-- <pre><code>Inference for Stan model: ade2f0f31038d9a48e5f69f1db76bc89. -->
<!-- 4 chains, each with iter=2000; warmup=1000; thin=1;  -->
<!-- post-warmup draws per chain=1000, total post-warmup draws=4000. -->
<!--        mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat -->
<!-- bp1    2.58    0.05 1.30  1.11  1.63  2.15  3.28  6.02   804    1 -->
<!-- bp2   14.53    0.02 0.68 13.04 14.14 14.58 14.97 15.73  1922    1 -->
<!-- a_1    4.57    0.02 0.64  3.40  4.12  4.52  5.00  5.88  1113    1 -->
<!-- b_1   -0.77    0.03 0.89 -2.76 -1.31 -0.61 -0.06  0.40   808    1 -->
<!-- a_2    1.20    0.01 0.56 -0.10  0.92  1.25  1.55  2.11  1433    1 -->
<!-- b_2    0.87    0.00 0.06  0.78  0.84  0.87  0.90  1.00  1552    1 -->
<!-- a_3   15.08    0.09 3.50  8.88 12.63 14.90 17.33 22.32  1552    1 -->
<!-- b_3   -0.08    0.01 0.21 -0.50 -0.21 -0.07  0.06  0.31  1557    1 -->
<!-- error  0.93    0.00 0.10  0.76  0.86  0.92  0.99  1.14  1991    1 -->
<!-- Samples were drawn using NUTS(diag_e) at Fri Jul 27 15:59:51 2018. -->
<!-- For each parameter, n_eff is a crude measure of effective sample size, -->
<!-- and Rhat is the potential scale reduction factor on split chains (at  -->
<!-- convergence, Rhat=1). -->
<!-- </code></pre> -->
<!-- Seems okay! -->
<!-- ### Posterior predictive checks -->
<!-- If the model is any good, data simulated from it should be pretty similar -->
<!-- to the data actually observed. In the `generated quantities` block, I let the -->
<!-- model output such simulated data (`sim_y`). Using the `shinystan` package, -->
<!-- we can perform some 'posterior predictive checks': -->
<!-- ```{r, eval = FALSE} -->
<!-- shinystan::launch_shinystan(fit_2bp_sim) -->
<!-- ``` -->
<!-- Click 'Diagnose' > 'PPcheck'. Under 'Select y (vector of observations)',  -->
<!-- pick `y_obs` (the simulated data analysed above). -->
<!-- Under 'Parameter/generated quantity from model', -->
<!-- pick `sim_y` (the additional simulated data generated in the model code). -->
<!-- Then click on 'Distributions of observed data vs replications' and  -->
<!-- 'Distributions of test statistics' to check if the properties of the simulated data correspond -->
<!-- to those of the real data. -->
<!-- You can also take this a step further and check whether the -->
<!-- model is able to generate scatterplots similar to the one in Figure 2. -->
<!-- If the following doesn't make any immediate sense, please refer -->
<!-- to the blog post [_Checking model assumptions without getting paranoid_](http://janhove.github.io/analysis/2018/04/25/graphical-model-checking), -->
<!-- because the logic is pretty similar. -->
<!-- First extract some vectors of simulated data from the model output: -->
<!-- ```{r, eval = FALSE} -->
<!-- # rstan's 'extract' is likely to conflict with another function -->
<!-- # called 'extract', so specify the package, too. -->
<!-- simulated_data <- rstan::extract(fit_2bp_sim)$sim_y -->
<!-- # simulated_data is a matrix with 4000 rows and 80 columns. -->
<!-- # For the plot, I select 8 rows at random: -->
<!-- simulated_data <- simulated_data[sample(1:4000, 8), ] -->
<!-- ``` -->
<!-- ```{r, echo = FALSE} -->
<!-- simulated_data <- structure(c(13.5683735697402, 12.9081854520952, 10.5768549815246,  -->
<!-- 12.8147367853547, 13.1487244078447, 13.316245208143, 10.959743017377,  -->
<!-- 13.6490194694834, 9.78395987872582, 8.49244837112598, 8.31710825769251,  -->
<!-- 8.48923188703118, 8.72015794019388, 8.41311511132302, 8.18989274986422,  -->
<!-- 9.58925193939856, 8.86238484280032, 6.57686391657304, 7.69795749383113,  -->
<!-- 6.89284501313733, 7.56237520906309, 7.50806761050338, 8.76190042766021,  -->
<!-- 8.67182420785998, 8.6928028288423, 5.55477998539817, 8.50813026981642,  -->
<!-- 6.84861246943879, 7.17618153424334, 7.79669353082753, 8.45511186439401,  -->
<!-- 7.17151846140017, 14.3088093255198, 13.8211717113766, 15.3455923024115,  -->
<!-- 15.2553861144777, 14.2313659913129, 13.2377277088191, 13.3887500248933,  -->
<!-- 15.2527573305137, 15.6460830657283, 12.1309089586467, 14.7136592885399,  -->
<!-- 12.7291103800342, 13.6740725434368, 14.4432535656368, 14.2640154016915,  -->
<!-- 10.9250036664887, 3.9688491270586, 4.87934904974409, 5.34687189743106,  -->
<!-- 4.08595063519405, 7.22681869228831, 4.50583744346245, 2.77695034356361,  -->
<!-- 6.20378141625895, 8.3820321029879, 9.03372834284815, 10.2158734744762,  -->
<!-- 7.11924205336344, 8.17293345543818, 8.86185534907652, 9.33436296563401,  -->
<!-- 8.82486300760958, 12.5453721253363, 13.2316802485173, 13.9815378471748,  -->
<!-- 13.1364291483257, 12.2732901976504, 12.9808185618598, 14.1097354129038,  -->
<!-- 15.1537973647598, 4.69743511321255, 6.26800631733108, 4.38488728390592,  -->
<!-- 3.41700479746604, 6.11247364420876, 3.81711552682839, 4.19157547089119,  -->
<!-- 6.35712566601734, 16.3092084457261, 11.8140685852232, 11.1660561361674,  -->
<!-- 15.6755109971535, 12.4569519390928, 11.8861551266335, 12.6714785452217,  -->
<!-- 14.8460850148032, 4.84357977810708, 4.54151283193202, 5.17640732905581,  -->
<!-- 3.18931343946384, 4.8139448595798, 3.99458221362743, 5.55319059461788,  -->
<!-- 7.13295426372094, 13.7154148968281, 13.3293601768584, 12.0823041480577,  -->
<!-- 13.220908584496, 12.6209859267399, 13.1510004870888, 13.9213813361034,  -->
<!-- 13.5735835765393, 14.0391799190229, 13.9594375745017, 13.8681444785924,  -->
<!-- 11.8273419596164, 12.387024372949, 12.8549516168471, 11.6622810309046,  -->
<!-- 13.1634279942848, 4.74192141272618, 5.69308086320964, 3.82209370650379,  -->
<!-- 4.58741159384222, 4.5585023092884, 5.84183427155652, 2.66277280696669,  -->
<!-- 5.66931172907579, 5.65312847482157, 4.60652378643584, 6.007381097473,  -->
<!-- 5.88679007907044, 3.09541512081622, 5.05504122731778, 6.10349219483331,  -->
<!-- 4.11694422683763, 7.81376134890236, 5.61552820858451, 4.7680441409887,  -->
<!-- 5.9040597706272, 6.76172625964629, 6.56804974156864, 5.70646512426775,  -->
<!-- 8.55959740251826, 14.8859478442859, 12.8641810016763, 13.9507146722941,  -->
<!-- 13.6511939826119, 14.0610036592348, 12.0932309167473, 11.9561690985747,  -->
<!-- 13.3834704224446, 14.9370845695921, 13.2168760021731, 13.175084099748,  -->
<!-- 13.8226169138792, 13.6987999085873, 12.4715790190766, 15.3958701946985,  -->
<!-- 14.7639843784549, 6.63023597536539, 4.59185631372637, 3.69081845690731,  -->
<!-- 2.55220324741457, 6.08125067720779, 4.154016116382, 4.09261142835553,  -->
<!-- 4.44839609665883, 12.9491400387427, 12.1646710164101, 11.9281706710298,  -->
<!-- 12.5054942559561, 12.4518705606822, 12.8143931076607, 12.5628211995582,  -->
<!-- 12.5935228989305, 5.03782815355735, 6.30141606778796, 4.90962012273959,  -->
<!-- 4.29555082720262, 3.365640040133, 6.1998375017999, 4.89742492774428,  -->
<!-- 5.99280211023225, 11.0795191166155, 12.1563578051134, 11.5499275768628,  -->
<!-- 11.5460470765062, 10.6418079744087, 12.5046948087229, 13.0220444883974,  -->
<!-- 10.7715398734765, 14.1235926646024, 13.5711849323716, 13.293079334189,  -->
<!-- 13.8668056795503, 15.3982482508425, 13.8165055735617, 13.987151892333,  -->
<!-- 13.4651718288937, 14.1293028566529, 12.4610748421791, 13.95930013212,  -->
<!-- 15.1496812165805, 12.4467128550288, 11.9201443851972, 14.2938945127407,  -->
<!-- 13.4066073658686, 1.8101398270232, 3.13735180697985, 4.06687006860786,  -->
<!-- 3.89865020805013, 5.81466464359527, 2.61065079229029, 4.27585757686367,  -->
<!-- 3.27178852774207, 13.2357022873919, 14.3087840566066, 15.3682303130033,  -->
<!-- 13.348208323644, 13.6500209655888, 11.5510094742505, 13.3892230951155,  -->
<!-- 13.1269537482756, 10.2560945667933, 12.0804359922268, 10.3592910218725,  -->
<!-- 9.54934149735539, 10.293714365207, 11.2643403559912, 11.7239627676568,  -->
<!-- 10.6036279188435, 9.55594327569744, 9.31879581808449, 9.24028715065364,  -->
<!-- 9.73346365867902, 11.8821899020964, 10.5439880763218, 10.7485928152214,  -->
<!-- 9.24117996961579, 10.9292989908077, 10.3619339566336, 12.4045562204842,  -->
<!-- 10.823636029506, 9.72703506764117, 11.106111914153, 11.7094464867645,  -->
<!-- 10.939110443624, 14.5948001230739, 14.8709996411887, 12.9334131023175,  -->
<!-- 11.9492396023828, 15.4453441990957, 13.2087884938439, 13.5428583784485,  -->
<!-- 13.9256903696192, 7.56030693185435, 7.05279956588672, 8.03303336203786,  -->
<!-- 7.5000684143347, 8.31604210107347, 8.2519985263163, 7.68331936264887,  -->
<!-- 8.87907523214119, 10.9293968261616, 10.3447962925712, 10.2716943549776,  -->
<!-- 11.2494034270377, 11.7406773854441, 11.5089046537027, 10.9977949499264,  -->
<!-- 10.4825988894381, 13.9756222629304, 14.6435647781498, 13.9591666595927,  -->
<!-- 13.0617519503357, 14.0499910851471, 14.436761585219, 13.6475792838987,  -->
<!-- 14.4368840474788, 3.69235502717146, 4.5084144797248, 3.38543440756485,  -->
<!-- 4.02977962628335, 4.75084501491881, 4.99414906799036, 4.00899718735494,  -->
<!-- 4.43986622395757, 8.25866880196598, 7.26681716201199, 8.13859200529837,  -->
<!-- 9.1382868059443, 8.50951773899218, 8.36208627120442, 8.65122215224939,  -->
<!-- 7.72185288962409, 11.9367931388013, 10.7142885611107, 11.5803959172978,  -->
<!-- 12.0462874067845, 9.30535534374599, 10.4333645929495, 10.2132803297655,  -->
<!-- 11.1824759331199, 6.75870897352042, 5.52486581742635, 5.86611688239546,  -->
<!-- 5.74685362488144, 6.10326392607041, 5.84743540176226, 5.82204740607404,  -->
<!-- 7.73893990093243, 2.50652052994591, 2.7422587162081, 5.170087994605,  -->
<!-- 3.8028833228593, 2.64661229088362, 3.31285518906668, 3.22363541171269,  -->
<!-- 2.53359866822847, 5.44917984059094, 2.982480347715, 5.20516609042656,  -->
<!-- 4.13851164156202, 5.4885499188388, 4.12993227837141, 3.97687735162155,  -->
<!-- 5.96030753301912, 15.7133395378645, 12.999376471723, 16.1181866932608,  -->
<!-- 12.337071575629, 15.1650607742458, 13.6524161016291, 12.6808178746546,  -->
<!-- 14.1757572717131, 6.62705668591796, 7.09022354219416, 5.05461258038296,  -->
<!-- 6.37251411162891, 7.12223538479519, 5.05307817756348, 7.43204721321097,  -->
<!-- 5.22605149604714, 12.3347697661121, 13.2750963393163, 13.3688010896872,  -->
<!-- 12.0274316026794, 13.1968068946288, 12.4920266312779, 11.5147888360166,  -->
<!-- 12.8291131844521, 8.61364558639231, 6.42030437860931, 8.36775763331026,  -->
<!-- 7.45620504812666, 7.43702839087896, 7.09332024613087, 7.69193621972322,  -->
<!-- 8.20188352613619, 5.59675081602031, 5.94116817748094, 5.48260373028767,  -->
<!-- 5.23254189737255, 4.71129373728976, 5.32941509981951, 6.92392476074608,  -->
<!-- 7.36929265003196, 14.5631963921835, 12.8520189143259, 13.1810576615304,  -->
<!-- 13.1609197935848, 12.5615750714967, 13.7967855277834, 13.1792405064234,  -->
<!-- 14.6000560819013, 15.3106621126363, 12.730319561334, 15.0887431339083,  -->
<!-- 14.1379783628686, 15.0528170622869, 12.7264116685208, 13.7746077080625,  -->
<!-- 13.7404947924029, 7.76330453978015, 9.74164519043531, 9.98340845977725,  -->
<!-- 8.55027450458247, 10.4929426590874, 10.6586458400499, 9.70821281466514,  -->
<!-- 8.79716058278874, 10.0902938182913, 12.4397650040982, 9.5459481324861,  -->
<!-- 8.64339793702649, 10.206756265369, 8.59608018612427, 9.53678212351657,  -->
<!-- 9.5422304863076, 13.5273182873046, 14.0635439907617, 12.566198054847,  -->
<!-- 14.6083181046382, 12.9262806117314, 12.5533302454073, 12.3662145987562,  -->
<!-- 12.5621843721202, 12.3545304956476, 12.7279311345207, 11.7796594955452,  -->
<!-- 11.4554515289435, 10.6683999472386, 12.7829441539383, 12.158232007489,  -->
<!-- 11.1482039398415, 3.5712996604042, 3.11366522727335, 4.72275537041487,  -->
<!-- 3.30382029727844, 3.26414102007094, 2.87225684372709, 4.6919729371398,  -->
<!-- 1.66382921530937, 10.6343605636659, 10.5084714811187, 8.72264030609084,  -->
<!-- 10.3377622551636, 10.7367359599381, 10.933497779381, 10.2066249999531,  -->
<!-- 11.4966330910903, 3.82760779139892, 4.52121058841527, 1.43736292466022,  -->
<!-- 1.21402735476862, 4.56051060448518, 4.8193457278838, 3.62777744374615,  -->
<!-- 4.3842572968243, 13.6640162109695, 13.1730907941801, 14.1383885169289,  -->
<!-- 13.5062904896795, 15.1144064762676, 15.1239863338965, 14.9798815485757,  -->
<!-- 14.4981417778829, 4.01690805760752, 4.18092247443039, 4.19945198754768,  -->
<!-- 2.03601517531419, 4.22055458670584, 3.56944471594118, 3.34938683742488,  -->
<!-- 3.76091903444052), .Dim = c(8L, 56L), .Dimnames = structure(list( -->
<!--     iterations = NULL, NULL), .Names = c("iterations", ""))) -->
<!-- data_list <- list( -->
<!--   x = x, -->
<!--   y = y_obs, -->
<!--   N = n -->
<!-- ) -->
<!-- ``` -->
<!-- Then plot both the observed vectors and the simulated vectors: -->
<!-- ```{r, message = FALSE, echo = TRUE, fig.width = 8, fig.height = 6} -->
<!-- par(mfrow = c(3, 3)) -->
<!-- # Plot the observed data -->
<!-- plot(data_list$x, data_list$y, -->
<!--      xlab = "x", ylab = "y", -->
<!--      main = "observed") -->
<!-- # Plot the simulated data -->
<!-- for (i in 1:8) { -->
<!--   plot(data_list$x, simulated_data[i, ], -->
<!--        xlab = "x", ylab = "y", -->
<!--        main = "simulated") -->
<!-- } -->
<!-- par(mfrow = c(1, 1)) -->
<!-- ``` -->
<!-- > **Figure 3.** The actual input data (top left) and eight -->
<!-- > simulated datasets. If the simulated datasets are highly -->
<!-- > similar to the actual data, the model was able to learn -->
<!-- > the relevant patterns in the data. -->
<!-- Seems fine by me! -->



 ]]></description>
  <category>R</category>
  <category>piecewise regression</category>
  <category>non-linearities</category>
  <category>Bayesian statistics</category>
  <category>Stan</category>
  <guid>https://janhove.github.io/posts/2018-07-27-bayesian-two-breakpoint-model/index.html</guid>
  <pubDate>Thu, 26 Jul 2018 22:00:00 GMT</pubDate>
</item>
<item>
  <title>Baby steps in Bayes: Piecewise regression</title>
  <dc:creator>Jan Vanhove</dc:creator>
  <link>https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index.html</link>
  <description><![CDATA[ 



<p>Inspired by Richard McElreath’s excellent book <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em>, I’ve started dabbling in Bayesian statistics. In essence, Bayesian statistics is an approach to statistical inference in which the analyst specifies a generative model for the data (i.e., an equation that describes the factors they suspect gave rise to the data) as well as (possibly vague) relevant information or beliefs that are external to the data proper. This information or these beliefs are then adjusted in light of the data observed.</p>
<p>I’m hardly an expert in Bayesian statistics (or the more commonly encountered ‘orthodox’ or ‘frequentist’ statistics, for that matter), but I’d like to understand it better – not only conceptually, but also in terms of how the statistical model should be specified. While quite a few statisticians and methodologists tout Bayesian statistics for a variety of reasons, my interest is primarily piqued by the prospect of being able to tackle problems that would be impossible or at least awkward to tackle with the tools I’m pretty comfortable with at the moment.</p>
<p>In order to gain some familiarity with Bayesian statistics, I plan to set myself a couple of problems and track my efforts in solving them here in a <em>Dear diary</em> fashion. Perhaps someone else finds them useful, too.</p>
<p>The first problem that I’ll tackle is fitting a regression model in which the relationship between the predictor and the outcome may contain a breakpoint at one unknown predictor value. One domain in which such models are useful is in testing hypotheses that claim that the relationship between the age of onset of second language acquisition (AOA) and the level of ultimate attainment in that second language flattens after a certain age (typically puberty). It’s possible to fit frequentist breakpoint models, but estimating the breakpoint age is a bit cumbersome (see blog post <a href="../2014-08-20-adjusted-pvalues-breakpoint-regression"><em>Calibrating p-values in ‘flexible’ piecewise regression models</em></a>). But in a Bayesian approach, it should be possible to estimate both the regression parameters as well as the breakpoint itself in the same model. That’s what I’ll try here.</p>
<section id="software" class="level2">
<h2 class="anchored" data-anchor-id="software">Software</h2>
<p>Apart from R, you’ll need RStan. Follow the installation instructions on RStan’s <a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started">GitHub page</a>.</p>
<p>Once you’ve installed RStan, fire up a new R session and run these commands.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-1_3c8370e7d47616681fde281647049b0c">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load rstan package</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)</span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Avoid unnecessary recompiling</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rstan_options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">auto_write =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># optional: Distribute work over multiple CPU cores</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mc.cores =</span> parallel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>())</span></code></pre></div>
</div>
</section>
<section id="simulating-some-data" class="level2">
<h2 class="anchored" data-anchor-id="simulating-some-data">Simulating some data</h2>
<p>I’ll analyse some real data in a minute. But I think it’s useful to analyse some data I know the true data generating mechanism of first in order to make sure that the model works as intended. The commands below generate data with properties comparable to the real data I’ll analyse in a bit.</p>
<p>The first graph below shows the mean outcome value (‘GJT’, i.e., L2 grammaticality judgement task result) depending on the age of onset of acquisition. As you can see, there’s a bend in the function at age 10.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-2_c3ca601d014784ad46a087450cbfee71">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed (today's date)</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RNGversion</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3.5.3"</span>)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018-07-04</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 80 data points</span></span>
<span id="cb2-6">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate 'age of acquisition' data (integers between 1 and 50)</span></span>
<span id="cb2-9">AOA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set breakpoint at some plausible age</span></span>
<span id="cb2-12">BP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate average values on GJT (~ 'grammar test') outcome</span></span>
<span id="cb2-15">meanGJT <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(AOA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> BP,</span>
<span id="cb2-16">                  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (AOA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> BP),</span>
<span id="cb2-17">                  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (AOA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> BP))</span>
<span id="cb2-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(AOA, meanGJT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Underlying function"</span>)</span>
<span id="cb2-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">segments</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y1 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">segments</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x0 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x1 =</span> BP, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y0 =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> In the simulated data, the underlying relationship between AOA and GJT has a steeper slope for AOA values below 10 than for AOA values over 10.</figcaption>
</figure>
</div>
</div>
</div>
<p>In the second graph, some random normal error has been added to these mean values; it is the data in this figure that I’ll analyse first.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_e56959e9f5232934d0c647bd2128652b">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate observed values</span></span>
<span id="cb3-2">error <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-3">obsGJT <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> meanGJT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> error)</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(AOA, obsGJT, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed data"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption class="figure-caption">&gt; <strong>Figure 2.</strong> Interindividual differences obfuscate the nonlinear relationship and the true position of the breakpoint age somewhat.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="specifying-the-model" class="level2">
<h2 class="anchored" data-anchor-id="specifying-the-model">Specifying the model</h2>
<p>While there exist some (truly excellent) front-end interfaces for fitting Bayesian models (e.g., <a href="https://github.com/paul-buerkner/brms">brms</a>), I’ll specify the model in RStan proper. This is considerably more involved than writing out a model using R’s <code>lm()</code> function, but this added complexity buys you something in terms of flexibility.</p>
<p>A Stan model specification has three required blocks.</p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data"><code>data</code></h3>
<p>This is where you specify what the input data looks like. Below I specified that the model should accept two variables (<code>GJT</code> and <code>AOA</code>) both with the same number of observations (<code>N</code>). Unlike <code>lm()</code>, <code>stan()</code> accepts non-rectangular data (e.g., variables with different lengths), so you need to prespecify the number of observations per variable.</p>
</section>
<section id="parameters" class="level3">
<h3 class="anchored" data-anchor-id="parameters"><code>parameters</code></h3>
<p>The model parameters you want to estimate. A breakpoint regression model has five parameters:</p>
<ul>
<li>The breakpoint. I constrained the breakpoint to be between 1 and 20 since breakpoints beyond that range are inconsistent with any proposed theory;</li>
<li>the slope of the regression before the breakpoint;</li>
<li>the slope of the regression after the breakpoint;</li>
<li>a constant term (‘intercept’), most easily written as the expected outcome value at the breakpoint;</li>
<li>the standard deviation of the normal error. Standard deviations are always positive; this constraint is set by including <code>&lt;lower = 0&gt;</code> in the declaration. (Incidentally, the error term doesn’t have to be normal.)</li>
</ul>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model"><code>model</code></h3>
<p>This is where you specify how the parameters and the data relate to each other. The assumed (and for the simulated data: correct) data generating mechanism is that the observed GJT values were drawn from a normal distribution whose mean depends on the participant’s AOA (see <code>transformed parameters</code> below) and the breakpoint and which has the same standard deviation everywhere.</p>
<p>You also have to provide so-called prior distributions for any parameters. These encode the information or beliefs you have about the parameters which you didn’t need the data for. I set the following priors:</p>
<ul>
<li>A truncated normal prior for the breakpoint centred at 12 and with a standard deviation of 6. The prior is truncated at 1 and at 20; this was specified in the <code>parameters</code> block. This prior essentially encodes that, for all I know, the breakpoint occurs somewhere between the ages of 1 and 20 and is slightly more likely to occur around age 10 to 14 and around ages 2 or 19. I tried specifying a uniform prior, but that didn’t work.</li>
<li>Normal priors centred around 0 and with standard deviations of 5 for both slope parameters. What this means is that I think it’s highly unlikely that these slopes are incredibly steep (say, a 100-point increase or decrease per additional AOA). These priors aren’t particularly informative, though: According to them, negative and positive slopes are equally likely. If you have a sufficient amount of data, such priors only have a minimal effect on the results. But when you don’t have this luxury, even such slightly informative priors may be better than none at all for keeping the inferences within reasonable bounds.</li>
<li>A normal prior centred around 150 with a standard deviation of 25 for the intercept. This essentially means that I expect the average outcome at the breakpoint to lie somewhere between 100 and 200. For the real data I’ll analyse later, this assumption is reasonable enough since the data were pretty much guaranteed to be bound between 102 and 204.</li>
<li>A half-normal prior starting at 0 with a standard deviation of 20 for the standard deviation of the residuals. The <em>normal</em> part is specified in this prior, the <em>half</em> part results from the constraint set in the <code>parameters</code> block. A half-normal distribution starting at 0 with a standard deviation of 20 in essence encodes the belief that the residual error will probably have a standard deviation of less than 2*20 = 40, with smaller values being more likely than large ones. If you don’t set a prior for this parameter (or any other parameter, for that matter), a uniform prior spanning to infinity is assumed. So even when you don’t specify a prior, you’re using one.</li>
</ul>
<p>I also added two optional blocks:</p>
</section>
<section id="transformed-parameters" class="level3">
<h3 class="anchored" data-anchor-id="transformed-parameters"><code>transformed parameters</code></h3>
<p>This block specifies derivations of model parameters, be it because they’re the actual object of inference or just because it simplifies the notation. I specified two derived parameters.</p>
<ul>
<li><code>conditional_mean</code> describes the outcome of the regression equation without the error term for each observation:
<ul>
<li>If the participant’s AOA is <em>before</em> the breakpoint, <code>conditional_mean</code> = <code>intercept</code> + <code>slope1</code> * <code>AOA</code>.</li>
<li>If the participant’s AOA is <em>after</em> the breakpoint, <code>conditional_mean</code> = <code>intercept</code> + <code>slope2</code> * <code>AOA</code>.</li>
</ul></li>
<li><code>slope_difference</code> is just the difference between the slope after and the slope before the breakpoint.</li>
</ul>
</section>
<section id="generated-quantities" class="level3">
<h3 class="anchored" data-anchor-id="generated-quantities"><code>generated quantities</code></h3>
<p>Here you can specify some model outputs. I specified three such outputs:</p>
<ul>
<li><code>sim_GJT</code>: Using the <code>normal_rng()</code> function, I simulate new GJT data from the model for each AOA observation in the original dataset. If the model is approximately accurate, the actually observed data should look fairly similar to these simulated data points. I’ll check this later.</li>
<li><code>log_lik</code>: I won’t discuss this in this post.</li>
<li><code>sim_conditional_mean</code>: For each AOA between 1 and 50 (hence: a vector of length 50), I’ll ask the model to output what it thinks is the conditional GJT mean. This will be useful for drawing effect plots.</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_f67a7fce4a23de2bc2d0a7267c0b7962">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">bp_code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb4-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">// You need to specify the kind of input data, incl. number of observations.</span></span>
<span id="cb4-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data { </span></span>
<span id="cb4-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int&lt;lower=1&gt; N;  // total number of observations (integer); at least 1</span></span>
<span id="cb4-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real GJT[N];     // outcome variable with N elements (real-valued)</span></span>
<span id="cb4-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real AOA[N];     // predictor variable with N elements (real-valued)</span></span>
<span id="cb4-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">// the parameters to be estimated from the data</span></span>
<span id="cb4-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">parameters { </span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real intercept;                 // = predicted outcome at breakpoint</span></span>
<span id="cb4-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_before;              // slope before the breakpoint</span></span>
<span id="cb4-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_after;               // slope after the breakpoint</span></span>
<span id="cb4-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 1, upper = 20&gt; bp; // the breakpoint age, with some constraints</span></span>
<span id="cb4-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real&lt;lower = 0&gt; error;          // standard deviation of residuals</span></span>
<span id="cb4-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                                  //  (always positive, hence &lt;lower = 0&gt;)</span></span>
<span id="cb4-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">} </span></span>
<span id="cb4-18"></span>
<span id="cb4-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">// Functions of estimated parameters.</span></span>
<span id="cb4-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">transformed parameters{</span></span>
<span id="cb4-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] conditional_mean; // the estimated average GJT for each AOA observation</span></span>
<span id="cb4-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real slope_difference;      // the difference between slope_after and slope_before</span></span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_difference = slope_after - slope_before;  </span></span>
<span id="cb4-25"></span>
<span id="cb4-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // conditional_mean depends on whether AOA is before or after bp</span></span>
<span id="cb4-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) {</span></span>
<span id="cb4-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    if (AOA[i] &lt; bp) {</span></span>
<span id="cb4-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      conditional_mean[i] = intercept + slope_before * (AOA[i] - bp);</span></span>
<span id="cb4-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    } else {</span></span>
<span id="cb4-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      conditional_mean[i] = intercept + slope_after * (AOA[i] - bp);</span></span>
<span id="cb4-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb4-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb4-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-35"></span>
<span id="cb4-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">// The model itself specifies how the data are expected to have</span></span>
<span id="cb4-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">// been generated and what the prior expectations for the model parameters are.</span></span>
<span id="cb4-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">model {</span></span>
<span id="cb4-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Set priors</span></span>
<span id="cb4-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  intercept ~ normal(150, 25);  // Average GJT at breakpoint</span></span>
<span id="cb4-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_before ~ normal(0, 5);  // Slope before breakpoint</span></span>
<span id="cb4-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  slope_after ~ normal(0, 5);   // Slope after breakpoint</span></span>
<span id="cb4-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  bp ~ normal(12, 6);           // Breakpoint age, pretty wide, but somewhere in childhood/puberty</span></span>
<span id="cb4-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  error ~ normal(0, 20);        // Residual error, likely between 0 and 2*20</span></span>
<span id="cb4-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb4-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // How the data are expected to have been generated:</span></span>
<span id="cb4-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // normal distribution with mu = conditional_mean and </span></span>
<span id="cb4-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // std = error, estimated from data.</span></span>
<span id="cb4-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) {</span></span>
<span id="cb4-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    GJT[i] ~ normal(conditional_mean[i], error);</span></span>
<span id="cb4-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb4-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-53"></span>
<span id="cb4-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">generated quantities {</span></span>
<span id="cb4-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] sim_GJT;               // Simulate new data using estimated parameters.</span></span>
<span id="cb4-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[N] log_lik;               // Useful for model comparisons; not done here.</span></span>
<span id="cb4-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[50] sim_conditional_mean; // Useful for plotting.</span></span>
<span id="cb4-58"></span>
<span id="cb4-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  // Compute conditional means for AOAs between 1 and 50.</span></span>
<span id="cb4-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:50) {</span></span>
<span id="cb4-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    if (i &lt; bp) {</span></span>
<span id="cb4-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      sim_conditional_mean[i] = intercept + slope_before * (i - bp);</span></span>
<span id="cb4-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    } else {</span></span>
<span id="cb4-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      sim_conditional_mean[i] = intercept + slope_after * (i - bp);</span></span>
<span id="cb4-65"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb4-66"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb4-67"></span>
<span id="cb4-68"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:N) {</span></span>
<span id="cb4-69"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    sim_GJT[i] = normal_rng(conditional_mean[i], error);</span></span>
<span id="cb4-70"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    log_lik[i] = normal_lpdf(GJT[i] | conditional_mean[i], error);</span></span>
<span id="cb4-71"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb4-72"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-73"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span></code></pre></div>
</div>
</section>
</section>
<section id="running-the-model" class="level2">
<h2 class="anchored" data-anchor-id="running-the-model">Running the model</h2>
<p>To fit the model, first put the input data in a list. Then supply this list and the model code to the <code>stan()</code> function. The <code>stan()</code> function prints a lot of output to the console, which I didn’t reproduce here. Unless you receive genuine warnings or error (i.e., red text), everything’s fine.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_a687a4e236e6a42b87a5bc59f45725f2">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb5-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">AOA =</span> AOA,</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GJT =</span> obsGJT,</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(AOA)</span>
<span id="cb5-5">)</span>
<span id="cb5-6">fit_bp_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stan</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model_code =</span> bp_code, </span>
<span id="cb5-7">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list,</span>
<span id="cb5-8">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span>)</span></code></pre></div>
</div>
</section>
<section id="inspecting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-model">Inspecting the model</h2>
<section id="model-summary" class="level3">
<h3 class="anchored" data-anchor-id="model-summary">Model summary</h3>
<p>A summary with the parameter estimates and their uncertainties can be generated using the <code>print()</code> function.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_6d14aea95073b5d2ca32eddf99f1ef97">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(fit_bp_sim,</span>
<span id="cb6-2">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_before"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_after"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_difference"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
4 chains, each with iter=8000; warmup=4000; thin=1; 
post-warmup draws per chain=4000, total post-warmup draws=16000.

                   mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff
intercept        175.41    0.02 1.36 172.99 174.53 175.32 176.20 178.36  4271
bp                10.31    0.03 2.32   5.73   8.91  10.33  11.69  15.11  4639
slope_before      -1.21    0.01 0.36  -1.97  -1.35  -1.16  -1.00  -0.74  3927
slope_after       -0.38    0.00 0.03  -0.44  -0.40  -0.38  -0.36  -0.32  6081
slope_difference   0.83    0.01 0.36   0.34   0.62   0.78   0.97   1.57  4119
error              2.92    0.00 0.24   2.49   2.75   2.90   3.07   3.44  8623
                 Rhat
intercept           1
bp                  1
slope_before        1
slope_after         1
slope_difference    1
error               1

Samples were drawn using NUTS(diag_e) at Sun Aug  6 15:33:51 2023.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
<p>For each parameter, the <code>mean</code> column contains the mean estimate of that parameter, whereas the <code>50%</code> column contains its median estimate. The <code>sd</code> column shows the standard deviation of the parameter estimates; this corresponds to the parameter estimate’s standard error. The <code>2.5%</code>, <code>25%</code>, <code>75%</code> and <code>97.5%</code> columns contain the respective percentiles of the distribution of the parameter estimates. So the average estimated breakpoint (<code>bp</code>) occurs somewhere between age 10 and 11, with 95% of the estimates contained in an interval between roughly 6 and 15 years. Similarly, the average estimated slope before the breakpoint is about -1.2 with a 95% ‘credibility’ interval from -1.98 to -0.75, and so on. The parameter estimates, then, are neatly centred around their true values, suggesting that the model does what it’s supposed to do.</p>
</section>
<section id="posterior-predictive-checks" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictive-checks">Posterior predictive checks</h3>
<p>If the model is any good, data simulated from it should be pretty similar to the data actually observed. In the <code>generated quantities</code> block, I let the model output such simulated data (<code>sim_GJT</code>). Using the <code>shinystan</code> package, we can perform some ‘posterior predictive checks’:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_69edbe7b25d0710185c67de9dfac4478">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">shinystan<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">launch_shinystan</span>(fit_bp_sim)</span></code></pre></div>
</div>
<p>Click ‘Diagnose’ &gt; ‘PPcheck’. Under ‘Select y (vector of observations)’, pick <code>obsGJT</code> (the simulated data analysed above). Under ‘Parameter/generated quantity from model’, pick <code>sim_GJT</code> (the additional simulated data generated in the model code). Then click on ‘Distributions of observed data vs replications’ and ‘Distributions of test statistics’ to check if the properties of the simulated data correspond to those of the real data.</p>
<p>You can also take this a step further and check whether the model is able to generate scatterplots similar to the one in Figure 2. If the following doesn’t make any immediate sense, please refer to the blog post <a href="../2018-04-25-graphical-model-checking"><em>Checking model assumptions without getting paranoid</em></a>, because the logic is pretty similar.</p>
<p>First extract some vectors of simulated data from the model output:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_7a4c7237d94e8ac2bfbfdaa65466507e">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rstan's 'extract' is likely to conflict with another function</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># called 'extract', so specify the package, too.</span></span>
<span id="cb9-3">simulated_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rstan<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(fit_bp_sim)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sim_GJT</span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulated_data is a matrix with 4000 rows and 80 columns.</span></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For the plot, I select 8 rows at random:</span></span>
<span id="cb9-6">simulated_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> simulated_data[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), ]</span></code></pre></div>
</div>
<p>Then plot both the observed vectors and the simulated vectors:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_6cec63be8111f75826c31d46b75bb8d8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the observed data</span></span>
<span id="cb10-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AOA, data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GJT,</span>
<span id="cb10-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AOA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GJT"</span>,</span>
<span id="cb10-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed"</span>)</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the simulated data</span></span>
<span id="cb10-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AOA, simulated_data[i, ],</span>
<span id="cb10-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AOA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GJT"</span>,</span>
<span id="cb10-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"simulated"</span>)</span>
<span id="cb10-13">}</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 3.</strong> The actual input data (top left) and eight simulated datasets. If the simulated datasets are highly similar to the actual data, the model was able to learn the relevant patterns in the data.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
</div>
<p>The simulated data look pretty much identical to the observed data, again demonstrating that the model is doing a pretty good job of learning the patterns in the data. This isn’t surprising, since I knew how the data were generated and constructed the model correspondingly. But it’s reassuring.</p>
<p>(Incidentally, I’m sure it’s possible to generate lineups more similar to the ones in that <a href="../2018-04-25-graphical-model-checking">previous blog post</a>, but this blog post is long as it is already.)</p>
</section>
<section id="effect-plot" class="level3">
<h3 class="anchored" data-anchor-id="effect-plot">Effect plot</h3>
<p>To visualise the model, you can draw an effect plot showing the average estimated relationship between AOA and GJT as well as the uncertainty about this relationship. To this end, I had the model output vectors of the fitted conditional means for AOAs 1 through 50 (<code>sim_conditional_mean</code>). With the commands below, I extract these vectors and then compute their mean values as well as some percentiles at each AOA.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_3bb385c402405b797a6d8f8192c063a8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">sim_conditional_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rstan<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(fit_bp_sim)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sim_conditional_mean</span>
<span id="cb12-2">df_sim_cond_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">AOA =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb12-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meanGJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean),</span>
<span id="cb12-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lo80GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>),</span>
<span id="cb12-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hi80GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>),</span>
<span id="cb12-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lo95GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>),</span>
<span id="cb12-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hi95GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>)</span>
<span id="cb12-9">)</span>
<span id="cb12-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df_sim_cond_means)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  AOA  meanGJT  lo80GJT  hi80GJT  lo95GJT  hi95GJT
1   1 186.0867 184.3968 187.7745 183.4985 188.7348
2   2 184.8770 183.4161 186.3232 182.6086 187.1155
3   3 183.6743 182.4180 184.9381 181.6091 185.5990
4   4 182.4817 181.3312 183.6296 180.4895 184.1939
5   5 181.2997 180.1643 182.4048 179.2258 182.9274
6   6 180.1329 178.9212 181.2531 177.9611 181.7475</code></pre>
</div>
</div>
<p>These mean values and percentiles can then be plotted as follows; the black line shows the average regression line, the light grey ribbon its 95% credibility region, and the dark grey ribbon its 80% credibility region.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_2096b9556bc5ea04f4e028c8e42c7603">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_sim_cond_means,</span>
<span id="cb14-3">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> AOA,</span>
<span id="cb14-4">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> meanGJT)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> lo95GJT,</span>
<span id="cb14-6">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> hi95GJT),</span>
<span id="cb14-7">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> lo80GJT,</span>
<span id="cb14-9">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> hi80GJT),</span>
<span id="cb14-10">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgrey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 4.</strong> The modelled relationship between AOA and GJT for the made-up data with 80% and 95% credibility regions. The bend around AOA = 10 is noticeable but it smoothed out due to the uncertainty about the precise position of the breakpoint.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="and-now-for-real" class="level2">
<h2 class="anchored" data-anchor-id="and-now-for-real">And now for real</h2>
<p>Let’s now analyse some real data using the same model. These data stem from a study by <a href="https://doi.org/10.1017/S0142716410000056">DeKeyser et al.&nbsp;(2010)</a>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_b9b743b74da3e9587b8120f334e72f04">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://homeweb.unifr.ch/VanhoveJ/Pub/papers/CPH/DeKeyser2010NorthAmerica.csv"</span>)</span>
<span id="cb15-2">data_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb15-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">AOA =</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AOA,</span>
<span id="cb15-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GJT =</span> d<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GJT,</span>
<span id="cb15-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(d)</span>
<span id="cb15-6">)</span>
<span id="cb15-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AOA, data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GJT)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption"><strong>Figure 5.</strong> AOA–GJT relationship as observed in DeKeyser et al.’s (2010) North America study.</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s fit the model:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_26f93522399ab73abe9c1853bc8aad13">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">fit_bp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stan</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model_code =</span> bp_code, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_list, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refresh =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<p>And output summary statistics:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_2420e220fa4120b5d28ed0fdee43a7b9">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(fit_bp,</span>
<span id="cb17-2">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bp"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_before"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_after"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slope_difference"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
4 chains, each with iter=8000; warmup=4000; thin=1; 
post-warmup draws per chain=4000, total post-warmup draws=16000.

                   mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff
intercept        172.27    0.13 7.40 159.77 166.71 171.41 177.45 187.49  3385
bp                12.50    0.07 4.30   3.32   9.40  13.29  15.82  19.25  3436
slope_before      -2.83    0.04 2.38  -7.65  -3.85  -2.85  -1.98   3.29  3759
slope_after       -1.13    0.00 0.13  -1.37  -1.22  -1.13  -1.04  -0.86  5177
slope_difference   1.70    0.04 2.41  -4.45   0.83   1.76   2.77   6.51  3739
error             16.38    0.01 1.37  13.94  15.42  16.30  17.24  19.32  8827
                 Rhat
intercept           1
bp                  1
slope_before        1
slope_after         1
slope_difference    1
error               1

Samples were drawn using NUTS(diag_e) at Sun Aug  6 15:35:52 2023.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
<p>The model doesn’t seem to have learnt a whole lot about the position of the breakpoint: the 95% credibility interval ranges from age 3 till age 19. Furthermore, it doesn’t really seem to know about what happens at this breakpoint: the 95% CrI for the difference between the <em>after</em> and the <em>before</em> slopes ranges from about -5.1 till 6.4.</p>
<p>We ought to perform some posterior predictive checks to make sure the model makes sense, though:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_d9c9aef7bfba365078103e7a133ae002">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rstan's 'extract' is likely to conflict with another function</span></span>
<span id="cb19-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># called 'extract', so specify the package, too.</span></span>
<span id="cb19-3">simulated_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rstan<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(fit_bp)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sim_GJT</span>
<span id="cb19-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulated_data is a matrix with 4000 rows and 80 columns.</span></span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For the plot, I select 8 rows at random:</span></span>
<span id="cb19-6">simulated_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> simulated_data[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), ]</span></code></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_4006629f75c73ad4e3b1aae0763ead0c">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb20-2"></span>
<span id="cb20-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the observed data</span></span>
<span id="cb20-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AOA, data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>GJT,</span>
<span id="cb20-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AOA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GJT"</span>,</span>
<span id="cb20-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"observed"</span>)</span>
<span id="cb20-7"></span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the simulated data</span></span>
<span id="cb20-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) {</span>
<span id="cb20-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(data_list<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>AOA, simulated_data[i, ],</span>
<span id="cb20-11">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AOA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GJT"</span>,</span>
<span id="cb20-12">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"simulated"</span>)</span>
<span id="cb20-13">}</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">&gt; <strong>Figure 6.</strong> The actual input data (top left) and eight simulated datasets. Some patterns in the simulated data couldn’t have occurred in the actual dataset: the maximum possible GJT result was 204, yet a couple of datasets contain values above that. This is something that may be worth taking into account in a more refined model, but baby steps.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
</div>
<p>Figure 6 suggests that it may be possible to improve the model since the simulated data display some patterns that would have been impossible to observe in the actual study (viz., GJT values larger than 204). But this should suffice for now.</p>
<p>As a final step, we can draw an effect plot as before:</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_3b78d2ba8bbce5af5aad704142821c48">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">sim_conditional_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(fit_bp)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sim_conditional_mean</span>
<span id="cb22-2">df_sim_cond_means <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb22-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">AOA =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb22-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">meanGJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean),</span>
<span id="cb22-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lo80GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>),</span>
<span id="cb22-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hi80GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>),</span>
<span id="cb22-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lo95GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>),</span>
<span id="cb22-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hi95GJT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(sim_conditional_means, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, quantile, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.975</span>)</span>
<span id="cb22-9">)</span></code></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_7f503efea85de1df47239d701091ea49">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_sim_cond_means,</span>
<span id="cb23-2">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> AOA,</span>
<span id="cb23-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> meanGJT)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> lo95GJT,</span>
<span id="cb23-5">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> hi95GJT),</span>
<span id="cb23-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgrey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> lo80GJT,</span>
<span id="cb23-8">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> hi80GJT),</span>
<span id="cb23-9">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgrey"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption"><strong>Figure 7.</strong> Effect plot for the piecewise regression model applied to DeKeyser et al.’s (2010) North America data. There is substantial uncertainty about whether the regression line should indeed contain a breakpoint.</figcaption>
</figure>
</div>
</div>
</div>
<p>Given the uncertainty about the position of the breakpoint and what happens to the regression line at that breakpoint, it would make sense to fit a linear regression model to these data and then estimate how much allowing for a breakpoint actually buys us in terms of fit to the data. This is why I had the model generate <code>log_lik</code> values, too, but I’ll discuss those another time.</p>
</section>
<section id="software-versions" class="level2">
<h2 class="anchored" data-anchor-id="software-versions">Software versions</h2>
<p>Please note that I reran the code on this page on August 6, 2023.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_cccf19116477280919f0cc5cd4e34363">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">session_info</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.1 (2023-06-16)
 os       Ubuntu 22.04.2 LTS
 system   x86_64, linux-gnu
 ui       X11
 language en_US
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Europe/Zurich
 date     2023-08-06
 pandoc   3.1.1 @ /usr/lib/rstudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package      * version date (UTC) lib source
 cachem         1.0.6   2021-08-19 [2] CRAN (R 4.2.0)
 callr          3.7.3   2022-11-02 [1] CRAN (R 4.3.1)
 cli            3.6.1   2023-03-23 [1] CRAN (R 4.3.0)
 codetools      0.2-19  2023-02-01 [4] CRAN (R 4.2.2)
 colorspace     2.1-0   2023-01-23 [1] CRAN (R 4.3.0)
 crayon         1.5.2   2022-09-29 [1] CRAN (R 4.3.1)
 curl           5.0.1   2023-06-07 [1] CRAN (R 4.3.1)
 devtools       2.4.5   2022-10-11 [1] CRAN (R 4.3.1)
 digest         0.6.29  2021-12-01 [2] CRAN (R 4.2.0)
 dplyr          1.1.2   2023-04-20 [1] CRAN (R 4.3.0)
 ellipsis       0.3.2   2021-04-29 [2] CRAN (R 4.2.0)
 evaluate       0.15    2022-02-18 [2] CRAN (R 4.2.0)
 fansi          1.0.4   2023-01-22 [1] CRAN (R 4.3.1)
 fastmap        1.1.0   2021-01-25 [2] CRAN (R 4.2.0)
 fs             1.5.2   2021-12-08 [2] CRAN (R 4.2.0)
 generics       0.1.3   2022-07-05 [1] CRAN (R 4.3.0)
 ggplot2      * 3.4.2   2023-04-03 [1] CRAN (R 4.3.0)
 glue           1.6.2   2022-02-24 [2] CRAN (R 4.2.0)
 gridExtra      2.3     2017-09-09 [1] CRAN (R 4.3.0)
 gtable         0.3.3   2023-03-21 [1] CRAN (R 4.3.0)
 htmltools      0.5.5   2023-03-23 [1] CRAN (R 4.3.0)
 htmlwidgets    1.6.2   2023-03-17 [1] CRAN (R 4.3.1)
 httpuv         1.6.11  2023-05-11 [1] CRAN (R 4.3.1)
 inline         0.3.19  2021-05-31 [1] CRAN (R 4.3.1)
 jsonlite       1.8.7   2023-06-29 [1] CRAN (R 4.3.1)
 knitr          1.39    2022-04-26 [2] CRAN (R 4.2.0)
 later          1.3.1   2023-05-02 [1] CRAN (R 4.3.1)
 lifecycle      1.0.3   2022-10-07 [1] CRAN (R 4.3.0)
 loo            2.6.0   2023-03-31 [1] CRAN (R 4.3.1)
 magrittr       2.0.3   2022-03-30 [1] CRAN (R 4.3.0)
 matrixStats    1.0.0   2023-06-02 [1] CRAN (R 4.3.1)
 memoise        2.0.1   2021-11-26 [2] CRAN (R 4.2.0)
 mime           0.10    2021-02-13 [2] CRAN (R 4.0.2)
 miniUI         0.1.1.1 2018-05-18 [1] CRAN (R 4.3.1)
 munsell        0.5.0   2018-06-12 [1] CRAN (R 4.3.0)
 pillar         1.9.0   2023-03-22 [1] CRAN (R 4.3.0)
 pkgbuild       1.4.2   2023-06-26 [1] CRAN (R 4.3.1)
 pkgconfig      2.0.3   2019-09-22 [2] CRAN (R 4.2.0)
 pkgload        1.3.2.1 2023-07-08 [1] CRAN (R 4.3.1)
 prettyunits    1.1.1   2020-01-24 [2] CRAN (R 4.2.0)
 processx       3.8.2   2023-06-30 [1] CRAN (R 4.3.1)
 profvis        0.3.8   2023-05-02 [1] CRAN (R 4.3.1)
 promises       1.2.0.1 2021-02-11 [1] CRAN (R 4.3.1)
 ps             1.7.5   2023-04-18 [1] CRAN (R 4.3.1)
 purrr          1.0.1   2023-01-10 [1] CRAN (R 4.3.0)
 R6             2.5.1   2021-08-19 [2] CRAN (R 4.2.0)
 Rcpp           1.0.11  2023-07-06 [1] CRAN (R 4.3.1)
 RcppParallel   5.1.7   2023-02-27 [1] CRAN (R 4.3.1)
 remotes        2.4.2   2021-11-30 [2] CRAN (R 4.2.0)
 rlang          1.1.1   2023-04-28 [1] CRAN (R 4.3.0)
 rmarkdown      2.21    2023-03-26 [1] CRAN (R 4.3.0)
 rstan        * 2.26.22 2023-08-01 [1] local
 rstudioapi     0.14    2022-08-22 [1] CRAN (R 4.3.0)
 scales         1.2.1   2022-08-20 [1] CRAN (R 4.3.0)
 sessioninfo    1.2.2   2021-12-06 [2] CRAN (R 4.2.0)
 shiny          1.7.4.1 2023-07-06 [1] CRAN (R 4.3.1)
 StanHeaders  * 2.26.27 2023-06-14 [1] CRAN (R 4.3.1)
 stringi        1.7.12  2023-01-11 [1] CRAN (R 4.3.1)
 stringr        1.5.0   2022-12-02 [1] CRAN (R 4.3.0)
 tibble         3.2.1   2023-03-20 [1] CRAN (R 4.3.0)
 tidyselect     1.2.0   2022-10-10 [1] CRAN (R 4.3.0)
 urlchecker     1.0.1   2021-11-30 [1] CRAN (R 4.3.1)
 usethis        2.2.2   2023-07-06 [1] CRAN (R 4.3.1)
 utf8           1.2.3   2023-01-31 [1] CRAN (R 4.3.1)
 V8             4.3.0   2023-04-08 [1] CRAN (R 4.3.0)
 vctrs          0.6.3   2023-06-14 [1] CRAN (R 4.3.0)
 withr          2.5.0   2022-03-03 [2] CRAN (R 4.2.0)
 xfun           0.39    2023-04-20 [1] CRAN (R 4.3.0)
 xtable         1.8-4   2019-04-21 [1] CRAN (R 4.3.1)
 yaml           2.3.5   2022-02-21 [2] CRAN (R 4.2.0)

 [1] /home/jan/R/x86_64-pc-linux-gnu-library/4.3
 [2] /usr/local/lib/R/site-library
 [3] /usr/lib/R/site-library
 [4] /usr/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>R</category>
  <category>Stan</category>
  <category>piecewise regression</category>
  <category>non-linearities</category>
  <category>Bayesian statistics</category>
  <guid>https://janhove.github.io/posts/2018-07-04-bayesian-breakpoint-model/index.html</guid>
  <pubDate>Tue, 03 Jul 2018 22:00:00 GMT</pubDate>
</item>
</channel>
</rss>
